var pr=Object.defineProperty;var mr=(i,e,t)=>e in i?pr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>mr(i,typeof e!="symbol"?e+"":e,t);import{w as N,d as de,g as Ve,b as ze}from"./entry.93BCCdcn.js";import{a2 as y,ad as pi,L as gr,s as Us,q as Ki,a as qt,e as ke,g as $t,c as Se,b as dt,f as oe,o as Y,_ as Je,i as He,h as me,w as Ui,x as Wi,y as Yi,J as Ft,ae as yr,p as br,t as Os,d as Es,u as pt,j as wr,z as xi,a4 as kr,a5 as Sr,a7 as $e,D as Vi,n as mi,X as vr,Y as _r}from"./environment.Drd39gux.js";import{S as Ws,i as Ys,t as ce,g as zi,a as ve,c as Ji,o as Ns,p as Cs,h as gi,b as Hi,d as Qi,m as Gi,e as Xi,f as Ar}from"./index.w3JzLsGI.js";const pe=Object.create(null);pe.open="0";pe.close="1";pe.ping="2";pe.pong="3";pe.message="4";pe.upgrade="5";pe.noop="6";const Ct=Object.create(null);Object.keys(pe).forEach(i=>{Ct[pe[i]]=i});const Is={type:"error",data:"parser error"},Zi=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",en=typeof ArrayBuffer=="function",tn=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,xs=({type:i,data:e},t,s)=>Zi&&e instanceof Blob?t?s(e):yi(e,s):en&&(e instanceof ArrayBuffer||tn(e))?t?s(e):yi(new Blob([e]),s):s(pe[i]+(e||"")),yi=(i,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(i)};function bi(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let ps;function Tr(i,e){if(Zi&&i.data instanceof Blob)return i.data.arrayBuffer().then(bi).then(e);if(en&&(i.data instanceof ArrayBuffer||tn(i.data)))return e(bi(i.data));xs(i,!1,t=>{ps||(ps=new TextEncoder),e(ps.encode(t))})}const wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ct=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<wi.length;i++)ct[wi.charCodeAt(i)]=i;const Or=i=>{let e=i.length*.75,t=i.length,s,n=0,r,o,a,l;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const f=new ArrayBuffer(e),h=new Uint8Array(f);for(s=0;s<t;s+=4)r=ct[i.charCodeAt(s)],o=ct[i.charCodeAt(s+1)],a=ct[i.charCodeAt(s+2)],l=ct[i.charCodeAt(s+3)],h[n++]=r<<2|o>>4,h[n++]=(o&15)<<4|a>>2,h[n++]=(a&3)<<6|l&63;return f},Er=typeof ArrayBuffer=="function",Vs=(i,e)=>{if(typeof i!="string")return{type:"message",data:sn(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:Nr(i.substring(1),e)}:Ct[t]?i.length>1?{type:Ct[t],data:i.substring(1)}:{type:Ct[t]}:Is},Nr=(i,e)=>{if(Er){const t=Or(i);return sn(t,e)}else return{base64:!0,data:i}},sn=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},nn="",Cr=(i,e)=>{const t=i.length,s=new Array(t);let n=0;i.forEach((r,o)=>{xs(r,!1,a=>{s[o]=a,++n===t&&e(s.join(nn))})})},Ir=(i,e)=>{const t=i.split(nn),s=[];for(let n=0;n<t.length;n++){const r=Vs(t[n],e);if(s.push(r),r.type==="error")break}return s};function Lr(){return new TransformStream({transform(i,e){Tr(i,t=>{const s=t.length;let n;if(s<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,s);else if(s<65536){n=new Uint8Array(3);const r=new DataView(n.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{n=new Uint8Array(9);const r=new DataView(n.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}i.data&&typeof i.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}let ms;function _t(i){return i.reduce((e,t)=>e+t.length,0)}function At(i,e){if(i[0].length===e)return i.shift();const t=new Uint8Array(e);let s=0;for(let n=0;n<e;n++)t[n]=i[0][s++],s===i[0].length&&(i.shift(),s=0);return i.length&&s<i[0].length&&(i[0]=i[0].slice(s)),t}function Br(i,e){ms||(ms=new TextDecoder);const t=[];let s=0,n=-1,r=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(s===0){if(_t(t)<1)break;const l=At(t,1);r=(l[0]&128)===128,n=l[0]&127,n<126?s=3:n===126?s=1:s=2}else if(s===1){if(_t(t)<2)break;const l=At(t,2);n=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(s===2){if(_t(t)<8)break;const l=At(t,8),f=new DataView(l.buffer,l.byteOffset,l.length),h=f.getUint32(0);if(h>Math.pow(2,21)-1){a.enqueue(Is);break}n=h*Math.pow(2,32)+f.getUint32(4),s=3}else{if(_t(t)<n)break;const l=At(t,n);a.enqueue(Vs(r?l:ms.decode(l),e)),s=0}if(n===0||n>i){a.enqueue(Is);break}}}})}const rn=4;function D(i){if(i)return Rr(i)}function Rr(i){for(var e in D.prototype)i[e]=D.prototype[e];return i}D.prototype.on=D.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};D.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};D.prototype.off=D.prototype.removeListener=D.prototype.removeAllListeners=D.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var s,n=0;n<t.length;n++)if(s=t[n],s===e||s.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+i],this};D.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,n=t.length;s<n;++s)t[s].apply(this,e)}return this};D.prototype.emitReserved=D.prototype.emit;D.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};D.prototype.hasListeners=function(i){return!!this.listeners(i).length};const Qt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),z=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Pr="arraybuffer";function on(i,...e){return e.reduce((t,s)=>(i.hasOwnProperty(s)&&(t[s]=i[s]),t),{})}const Dr=z.setTimeout,qr=z.clearTimeout;function Gt(i,e){e.useNativeTimers?(i.setTimeoutFn=Dr.bind(z),i.clearTimeoutFn=qr.bind(z)):(i.setTimeoutFn=z.setTimeout.bind(z),i.clearTimeoutFn=z.clearTimeout.bind(z))}const $r=1.33;function Fr(i){return typeof i=="string"?Mr(i):Math.ceil((i.byteLength||i.size)*$r)}function Mr(i){let e=0,t=0;for(let s=0,n=i.length;s<n;s++)e=i.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function an(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function jr(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function Kr(i){let e={},t=i.split("&");for(let s=0,n=t.length;s<n;s++){let r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}class Ur extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class zs extends D{constructor(e){super(),this.writable=!1,Gt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Ur(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Vs(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=jr(e);return t.length?"?"+t:""}}class Wr extends zs{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Ir(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Cr(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=an()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let ln=!1;try{ln=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Yr=ln;function xr(){}class Vr extends Wr{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(n,r)=>{this.onError("xhr post error",n,r)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class ue extends D{constructor(e,t,s){super(),this.createRequest=e,Gt(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=on(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&s.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var n;s.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=ue.requestsCount++,ue.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=xr,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ue.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ue.requestsCount=0;ue.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ki);else if(typeof addEventListener=="function"){const i="onpagehide"in z?"pagehide":"unload";addEventListener(i,ki,!1)}}function ki(){for(let i in ue.requests)ue.requests.hasOwnProperty(i)&&ue.requests[i].abort()}const zr=function(){const i=cn({xdomain:!1});return i&&i.responseType!==null}();class Jr extends Vr{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=zr&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ue(cn,this.uri(),e)}}function cn(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Yr))return new XMLHttpRequest}catch{}if(!e)try{return new z[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const fn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Hr extends zs{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=fn?{}:on(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;xs(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch{}n&&Qt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=an()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const gs=z.WebSocket||z.MozWebSocket;class Qr extends Hr{createSocket(e,t,s){return fn?new gs(e,t,s):t?new gs(e,t):new gs(e)}doWrite(e,t){this.ws.send(t)}}class Gr extends zs{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Br(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),n=Lr();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const r=()=>{s.read().then(({done:a,value:l})=>{a||(this.onPacket(l),r())}).catch(a=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;this._writer.write(s).then(()=>{n&&Qt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Xr={websocket:Qr,webtransport:Gr,polling:Jr},Zr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,eo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ls(i){if(i.length>8e3)throw"URI too long";const e=i,t=i.indexOf("["),s=i.indexOf("]");t!=-1&&s!=-1&&(i=i.substring(0,t)+i.substring(t,s).replace(/:/g,";")+i.substring(s,i.length));let n=Zr.exec(i||""),r={},o=14;for(;o--;)r[eo[o]]=n[o]||"";return t!=-1&&s!=-1&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=to(r,r.path),r.queryKey=so(r,r.query),r}function to(i,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function so(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,n,r){n&&(t[n]=r)}),t}const Bs=typeof addEventListener=="function"&&typeof removeEventListener=="function",It=[];Bs&&addEventListener("offline",()=>{It.forEach(i=>i())},!1);class _e extends D{constructor(e,t){if(super(),this.binaryType=Pr,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=Ls(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=Ls(t.host).host);Gt(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const n=s.prototype.name;this.transports.push(n),this._transportsByName[n]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Kr(this.opts.query)),Bs&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},It.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=rn,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&_e.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",_e.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(t+=Fr(n)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Qt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,n){if(typeof t=="function"&&(n=t,t=void 0),typeof s=="function"&&(n=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(_e.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Bs&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=It.indexOf(this._offlineEventListener);s!==-1&&It.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}_e.protocol=rn;class io extends _e{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;_e.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!s)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;_e.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function r(){s||(s=!0,h(),t.close(),t=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=t.name,r(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function l(){o("socket closed")}function f(u){t&&u.name!==t.name&&r()}const h=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",f)};t.once("open",n),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",f),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let no=class extends io{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(n=>Xr[n]).filter(n=>!!n)),super(e,s)}};function ro(i,e="",t){let s=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),s=Ls(i)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(t&&t.port===s.port?"":":"+s.port),s}const oo=typeof ArrayBuffer=="function",ao=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,un=Object.prototype.toString,lo=typeof Blob=="function"||typeof Blob<"u"&&un.call(Blob)==="[object BlobConstructor]",co=typeof File=="function"||typeof File<"u"&&un.call(File)==="[object FileConstructor]";function Js(i){return oo&&(i instanceof ArrayBuffer||ao(i))||lo&&i instanceof Blob||co&&i instanceof File}function Lt(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,s=i.length;t<s;t++)if(Lt(i[t]))return!0;return!1}if(Js(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return Lt(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&Lt(i[t]))return!0;return!1}function fo(i){const e=[],t=i.data,s=i;return s.data=Rs(t,e),s.attachments=e.length,{packet:s,buffers:e}}function Rs(i,e){if(!i)return i;if(Js(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let s=0;s<i.length;s++)t[s]=Rs(i[s],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=Rs(i[s],e));return t}return i}function uo(i,e){return i.data=Ps(i.data,e),delete i.attachments,i}function Ps(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=Ps(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=Ps(i[t],e));return i}const ho=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],po=5;var E;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(E||(E={}));class mo{constructor(e){this.replacer=e}encode(e){return(e.type===E.EVENT||e.type===E.ACK)&&Lt(e)?this.encodeAsBinary({type:e.type===E.EVENT?E.BINARY_EVENT:E.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===E.BINARY_EVENT||e.type===E.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=fo(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}function Si(i){return Object.prototype.toString.call(i)==="[object Object]"}class Hs extends D{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===E.BINARY_EVENT;s||t.type===E.BINARY_ACK?(t.type=s?E.EVENT:E.ACK,this.reconstructor=new go(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Js(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(E[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===E.BINARY_EVENT||s.type===E.BINARY_ACK){const r=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(r,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){const r=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(r,t)}else s.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const r=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(Hs.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case E.CONNECT:return Si(t);case E.DISCONNECT:return t===void 0;case E.CONNECT_ERROR:return typeof t=="string"||Si(t);case E.EVENT:case E.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ho.indexOf(t[0])===-1);case E.ACK:case E.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class go{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=uo(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const yo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Hs,Encoder:mo,get PacketType(){return E},protocol:po},Symbol.toStringTag,{value:"Module"}));function ne(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const bo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class hn extends D{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ne(e,"open",this.onopen.bind(this)),ne(e,"packet",this.onpacket.bind(this)),ne(e,"error",this.onerror.bind(this)),ne(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,n,r;if(bo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:E.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const h=this.ids++,u=t.pop();this._registerAckCallback(h,u),o.id=h}const a=(n=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||n===void 0?void 0:n.writable,l=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s;const n=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},n),o=(...a)=>{this.io.clearTimeoutFn(r),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,n)=>{const r=(o,a)=>o?n(o):s(a);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...r)=>s!==this._queue[0]?void 0:(n!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(n)):(this._queue.shift(),t&&t(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:E.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case E.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case E.EVENT:case E.BINARY_EVENT:this.onevent(e);break;case E.ACK:case E.BINARY_ACK:this.onack(e);break;case E.DISCONNECT:this.ondisconnect();break;case E.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...n){s||(s=!0,t.packet({type:E.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:E.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function Xe(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}Xe.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=Math.floor(e*10)&1?i+t:i-t}return Math.min(i,this.max)|0};Xe.prototype.reset=function(){this.attempts=0};Xe.prototype.setMin=function(i){this.ms=i};Xe.prototype.setMax=function(i){this.max=i};Xe.prototype.setJitter=function(i){this.jitter=i};class Ds extends D{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Gt(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Xe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||yo;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new no(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=ne(t,"open",function(){s.onopen(),e&&e()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=ne(t,"error",r);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{n(),r(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ne(e,"ping",this.onping.bind(this)),ne(e,"data",this.ondata.bind(this)),ne(e,"error",this.onerror.bind(this)),ne(e,"close",this.onclose.bind(this)),ne(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Qt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new hn(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const at={};function ys(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=ro(i,e.path||"/socket.io"),s=t.source,n=t.id,r=t.path,o=at[n]&&r in at[n].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new Ds(s,e):(at[n]||(at[n]=new Ds(s,e)),l=at[n]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(ys,{Manager:Ds,Socket:hn,io:ys,connect:ys});const nl=(()=>{let i=!0;{const n=localStorage.getItem("show-summary-items");i=n!==null?n==="true":i}const{subscribe:e,set:t,update:s}=N(i);return{subscribe:e,set:n=>(localStorage.setItem("show-summary-items",String(n)),t(n)),update:s}})(),rl=(()=>{let i=!0;i=localStorage.getItem("use-symbols")==="true";const{subscribe:e,set:t,update:s}=N(i);return{subscribe:e,set:n=>(localStorage.setItem("use-symbols",String(n)),t(n)),update:s}})(),ol=(()=>{let i=!0;{const n=localStorage.getItem("animation-enabled");i=n!==null?n==="true":i}const{subscribe:e,set:t,update:s}=N(i);return{subscribe:e,set:n=>(localStorage.setItem("animation-enabled",String(n)),t(n)),update:s}})(),al=N(!1),X=N(!1),bs=N(-1);class wo{constructor(){c(this,"socket");c(this,"sessionId","");c(this,"clientId","");c(this,"serverId","");c(this,"dcTimeout",4*60*1e3);c(this,"_dcTask",null);c(this,"_dcWarningTask",null);c(this,"_onConnect",[]);c(this,"_onDisconnect",[]);c(this,"keyphrase",N(""));this.socket=null}onConnect(e){this._onConnect.includes(e)||this._onConnect.push(e)}offConnect(e){this._onConnect=this._onConnect.filter(t=>t!==e)}clearOnConnect(){this._onConnect=[]}onDisconnect(e){this._onDisconnect.includes(e)||this._onDisconnect.push(e)}offDisconnect(e){this._onDisconnect=this._onDisconnect.filter(t=>t!==e)}clearOnDisconnect(){this._onDisconnect=[]}connect(e,t=void 0){return null}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}resetTimeout(){this._dcTask&&window.clearTimeout(this._dcTask),this._dcWarningTask&&window.clearTimeout(this._dcWarningTask),bs.set(-1),this.dcTimeout>=6e4?this._dcWarningTask=window.setTimeout(()=>bs.set(60),this.dcTimeout-6e4):this.dcTimeout>=1e3&&bs.set(this.dcTimeout/1e3),this._dcTask=window.setTimeout(()=>{var e;return(e=this.socket)==null?void 0:e.disconnect()},this.dcTimeout)}ping(){this.socket&&(this.socket.emit("ping",{to:this.serverId}),this.resetTimeout())}emit(e,t){!this.socket||!y(X)||(this.socket.emit(e,t),this.resetTimeout())}reloadSapi(){return new Promise((e,t)=>{if(!this.socket||!y(X)){t("No socket");return}this.socket.timeout(1e4).emitWithAck("reload",{to:this.serverId}).then(s=>{s[0]===!0?(e(!0),this.resetTimeout()):t(s[0])}).catch(s=>t(s))})}getClasses(){return!this.socket||!y(X)?Promise.reject("No socket"):(this.socket.emit("getClasses",{to:this.serverId}),new Promise((e,t)=>{var s;(s=this.socket)==null||s.on("classes",({content:n})=>{var r;(r=this.socket)==null||r.off("classes"),typeof n=="string"&&(n=[n]),e(n)}),setTimeout(()=>t("Timeout"),3e3)}))}getSkills(){return!this.socket||!y(X)?Promise.reject("No socket"):(this.socket.emit("getSkills",{to:this.serverId}),new Promise((e,t)=>{var s;(s=this.socket)==null||s.on("skills",({content:n})=>{var r;(r=this.socket)==null||r.off("skills"),typeof n=="string"&&(n=[n]),e(n)}),setTimeout(()=>t("Timeout"),3e3)}))}getClassYaml(e){return!this.socket||!y(X)?Promise.reject("No socket"):(this.socket.emit("getClassYaml",{name:e,to:this.serverId}),new Promise((t,s)=>{var n;(n=this.socket)==null||n.on("classYaml",({content:r})=>{var o;(o=this.socket)==null||o.off("classYaml"),t(r)}),setTimeout(()=>s("Timeout"),3e3)}))}getSkillYaml(e){return!this.socket||!y(X)?Promise.reject("No socket"):(this.socket.emit("getSkillYaml",{name:e,to:this.serverId}),new Promise((t,s)=>{var n;(n=this.socket)==null||n.on("skillYaml",({content:r})=>{var o;(o=this.socket)==null||o.off("skillYaml"),t(r)}),setTimeout(()=>s("Timeout"),3e3)}))}getAttributeYaml(){return!this.socket||!y(X)?Promise.reject("No socket"):(this.socket.emit("getAttributeYaml",{to:this.serverId}),new Promise((e,t)=>{var s;(s=this.socket)==null||s.on("attributeYaml",({content:n})=>{var r;(r=this.socket)==null||r.off("attributeYaml"),e(n)}),setTimeout(()=>t("Timeout"),3e3)}))}async saveSkillToServer(e,t){if(!this.socket||!y(X))return Promise.reject("No socket");try{const s=await this.socket.timeout(3e3).emitWithAck("saveSkill",{name:e,yaml:t,to:this.serverId}),n=s&&s[0]===e;return n||console.log("Error saving skill",s),this.resetTimeout(),n}catch(s){return console.log("Timeout saving skill to server",s),!1}}async saveClassToServer(e,t){if(!this.socket||!y(X))return Promise.reject("No socket");try{const s=await this.socket.timeout(3e3).emitWithAck("saveClass",{name:e,yaml:t,to:this.serverId}),n=s&&s[0]===e;return n||console.log("Error saving class",s),this.resetTimeout(),n}catch(s){return console.log("Timeout saving class to server",s),!1}}async saveAttributesToServer(e){if(!this.socket||!y(X))return console.log("socket not connected"),Promise.reject("No socket");try{const t=await this.socket.timeout(3e3).emitWithAck("saveAttributes",{yaml:e,to:this.serverId}),s=t&&t[0]==="attributes";return s||console.log("Error saving attribute",t),this.resetTimeout(),s}catch(t){return console.log("Timeout saving attribute to server",t),!1}}async exportAll(e,t,s){if(!this.socket||!y(X))return Promise.reject("No socket");try{const n=await this.socket.timeout(4500).emitWithAck("exportAll",{to:this.serverId,classYaml:e,skillYaml:t,attributeYaml:s});return n&&n[0]?!!n[0]:(this.resetTimeout(),console.log("Error exporting all",n),!1)}catch(n){return console.log("Timeout exporting all",n),!1}}}const U=new wo;class dn{}c(dn,"new",()=>{throw new Error("'new' method not implemented")});class ko extends dn{constructor(t,s,n=!1){super();c(this,"type");c(this,"name");c(this,"description");c(this,"comment");c(this,"components",N([]));c(this,"data",[]);c(this,"preview",[]);c(this,"enablePreview",!1);c(this,"summaryItems",[]);c(this,"isParent",!0);c(this,"isDeprecated",!1);c(this,"id",{});c(this,"_defaultOpen",!1);c(this,"parent");c(this,"setComponents",t=>{t.forEach(s=>s.parent=this),this.components.set([...t])});c(this,"contains",t=>{const s=y(this.components);if(s.includes(t))return!0;for(const n of s)if(n.contains(t))return!0;return!1});c(this,"addComponent",(t,s=-1)=>{const n=y(this.components);s==-1?n.push(t):n.splice(s,0,t),this.setComponents(n)});c(this,"removeComponent",t=>{const s=y(this.components);if(s.includes(t)){s.splice(s.indexOf(t),1),t.parent=void 0,this.setComponents(s);return}for(const n of s)n.contains(t)&&n.removeComponent(t)});c(this,"defaultOpen",()=>(this._defaultOpen=!0,this));c(this,"nextChar",t=>/z$/.test(t)?t.replaceAll(/z$/g,"a")+"a":t.substring(0,t.length-1)+String.fromCharCode(t.charCodeAt(t.length-1)+1));this.type=t,this.name=s.name,this.description=s.description??"",this.summaryItems=s.summaryItems??[],this.comment=s.comment??"",this.setComponents(s.components||[]),this.data=s.data||[],this.preview=s.preview||[],this.isDeprecated=n}getValue(t){var n;const s=(n=this.data)==null?void 0:n.find(r=>r.key==t);return!s||!s.meetsRequirements(this)?"":s.getSummary()}toYamlObj(){const t={type:this.type,comment:this.comment};if(this.preview.length>0){const n={enabled:this.enablePreview};this.preview.filter(r=>r.meetsPreviewRequirements(this)).forEach(r=>{const o=r.getData();Object.keys(o).forEach(a=>n[a]=o[a])}),t.preview=n}const s=this.getData();if(Object.keys(s).length>0&&(t.data=s),this.isParent){const n=y(this.components);if(n.length>0){const r={};n.forEach(o=>{const a=o.toYamlObj();let l=o.name,f="a";for(;r[l];)f=this.nextChar(f),l=o.name+"-"+f;r[l]=a}),t.children=r}}return t}getRawPreviewData(){const t={};return this.preview.forEach(s=>{const n=s.getData();Object.keys(n).forEach(r=>t[r]=n[r])}),t}deserialize(t){const s=t.preview;s&&(this.enablePreview=s.enabled,this.preview.forEach(n=>n.deserialize(s))),t.comment&&(this.comment=t.comment.replaceAll("\\n",`
`))}}const pn=N({}),Mt=N({}),jt=N({}),Kt=N({}),mn=N(!1),Xt=N(""),So=de([pn,Xt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),ll=de(So,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),cl=de([Mt,Xt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),fl=de([jt,Xt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),vo=de([Kt,Xt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),ul=de(vo,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),te=class te{};c(te,"getTriggerByName",e=>{var s;return(s=Object.values(y(pn)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(te,"getTargetByName",e=>{var s;return(s=Object.values(y(Mt)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(te,"getConditionByName",e=>{var s;return(s=Object.values(y(jt)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(te,"getMechanicByName",e=>{var s;return(s=Object.values(y(Kt)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(te,"deserializeComponents",e=>{if(!e)return[];const t=[],s=Object.keys(e);for(const n of s){let r;const o=e[n],a=o.type;if(a==="trigger"){const l=te.getTriggerByName(n.split("-")[0]);l&&(r=l.new())}else if(a==="target"){const l=te.getTargetByName(n.split("-")[0]);l&&(r=l.new())}else if(a==="condition"){const l=te.getConditionByName(n.split("-")[0]);l&&(r=l.new())}else if(a==="mechanic"){const l=te.getMechanicByName(n.split("-")[0]);l&&(r=l.new())}r&&(r.deserialize(o),t.push(r))}return t});let mt=te;function hl(i){return--i*i*((1.70158+1)*i+1.70158)+1}function gn(i){const e=i-1;return e*e*e+1}function dl(i){return i/=.5,i<1?.5*i*i:(i--,-.5*(i*(i-2)-1))}function pl(i,{delay:e=0,duration:t=400,easing:s=gr}={}){const n=+getComputedStyle(i).opacity;return{delay:e,duration:t,easing:s,css:r=>`opacity: ${r*n}`}}function vi(i,{delay:e=0,duration:t=400,easing:s=gn,x:n=0,y:r=0,opacity:o=0}={}){const a=getComputedStyle(i),l=+a.opacity,f=a.transform==="none"?"":a.transform,h=l*(1-o),[u,d]=pi(n),[m,b]=pi(r);return{delay:e,duration:t,easing:s,css:(p,g)=>`
			transform: ${f} translate(${(1-p)*u}${d}, ${(1-p)*m}${b});
			opacity: ${l-h*g}`}}function Fe(i,{delay:e=0,duration:t=400,easing:s=gn,axis:n="y"}={}){const r=getComputedStyle(i),o=+r.opacity,a=n==="y"?"height":"width",l=parseFloat(r[a]),f=n==="y"?["top","bottom"]:["left","right"],h=f.map(w=>`${w[0].toUpperCase()}${w.slice(1)}`),u=parseFloat(r[`padding${h[0]}`]),d=parseFloat(r[`padding${h[1]}`]),m=parseFloat(r[`margin${h[0]}`]),b=parseFloat(r[`margin${h[1]}`]),p=parseFloat(r[`border${h[0]}Width`]),g=parseFloat(r[`border${h[1]}Width`]);return{delay:e,duration:t,easing:s,css:w=>`overflow: hidden;opacity: ${Math.min(w*20,1)*o};${a}: ${w*l}px;padding-${f[0]}: ${w*u}px;padding-${f[1]}: ${w*d}px;margin-${f[0]}: ${w*m}px;margin-${f[1]}: ${w*b}px;border-${f[0]}-width: ${w*p}px;border-${f[1]}-width: ${w*g}px;`}}const _o=i=>i.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),yn=i=>(i=i.replace("_"," "),i.substring(0,1).toUpperCase()+i.substring(1).toLowerCase()),J=i=>i.sort((e,t)=>e.name.localeCompare(t.name)),Ao=(i,e)=>{let t=e;localStorage.getItem(i)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(i,e.toString()):localStorage.setItem(i,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(i)):typeof e=="boolean"?t=localStorage.getItem(i)==="true":typeof e=="string"?t=localStorage.getItem(i):t=JSON.parse(localStorage.getItem(i));const{subscribe:s,set:n,update:r}=N(t);return{subscribe:s,set:o=>(typeof o=="string"||typeof o=="number"||typeof o=="boolean"?localStorage.setItem(i,o.toString()):localStorage.setItem(i,JSON.stringify(o)),n(o)),update:r}},ee=i=>typeof i=="boolean"?i:i==="true",To=i=>({}),_i=i=>({});function Ai(i){let e,t,s,n=(i[2]||"")+"",r,o,a,l,f,h,u,d,m,b=i[1]&&i[1].length>0&&i[8]&&Ti(i);const p=i[15].label,g=Ki(p,i,i[14],_i);return{c(){e=ke("div"),b&&b.c(),t=qt(),s=ke("span"),r=Os(n),o=qt(),g&&g.c(),this.h()},l(w){e=Se(w,"DIV",{class:!0});var k=dt(e);b&&b.l(k),t=$t(k),s=Se(k,"SPAN",{class:!0,role:!0});var _=dt(s);r=Es(_,n),o=$t(_),g&&g.l(_),_.forEach(oe),k.forEach(oe),this.h()},h(){Y(s,"class","display svelte-1aj70cs"),Y(s,"role","definition"),Je(s,"nowrap",i[4]),Y(e,"class","label svelte-1aj70cs")},m(w,k){He(w,e,k),b&&b.m(e,null),me(e,t),me(e,s),me(s,r),me(s,o),g&&g.m(s,null),u=!0,d||(m=[pt(s,"mouseenter",i[10]),pt(s,"mouseleave",i[16])],d=!0)},p(w,k){w[1]&&w[1].length>0&&w[8]?b?(b.p(w,k),k&258&&ce(b,1)):(b=Ti(w),b.c(),ce(b,1),b.m(e,t)):b&&(zi(),ve(b,1,1,()=>{b=null}),Ji()),(!u||k&4)&&n!==(n=(w[2]||"")+"")&&wr(r,n),g&&g.p&&(!u||k&16384)&&Ui(g,p,w,w[14],u?Yi(p,w[14],k,To):Wi(w[14]),_i),(!u||k&16)&&Je(s,"nowrap",w[4])},i(w){u||(ce(b),ce(g,w),w&&Ft(()=>{u&&(l&&l.end(1),a=Ns(s,i[6],{fn:Fe}),a.start())}),w&&Ft(()=>{u&&(h&&h.end(1),f=Ns(e,i[6],{fn:Fe}),f.start())}),u=!0)},o(w){ve(b),ve(g,w),a&&a.invalidate(),w&&(l=Cs(s,Fe,{})),f&&f.invalidate(),w&&(h=Cs(e,i[6],{fn:Fe})),u=!1},d(w){w&&oe(e),b&&b.d(),g&&g.d(w),w&&l&&l.end(),w&&h&&h.end(),d=!1,xi(m)}}}function Ti(i){let e,t,s,n;return{c(){e=ke("div"),t=new kr(!1),this.h()},l(r){e=Se(r,"DIV",{class:!0});var o=dt(e);t=Sr(o,!1),o.forEach(oe),this.h()},h(){t.a=null,Y(e,"class","tooltip svelte-1aj70cs"),Je(e,"top",i[9]<window.innerHeight/2.5)},m(r,o){He(r,e,o),t.m(i[1],e),n=!0},p(r,o){(!n||o&2)&&t.p(r[1]),(!n||o&512)&&Je(e,"top",r[9]<window.innerHeight/2.5)},i(r){n||(r&&Ft(()=>{n&&(s||(s=gi(e,vi,{x:-20,duration:100},!0)),s.run(1))}),n=!0)},o(r){r&&(s||(s=gi(e,vi,{x:-20,duration:100},!1)),s.run(0)),n=!1},d(r){r&&oe(e),r&&s&&s.end()}}}function Oi(i){let e,t,s;return{c(){e=ke("input"),this.h()},l(n){e=Se(n,"INPUT",{placeholder:!0,class:!0}),this.h()},h(){e.disabled=i[5],Y(e,"placeholder",i[3]),Y(e,"class","svelte-1aj70cs")},m(n,r){He(n,e,r),i[17](e),$e(e,i[0]),t||(s=pt(e,"input",i[18]),t=!0)},p(n,r){r&32&&(e.disabled=n[5]),r&8&&Y(e,"placeholder",n[3]),r&1&&e.value!==n[0]&&$e(e,n[0])},d(n){n&&oe(e),i[17](null),t=!1,s()}}}function Oo(i){let e,t,s,n,r,o,a=(i[11].label||i[2])&&Ai(i),l=(!!i[0]||i[0]===""||i[0]===0)&&Oi(i);const f=i[15].default,h=Ki(f,i,i[14],null);return{c(){a&&a.c(),e=qt(),t=ke("div"),l&&l.c(),s=qt(),h&&h.c(),this.h()},l(u){a&&a.l(u),e=$t(u),t=Se(u,"DIV",{class:!0});var d=dt(t);l&&l.l(d),s=$t(d),h&&h.l(d),d.forEach(oe),this.h()},h(){Y(t,"class","input-wrapper"),Je(t,"labeled",!!i[2])},m(u,d){a&&a.m(u,d),He(u,e,d),He(u,t,d),l&&l.m(t,null),me(t,s),h&&h.m(t,null),o=!0},p(u,[d]){u[11].label||u[2]?a?(a.p(u,d),d&2052&&ce(a,1)):(a=Ai(u),a.c(),ce(a,1),a.m(e.parentNode,e)):a&&(zi(),ve(a,1,1,()=>{a=null}),Ji()),u[0]||u[0]===""||u[0]===0?l?l.p(u,d):(l=Oi(u),l.c(),l.m(t,s)):l&&(l.d(1),l=null),h&&h.p&&(!o||d&16384)&&Ui(h,f,u,u[14],o?Yi(f,u[14],d,null):Wi(u[14]),null),(!o||d&4)&&Je(t,"labeled",!!u[2])},i(u){o||(ce(a),ce(h,u),u&&Ft(()=>{o&&(r&&r.end(1),n=Ns(t,i[6],{fn:Fe}),n.start())}),o=!0)},o(u){ve(a),ve(h,u),n&&n.invalidate(),u&&(r=Cs(t,i[6],{fn:Fe})),o=!1},d(u){u&&(oe(e),oe(t)),a&&a.d(u),l&&l.d(),h&&h.d(u),u&&r&&r.end()}}}function Eo(i,e,t){let{$$slots:s={},$$scope:n}=e;const r=yr(s);let{tooltip:o=void 0}=e,{label:a=void 0}=e,{value:l=void 0}=e,{placeholder:f=void 0}=e,{nowrap:h=!1}=e,{autofocus:u=!1}=e,{disabled:d=!1}=e,{disableAnimation:m=!1}=e,b,p=!1,g=0;br(()=>{u&&b&&b.focus()});const w=(S,C)=>(m&&(C.duration=0),C.fn(S,C)),k=S=>{S.target&&(t(9,g=S.target.getBoundingClientRect().top),t(8,p=!0))},_=()=>t(8,p=!1);function A(S){Vi[S?"unshift":"push"](()=>{b=S,t(7,b)})}function T(){l=this.value,t(0,l)}return i.$$set=S=>{"tooltip"in S&&t(1,o=S.tooltip),"label"in S&&t(2,a=S.label),"value"in S&&t(0,l=S.value),"placeholder"in S&&t(3,f=S.placeholder),"nowrap"in S&&t(4,h=S.nowrap),"autofocus"in S&&t(12,u=S.autofocus),"disabled"in S&&t(5,d=S.disabled),"disableAnimation"in S&&t(13,m=S.disableAnimation),"$$scope"in S&&t(14,n=S.$$scope)},[l,o,a,f,h,d,w,b,p,g,k,r,u,m,n,s,_,A,T]}class No extends Ws{constructor(e){super(),Ys(this,e,Eo,Oo,Us,{tooltip:1,label:2,value:0,placeholder:3,nowrap:4,autofocus:12,disabled:5,disableAnimation:13,maybe:6})}get maybe(){return this.$$.ctx[6]}}class Co{constructor(){c(this,"requirements",{});c(this,"requireValue",(e,t)=>(this.requirements[e]=t,this));c(this,"meetsRequirements",e=>{for(const t in this.requirements)if(!this.requirements[t].includes(e.getData(!0)[t]))return!1;return!0});c(this,"meetsPreviewRequirements",e=>{for(const t in this.requirements)if(!this.requirements[t].includes(e.getRawPreviewData()[t]))return!1;return!0})}}const ht=class ht extends ko{constructor(t,s=!1){super("trigger",t,s);c(this,"mana",!1);c(this,"cooldown",!1);c(this,"clone",()=>new ht({name:this.name,components:[...y(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]}));this.mana=t.mana||!1,this.cooldown=t.cooldown||!1}getData(t=!1){const s={};return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(s.mana=this.mana,s.cooldown=this.cooldown),this.data.filter(n=>t||n.meetsRequirements(this)).forEach(n=>{const r=n.getData();Object.keys(r).forEach(o=>s[o]=r[o])}),s}deserialize(t){super.deserialize(t);const s=t.data;s&&(this.mana=ee(s.mana),this.cooldown=ee(s.cooldown),this.data.forEach(n=>n.deserialize(s))),t.children&&Object.keys(t.children).length>0&&this.setComponents(mt.deserializeComponents(t.children))}};c(ht,"new",()=>new ht({name:"null"}));let Ut=ht;function Io(i){let e,t,s,n,r,o,a;return{c(){e=ke("div"),t=ke("input"),s=Os(`
	+(
	`),n=ke("input"),r=Os(`
	
	
	)`),this.h()},l(l){e=Se(l,"DIV",{class:!0});var f=dt(e);t=Se(f,"INPUT",{class:!0,placeholder:!0}),s=Es(f,`
	+(
	`),n=Se(f,"INPUT",{class:!0,placeholder:!0}),r=Es(f,`
	
	
	)`),f.forEach(oe),this.h()},h(){Y(t,"class","base svelte-1x8zii"),Y(t,"placeholder","0"),Y(n,"class","modifier svelte-1x8zii"),Y(n,"placeholder","0"),Y(e,"class","wrap svelte-1x8zii")},m(l,f){He(l,e,f),me(e,t),$e(t,i[0].base),me(e,s),me(e,n),$e(n,i[0].scale),me(e,r),o||(a=[pt(t,"input",i[1]),pt(n,"input",i[2])],o=!0)},p(l,[f]){f&1&&t.value!==l[0].base&&$e(t,l[0].base),f&1&&n.value!==l[0].scale&&$e(n,l[0].scale)},i:mi,o:mi,d(l){l&&oe(e),o=!1,xi(a)}}}function Lo(i,e,t){let{value:s}=e;function n(){s.base=this.value,t(0,s)}function r(){s.scale=this.value,t(0,s)}return i.$$set=o=>{"value"in o&&t(0,s=o.value)},[s,n,r]}class Bo extends Ws{constructor(e){super(),Ys(this,e,Lo,Io,Us,{value:0})}}function Ro(i){let e,t,s;function n(o){i[3](o)}let r={};return i[0]!==void 0&&(r.value=i[0]),e=new Bo({props:r}),Vi.push(()=>Ar(e,"value",n)),{c(){Hi(e.$$.fragment)},l(o){Qi(e.$$.fragment,o)},m(o,a){Gi(e,o,a),s=!0},p(o,a){const l={};!t&&a&1&&(t=!0,l.value=o[0],_r(()=>t=!1)),e.$set(l)},i(o){s||(ce(e.$$.fragment,o),s=!0)},o(o){ve(e.$$.fragment,o),s=!1},d(o){Xi(e,o)}}}function Po(i){let e,t;return e=new No({props:{label:i[1],tooltip:i[2],$$slots:{default:[Ro]},$$scope:{ctx:i}}}),{c(){Hi(e.$$.fragment)},l(s){Qi(e.$$.fragment,s)},m(s,n){Gi(e,s,n),t=!0},p(s,[n]){const r={};n&2&&(r.label=s[1]),n&4&&(r.tooltip=s[2]),n&33&&(r.$$scope={dirty:n,ctx:s}),e.$set(r)},i(s){t||(ce(e.$$.fragment,s),t=!0)},o(s){ve(e.$$.fragment,s),t=!1},d(s){Xi(e,s)}}}function Do(i,e,t){let{data:s}=e,{name:n=""}=e,{tooltip:r=void 0}=e;const o=vr();function a(l){s=l,t(0,s)}return i.$$set=l=>{"data"in l&&t(0,s=l.data),"name"in l&&t(1,n=l.name),"tooltip"in l&&t(2,r=l.tooltip)},i.$$.update=()=>{i.$$.dirty&1&&s&&o("save")},[s,n,r,a]}class qo extends Ws{constructor(e){super(),Ys(this,e,Do,Po,Us,{data:0,name:1,tooltip:2})}}class P{constructor(e,t,s){c(this,"name");c(this,"base");c(this,"scale");this.name=e,this.base=t,this.scale=s}}class Zt extends Co{constructor(t,s,n=0,r=0){super();c(this,"component",qo);c(this,"name");c(this,"key");c(this,"data");c(this,"tooltip");c(this,"setTooltip",t=>(this.tooltip=t,this));c(this,"clone",()=>new Zt(this.name,this.key,this.data.base,this.data.scale));c(this,"getData",()=>{const t={};return t[`${this.key}-base`]=this.data.base||0,t[`${this.key}-scale`]=this.data.scale||0,t});c(this,"getSummary",()=>this.data.base.toString());c(this,"deserialize",t=>{this.data.base=t[`${this.key}-base`]||0,this.data.scale=t[`${this.key}-scale`]||0});this.name=t,this.key=s,this.data=new P(t,n,r)}}const Qs=Symbol.for("yaml.alias"),qs=Symbol.for("yaml.document"),Ae=Symbol.for("yaml.map"),bn=Symbol.for("yaml.pair"),ye=Symbol.for("yaml.scalar"),Ze=Symbol.for("yaml.seq"),Q=Symbol.for("yaml.node.type"),Be=i=>!!i&&typeof i=="object"&&i[Q]===Qs,et=i=>!!i&&typeof i=="object"&&i[Q]===qs,tt=i=>!!i&&typeof i=="object"&&i[Q]===Ae,L=i=>!!i&&typeof i=="object"&&i[Q]===bn,I=i=>!!i&&typeof i=="object"&&i[Q]===ye,st=i=>!!i&&typeof i=="object"&&i[Q]===Ze;function B(i){if(i&&typeof i=="object")switch(i[Q]){case Ae:case Ze:return!0}return!1}function R(i){if(i&&typeof i=="object")switch(i[Q]){case Qs:case Ae:case ye:case Ze:return!0}return!1}const $o=i=>(I(i)||B(i))&&!!i.anchor,W=Symbol("break visit"),wn=Symbol("skip children"),he=Symbol("remove node");function Te(i,e){const t=kn(e);et(i)?Me(null,i.contents,t,Object.freeze([i]))===he&&(i.contents=null):Me(null,i,t,Object.freeze([]))}Te.BREAK=W;Te.SKIP=wn;Te.REMOVE=he;function Me(i,e,t,s){const n=Sn(i,e,t,s);if(R(n)||L(n))return vn(i,s,n),Me(i,n,t,s);if(typeof n!="symbol"){if(B(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){const o=Me(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===W)return W;o===he&&(e.items.splice(r,1),r-=1)}}}else if(L(e)){s=Object.freeze(s.concat(e));const r=Me("key",e.key,t,s);if(r===W)return W;r===he&&(e.key=null);const o=Me("value",e.value,t,s);if(o===W)return W;o===he&&(e.value=null)}}return n}async function es(i,e){const t=kn(e);et(i)?await je(null,i.contents,t,Object.freeze([i]))===he&&(i.contents=null):await je(null,i,t,Object.freeze([]))}es.BREAK=W;es.SKIP=wn;es.REMOVE=he;async function je(i,e,t,s){const n=await Sn(i,e,t,s);if(R(n)||L(n))return vn(i,s,n),je(i,n,t,s);if(typeof n!="symbol"){if(B(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){const o=await je(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===W)return W;o===he&&(e.items.splice(r,1),r-=1)}}}else if(L(e)){s=Object.freeze(s.concat(e));const r=await je("key",e.key,t,s);if(r===W)return W;r===he&&(e.key=null);const o=await je("value",e.value,t,s);if(o===W)return W;o===he&&(e.value=null)}}return n}function kn(i){return typeof i=="object"&&(i.Collection||i.Node||i.Value)?Object.assign({Alias:i.Node,Map:i.Node,Scalar:i.Node,Seq:i.Node},i.Value&&{Map:i.Value,Scalar:i.Value,Seq:i.Value},i.Collection&&{Map:i.Collection,Seq:i.Collection},i):i}function Sn(i,e,t,s){var n,r,o,a,l;if(typeof t=="function")return t(i,e,s);if(tt(e))return(n=t.Map)==null?void 0:n.call(t,i,e,s);if(st(e))return(r=t.Seq)==null?void 0:r.call(t,i,e,s);if(L(e))return(o=t.Pair)==null?void 0:o.call(t,i,e,s);if(I(e))return(a=t.Scalar)==null?void 0:a.call(t,i,e,s);if(Be(e))return(l=t.Alias)==null?void 0:l.call(t,i,e,s)}function vn(i,e,t){const s=e[e.length-1];if(B(s))s.items[i]=t;else if(L(s))i==="key"?s.key=t:s.value=t;else if(et(s))s.contents=t;else{const n=Be(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}const Fo={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},Mo=i=>i.replace(/[!,[\]{}]/g,e=>Fo[e]);class K{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},K.defaultYaml,e),this.tags=Object.assign({},K.defaultTags,t)}clone(){const e=new K(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new K(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:K.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},K.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:K.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},K.defaultTags),this.atNextDocument=!1);const s=e.trim().split(/[ \t]+/),n=s.shift();switch(n){case"%TAG":{if(s.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;const[r,o]=s;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[r]=s;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const o=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,o),!1}}default:return t(0,`Unknown directive ${n}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const o=e.slice(2,-1);return o==="!"||o==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),o)}const[,s,n]=e.match(/^(.*!)([^!]*)$/s);n||t(`The ${e} tag has no suffix`);const r=this.tags[s];if(r)try{return r+decodeURIComponent(n)}catch(o){return t(String(o)),null}return s==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,s]of Object.entries(this.tags))if(e.startsWith(s))return t+Mo(e.substring(s.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags);let n;if(e&&s.length>0&&R(e.contents)){const r={};Te(e.contents,(o,a)=>{R(a)&&a.tag&&(r[a.tag]=!0)}),n=Object.keys(r)}else n=[];for(const[r,o]of s)r==="!!"&&o==="tag:yaml.org,2002:"||(!e||n.some(a=>a.startsWith(o)))&&t.push(`%TAG ${r} ${o}`);return t.join(`
`)}}K.defaultYaml={explicit:!1,version:"1.2"};K.defaultTags={"!!":"tag:yaml.org,2002:"};function _n(i){if(/[\x00-\x19\s,[\]{}]/.test(i)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(i)}`;throw new Error(t)}return!0}function An(i){const e=new Set;return Te(i,{Value(t,s){s.anchor&&e.add(s.anchor)}}),e}function Tn(i,e){for(let t=1;;++t){const s=`${i}${t}`;if(!e.has(s))return s}}function jo(i,e){const t=[],s=new Map;let n=null;return{onAnchor:r=>{t.push(r),n||(n=An(i));const o=Tn(e,n);return n.add(o),o},setAnchors:()=>{for(const r of t){const o=s.get(r);if(typeof o=="object"&&o.anchor&&(I(o.node)||B(o.node)))o.node.anchor=o.anchor;else{const a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=r,a}}},sourceObjects:s}}function Ke(i,e,t,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let n=0,r=s.length;n<r;++n){const o=s[n],a=Ke(i,s,String(n),o);a===void 0?delete s[n]:a!==o&&(s[n]=a)}else if(s instanceof Map)for(const n of Array.from(s.keys())){const r=s.get(n),o=Ke(i,s,n,r);o===void 0?s.delete(n):o!==r&&s.set(n,o)}else if(s instanceof Set)for(const n of Array.from(s)){const r=Ke(i,s,n,n);r===void 0?s.delete(n):r!==n&&(s.delete(n),s.add(r))}else for(const[n,r]of Object.entries(s)){const o=Ke(i,s,n,r);o===void 0?delete s[n]:o!==r&&(s[n]=o)}return i.call(e,t,s)}function H(i,e,t){if(Array.isArray(i))return i.map((s,n)=>H(s,String(n),t));if(i&&typeof i.toJSON=="function"){if(!t||!$o(i))return i.toJSON(e,t);const s={aliasCount:0,count:1,res:void 0};t.anchors.set(i,s),t.onCreate=r=>{s.res=r,delete t.onCreate};const n=i.toJSON(e,t);return t.onCreate&&t.onCreate(n),n}return typeof i=="bigint"&&!(t!=null&&t.keep)?Number(i):i}class Gs{constructor(e){Object.defineProperty(this,Q,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:s,onAnchor:n,reviver:r}={}){if(!et(e))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},a=H(this,"",o);if(typeof n=="function")for(const{count:l,res:f}of o.anchors.values())n(f,l);return typeof r=="function"?Ke(r,{"":a},"",a):a}}class ts extends Gs{constructor(e){super(Qs),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return Te(e,{Node:(s,n)=>{if(n===this)return Te.BREAK;n.anchor===this.source&&(t=n)}}),t}toJSON(e,t){if(!t)return{source:this.source};const{anchors:s,doc:n,maxAliasCount:r}=t,o=this.resolve(n);if(!o){const l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let a=s.get(o);if(a||(H(o,null,t),a=s.get(o)),!a||a.res===void 0){const l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(r>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=Bt(n,o,s)),a.count*a.aliasCount>r)){const l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return a.res}toString(e,t,s){const n=`*${this.source}`;if(e){if(_n(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${n} `}return n}}function Bt(i,e,t){if(Be(e)){const s=e.resolve(i),n=t&&s&&t.get(s);return n?n.count*n.aliasCount:0}else if(B(e)){let s=0;for(const n of e.items){const r=Bt(i,n,t);r>s&&(s=r)}return s}else if(L(e)){const s=Bt(i,e.key,t),n=Bt(i,e.value,t);return Math.max(s,n)}return 1}const On=i=>!i||typeof i!="function"&&typeof i!="object";class O extends Gs{constructor(e){super(ye),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:H(this.value,e,t)}toString(){return String(this.value)}}O.BLOCK_FOLDED="BLOCK_FOLDED";O.BLOCK_LITERAL="BLOCK_LITERAL";O.PLAIN="PLAIN";O.QUOTE_DOUBLE="QUOTE_DOUBLE";O.QUOTE_SINGLE="QUOTE_SINGLE";const Ko="tag:yaml.org,2002:";function Uo(i,e,t){if(e){const s=t.filter(r=>r.tag===e),n=s.find(r=>!r.format)??s[0];if(!n)throw new Error(`Tag ${e} not found`);return n}return t.find(s=>{var n;return((n=s.identify)==null?void 0:n.call(s,i))&&!s.format})}function gt(i,e,t){var u,d,m;if(et(i)&&(i=i.contents),R(i))return i;if(L(i)){const b=(d=(u=t.schema[Ae]).createNode)==null?void 0:d.call(u,t.schema,null,t);return b.items.push(i),b}(i instanceof String||i instanceof Number||i instanceof Boolean||typeof BigInt<"u"&&i instanceof BigInt)&&(i=i.valueOf());const{aliasDuplicateObjects:s,onAnchor:n,onTagObj:r,schema:o,sourceObjects:a}=t;let l;if(s&&i&&typeof i=="object"){if(l=a.get(i),l)return l.anchor||(l.anchor=n(i)),new ts(l.anchor);l={anchor:null,node:null},a.set(i,l)}e!=null&&e.startsWith("!!")&&(e=Ko+e.slice(2));let f=Uo(i,e,o.tags);if(!f){if(i&&typeof i.toJSON=="function"&&(i=i.toJSON()),!i||typeof i!="object"){const b=new O(i);return l&&(l.node=b),b}f=i instanceof Map?o[Ae]:Symbol.iterator in Object(i)?o[Ze]:o[Ae]}r&&(r(f),delete t.onTagObj);const h=f!=null&&f.createNode?f.createNode(t.schema,i,t):typeof((m=f==null?void 0:f.nodeClass)==null?void 0:m.from)=="function"?f.nodeClass.from(t.schema,i,t):new O(i);return e?h.tag=e:f.default||(h.tag=f.tag),l&&(l.node=h),h}function Wt(i,e,t){let s=t;for(let n=e.length-1;n>=0;--n){const r=e[n];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const o=[];o[r]=s,s=o}else s=new Map([[r,s]])}return gt(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:i,sourceObjects:new Map})}const ft=i=>i==null||typeof i=="object"&&!!i[Symbol.iterator]().next().done;class En extends Gs{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(s=>R(s)||L(s)?s.clone(e):s),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(ft(e))this.add(t);else{const[s,...n]=e,r=this.get(s,!0);if(B(r))r.addIn(n,t);else if(r===void 0&&this.schema)this.set(s,Wt(this.schema,n,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}deleteIn(e){const[t,...s]=e;if(s.length===0)return this.delete(t);const n=this.get(t,!0);if(B(n))return n.deleteIn(s);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${s}`)}getIn(e,t){const[s,...n]=e,r=this.get(s,!0);return n.length===0?!t&&I(r)?r.value:r:B(r)?r.getIn(n,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!L(t))return!1;const s=t.value;return s==null||e&&I(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(e){const[t,...s]=e;if(s.length===0)return this.has(t);const n=this.get(t,!0);return B(n)?n.hasIn(s):!1}setIn(e,t){const[s,...n]=e;if(n.length===0)this.set(s,t);else{const r=this.get(s,!0);if(B(r))r.setIn(n,t);else if(r===void 0&&this.schema)this.set(s,Wt(this.schema,n,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}}const Wo=i=>i.replace(/^(?!$)(?: $)?/gm,"#");function ge(i,e){return/^\n+$/.test(i)?i.substring(1):e?i.replace(/^(?! *$)/gm,e):i}const Ne=(i,e,t)=>i.endsWith(`
`)?ge(t,e):t.includes(`
`)?`
`+ge(t,e):(i.endsWith(" ")?"":" ")+t,Nn="flow",$s="block",Rt="quoted";function ss(i,e,t="flow",{indentAtStart:s,lineWidth:n=80,minContentWidth:r=20,onFold:o,onOverflow:a}={}){if(!n||n<0)return i;n<r&&(r=0);const l=Math.max(1+r,1+n-e.length);if(i.length<=l)return i;const f=[],h={};let u=n-e.length;typeof s=="number"&&(s>n-Math.max(2,r)?f.push(0):u=n-s);let d,m,b=!1,p=-1,g=-1,w=-1;t===$s&&(p=Ei(i,p,e.length),p!==-1&&(u=p+l));for(let _;_=i[p+=1];){if(t===Rt&&_==="\\"){switch(g=p,i[p+1]){case"x":p+=3;break;case"u":p+=5;break;case"U":p+=9;break;default:p+=1}w=p}if(_===`
`)t===$s&&(p=Ei(i,p,e.length)),u=p+e.length+l,d=void 0;else{if(_===" "&&m&&m!==" "&&m!==`
`&&m!=="	"){const A=i[p+1];A&&A!==" "&&A!==`
`&&A!=="	"&&(d=p)}if(p>=u)if(d)f.push(d),u=d+l,d=void 0;else if(t===Rt){for(;m===" "||m==="	";)m=_,_=i[p+=1],b=!0;const A=p>w+1?p-2:g-1;if(h[A])return i;f.push(A),h[A]=!0,u=A+l,d=void 0}else b=!0}m=_}if(b&&a&&a(),f.length===0)return i;o&&o();let k=i.slice(0,f[0]);for(let _=0;_<f.length;++_){const A=f[_],T=f[_+1]||i.length;A===0?k=`
${e}${i.slice(0,T)}`:(t===Rt&&h[A]&&(k+=`${i[A]}\\`),k+=`
${e}${i.slice(A+1,T)}`)}return k}function Ei(i,e,t){let s=e,n=e+1,r=i[n];for(;r===" "||r==="	";)if(e<n+t)r=i[++e];else{do r=i[++e];while(r&&r!==`
`);s=e,n=e+1,r=i[n]}return s}const is=(i,e)=>({indentAtStart:e?i.indent.length:i.indentAtStart,lineWidth:i.options.lineWidth,minContentWidth:i.options.minContentWidth}),ns=i=>/^(%|---|\.\.\.)/m.test(i);function Yo(i,e,t){if(!e||e<0)return!1;const s=e-t,n=i.length;if(n<=s)return!1;for(let r=0,o=0;r<n;++r)if(i[r]===`
`){if(r-o>s)return!0;if(o=r+1,n-o<=s)return!1}return!0}function ut(i,e){const t=JSON.stringify(i);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:s}=e,n=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(ns(i)?"  ":"");let o="",a=0;for(let l=0,f=t[l];f;f=t[++l])if(f===" "&&t[l+1]==="\\"&&t[l+2]==="n"&&(o+=t.slice(a,l)+"\\ ",l+=1,a=l,f="\\"),f==="\\")switch(t[l+1]){case"u":{o+=t.slice(a,l);const h=t.substr(l+2,4);switch(h){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:h.substr(0,2)==="00"?o+="\\x"+h.substr(2):o+=t.substr(l,6)}l+=5,a=l+1}break;case"n":if(s||t[l+2]==='"'||t.length<n)l+=1;else{for(o+=t.slice(a,l)+`

`;t[l+2]==="\\"&&t[l+3]==="n"&&t[l+4]!=='"';)o+=`
`,l+=2;o+=r,t[l+2]===" "&&(o+="\\"),l+=1,a=l+1}break;default:l+=1}return o=a?o+t.slice(a):t,s?o:ss(o,r,Rt,is(e,!1))}function Fs(i,e){if(e.options.singleQuote===!1||e.implicitKey&&i.includes(`
`)||/[ \t]\n|\n[ \t]/.test(i))return ut(i,e);const t=e.indent||(ns(i)?"  ":""),s="'"+i.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?s:ss(s,t,Nn,is(e,!1))}function Ue(i,e){const{singleQuote:t}=e.options;let s;if(t===!1)s=ut;else{const n=i.includes('"'),r=i.includes("'");n&&!r?s=Fs:r&&!n?s=ut:s=t?Fs:ut}return s(i,e)}let Ms;try{Ms=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Ms=/\n+(?!\n|$)/g}function Pt({comment:i,type:e,value:t},s,n,r){const{blockQuote:o,commentString:a,lineWidth:l}=s.options;if(!o||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return Ue(t,s);const f=s.indent||(s.forceBlockIndent||ns(t)?"  ":""),h=o==="literal"?!0:o==="folded"||e===O.BLOCK_FOLDED?!1:e===O.BLOCK_LITERAL?!0:!Yo(t,l,f.length);if(!t)return h?`|
`:`>
`;let u,d;for(d=t.length;d>0;--d){const S=t[d-1];if(S!==`
`&&S!=="	"&&S!==" ")break}let m=t.substring(d);const b=m.indexOf(`
`);b===-1?u="-":t===m||b!==m.length-1?(u="+",r&&r()):u="",m&&(t=t.slice(0,-m.length),m[m.length-1]===`
`&&(m=m.slice(0,-1)),m=m.replace(Ms,`$&${f}`));let p=!1,g,w=-1;for(g=0;g<t.length;++g){const S=t[g];if(S===" ")p=!0;else if(S===`
`)w=g;else break}let k=t.substring(0,w<g?w+1:g);k&&(t=t.substring(k.length),k=k.replace(/\n+/g,`$&${f}`));let A=(h?"|":">")+(p?f?"2":"1":"")+u;if(i&&(A+=" "+a(i.replace(/ ?[\r\n]+/g," ")),n&&n()),h)return t=t.replace(/\n+/g,`$&${f}`),`${A}
${f}${k}${t}${m}`;t=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${f}`);const T=ss(`${k}${t}${m}`,f,$s,is(s,!0));return`${A}
${f}${T}`}function xo(i,e,t,s){const{type:n,value:r}=i,{actualString:o,implicitKey:a,indent:l,indentStep:f,inFlow:h}=e;if(a&&r.includes(`
`)||h&&/[[\]{},]/.test(r))return Ue(r,e);if(!r||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return a||h||!r.includes(`
`)?Ue(r,e):Pt(i,e,t,s);if(!a&&!h&&n!==O.PLAIN&&r.includes(`
`))return Pt(i,e,t,s);if(ns(r)){if(l==="")return e.forceBlockIndent=!0,Pt(i,e,t,s);if(a&&l===f)return Ue(r,e)}const u=r.replace(/\n+/g,`$&
${l}`);if(o){const d=p=>{var g;return p.default&&p.tag!=="tag:yaml.org,2002:str"&&((g=p.test)==null?void 0:g.test(u))},{compat:m,tags:b}=e.doc.schema;if(b.some(d)||m!=null&&m.some(d))return Ue(r,e)}return a?u:ss(u,l,Nn,is(e,!1))}function kt(i,e,t,s){const{implicitKey:n,inFlow:r}=e,o=typeof i.value=="string"?i:Object.assign({},i,{value:String(i.value)});let{type:a}=i;a!==O.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=O.QUOTE_DOUBLE);const l=h=>{switch(h){case O.BLOCK_FOLDED:case O.BLOCK_LITERAL:return n||r?Ue(o.value,e):Pt(o,e,t,s);case O.QUOTE_DOUBLE:return ut(o.value,e);case O.QUOTE_SINGLE:return Fs(o.value,e);case O.PLAIN:return xo(o,e,t,s);default:return null}};let f=l(a);if(f===null){const{defaultKeyType:h,defaultStringType:u}=e.options,d=n&&h||u;if(f=l(d),f===null)throw new Error(`Unsupported default string type ${d}`)}return f}function Cn(i,e){const t=Object.assign({blockQuote:!0,commentString:Wo,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},i.schema.toStringOptions,e);let s;switch(t.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:i,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:s,options:t}}function Vo(i,e){var n;if(e.tag){const r=i.filter(o=>o.tag===e.tag);if(r.length>0)return r.find(o=>o.format===e.format)??r[0]}let t,s;if(I(e)){s=e.value;const r=i.filter(o=>{var a;return(a=o.identify)==null?void 0:a.call(o,s)});t=r.find(o=>o.format===e.format)??r.find(o=>!o.format)}else s=e,t=i.find(r=>r.nodeClass&&s instanceof r.nodeClass);if(!t){const r=((n=s==null?void 0:s.constructor)==null?void 0:n.name)??typeof s;throw new Error(`Tag not resolved for ${r} value`)}return t}function zo(i,e,{anchors:t,doc:s}){if(!s.directives)return"";const n=[],r=(I(i)||B(i))&&i.anchor;r&&_n(r)&&(t.add(r),n.push(`&${r}`));const o=i.tag?i.tag:e.default?null:e.tag;return o&&n.push(s.directives.tagString(o)),n.join(" ")}function Qe(i,e,t,s){var l;if(L(i))return i.toString(e,t,s);if(Be(i)){if(e.doc.directives)return i.toString(e);if((l=e.resolvedAliases)!=null&&l.has(i))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(i):e.resolvedAliases=new Set([i]),i=i.resolve(e.doc)}let n;const r=R(i)?i:e.doc.createNode(i,{onTagObj:f=>n=f});n||(n=Vo(e.doc.schema.tags,r));const o=zo(r,n,e);o.length>0&&(e.indentAtStart=(e.indentAtStart??0)+o.length+1);const a=typeof n.stringify=="function"?n.stringify(r,e,t,s):I(r)?kt(r,e,t,s):r.toString(e,t,s);return o?I(r)||a[0]==="{"||a[0]==="["?`${o} ${a}`:`${o}
${e.indent}${a}`:a}function Jo({key:i,value:e},t,s,n){const{allNullValues:r,doc:o,indent:a,indentStep:l,options:{commentString:f,indentSeq:h,simpleKeys:u}}=t;let d=R(i)&&i.comment||null;if(u){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(B(i)||!R(i)&&typeof i=="object"){const C="With simple keys, collection cannot be used as a key value";throw new Error(C)}}let m=!u&&(!i||d&&e==null&&!t.inFlow||B(i)||(I(i)?i.type===O.BLOCK_FOLDED||i.type===O.BLOCK_LITERAL:typeof i=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!m&&(u||!r),indent:a+l});let b=!1,p=!1,g=Qe(i,t,()=>b=!0,()=>p=!0);if(!m&&!t.inFlow&&g.length>1024){if(u)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");m=!0}if(t.inFlow){if(r||e==null)return b&&s&&s(),g===""?"?":m?`? ${g}`:g}else if(r&&!u||e==null&&m)return g=`? ${g}`,d&&!b?g+=Ne(g,t.indent,f(d)):p&&n&&n(),g;b&&(d=null),m?(d&&(g+=Ne(g,t.indent,f(d))),g=`? ${g}
${a}:`):(g=`${g}:`,d&&(g+=Ne(g,t.indent,f(d))));let w,k,_;R(e)?(w=!!e.spaceBefore,k=e.commentBefore,_=e.comment):(w=!1,k=null,_=null,e&&typeof e=="object"&&(e=o.createNode(e))),t.implicitKey=!1,!m&&!d&&I(e)&&(t.indentAtStart=g.length+1),p=!1,!h&&l.length>=2&&!t.inFlow&&!m&&st(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let A=!1;const T=Qe(e,t,()=>A=!0,()=>p=!0);let S=" ";if(d||w||k){if(S=w?`
`:"",k){const C=f(k);S+=`
${ge(C,t.indent)}`}T===""&&!t.inFlow?S===`
`&&(S=`

`):S+=`
${t.indent}`}else if(!m&&B(e)){const C=T[0],v=T.indexOf(`
`),q=v!==-1,we=t.inFlow??e.flow??e.items.length===0;if(q||!we){let Re=!1;if(q&&(C==="&"||C==="!")){let $=T.indexOf(" ");C==="&"&&$!==-1&&$<v&&T[$+1]==="!"&&($=T.indexOf(" ",$+1)),($===-1||v<$)&&(Re=!0)}Re||(S=`
${t.indent}`)}}else(T===""||T[0]===`
`)&&(S="");return g+=S+T,t.inFlow?A&&s&&s():_&&!A?g+=Ne(g,t.indent,f(_)):p&&n&&n(),g}function In(i,e){(i==="debug"||i==="warn")&&(typeof process<"u"&&process.emitWarning?process.emitWarning(e):console.warn(e))}const Ni="<<";function Ln(i,e,{key:t,value:s}){if(i!=null&&i.doc.schema.merge&&Ho(t))if(s=Be(s)?s.resolve(i.doc):s,st(s))for(const n of s.items)ws(i,e,n);else if(Array.isArray(s))for(const n of s)ws(i,e,n);else ws(i,e,s);else{const n=H(t,"",i);if(e instanceof Map)e.set(n,H(s,n,i));else if(e instanceof Set)e.add(n);else{const r=Qo(t,n,i),o=H(s,r,i);r in e?Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[r]=o}}return e}const Ho=i=>i===Ni||I(i)&&i.value===Ni&&(!i.type||i.type===O.PLAIN);function ws(i,e,t){const s=i&&Be(t)?t.resolve(i.doc):t;if(!tt(s))throw new Error("Merge sources must be maps or map aliases");const n=s.toJSON(null,i,Map);for(const[r,o]of n)e instanceof Map?e.has(r)||e.set(r,o):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}function Qo(i,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(R(i)&&(t!=null&&t.doc)){const s=Cn(t.doc,{});s.anchors=new Set;for(const r of t.anchors.keys())s.anchors.add(r.anchor);s.inFlow=!0,s.inStringifyKey=!0;const n=i.toString(s);if(!t.mapKeyWarned){let r=JSON.stringify(n);r.length>40&&(r=r.substring(0,36)+'..."'),In(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return n}return JSON.stringify(e)}function Xs(i,e,t){const s=gt(i,void 0,t),n=gt(e,void 0,t);return new j(s,n)}class j{constructor(e,t=null){Object.defineProperty(this,Q,{value:bn}),this.key=e,this.value=t}clone(e){let{key:t,value:s}=this;return R(t)&&(t=t.clone(e)),R(s)&&(s=s.clone(e)),new j(t,s)}toJSON(e,t){const s=t!=null&&t.mapAsMap?new Map:{};return Ln(t,s,this)}toString(e,t,s){return e!=null&&e.doc?Jo(this,e,t,s):JSON.stringify(this)}}function Bn(i,e,t){return(e.inFlow??i.flow?Xo:Go)(i,e,t)}function Go({comment:i,items:e},t,{blockItemPrefix:s,flowChars:n,itemIndent:r,onChompKeep:o,onComment:a}){const{indent:l,options:{commentString:f}}=t,h=Object.assign({},t,{indent:r,type:null});let u=!1;const d=[];for(let b=0;b<e.length;++b){const p=e[b];let g=null;if(R(p))!u&&p.spaceBefore&&d.push(""),Yt(t,d,p.commentBefore,u),p.comment&&(g=p.comment);else if(L(p)){const k=R(p.key)?p.key:null;k&&(!u&&k.spaceBefore&&d.push(""),Yt(t,d,k.commentBefore,u))}u=!1;let w=Qe(p,h,()=>g=null,()=>u=!0);g&&(w+=Ne(w,r,f(g))),u&&g&&(u=!1),d.push(s+w)}let m;if(d.length===0)m=n.start+n.end;else{m=d[0];for(let b=1;b<d.length;++b){const p=d[b];m+=p?`
${l}${p}`:`
`}}return i?(m+=`
`+ge(f(i),l),a&&a()):u&&o&&o(),m}function Xo({items:i},e,{flowChars:t,itemIndent:s}){const{indent:n,indentStep:r,flowCollectionPadding:o,options:{commentString:a}}=e;s+=r;const l=Object.assign({},e,{indent:s,inFlow:!0,type:null});let f=!1,h=0;const u=[];for(let b=0;b<i.length;++b){const p=i[b];let g=null;if(R(p))p.spaceBefore&&u.push(""),Yt(e,u,p.commentBefore,!1),p.comment&&(g=p.comment);else if(L(p)){const k=R(p.key)?p.key:null;k&&(k.spaceBefore&&u.push(""),Yt(e,u,k.commentBefore,!1),k.comment&&(f=!0));const _=R(p.value)?p.value:null;_?(_.comment&&(g=_.comment),_.commentBefore&&(f=!0)):p.value==null&&(k!=null&&k.comment)&&(g=k.comment)}g&&(f=!0);let w=Qe(p,l,()=>g=null);b<i.length-1&&(w+=","),g&&(w+=Ne(w,s,a(g))),!f&&(u.length>h||w.includes(`
`))&&(f=!0),u.push(w),h=u.length}const{start:d,end:m}=t;if(u.length===0)return d+m;if(!f){const b=u.reduce((p,g)=>p+g.length+2,2);f=e.options.lineWidth>0&&b>e.options.lineWidth}if(f){let b=d;for(const p of u)b+=p?`
${r}${n}${p}`:`
`;return`${b}
${n}${m}`}else return`${d}${o}${u.join(" ")}${o}${m}`}function Yt({indent:i,options:{commentString:e}},t,s,n){if(s&&n&&(s=s.replace(/^\n+/,"")),s){const r=ge(e(s),i);t.push(r.trimStart())}}function Ce(i,e){const t=I(e)?e.value:e;for(const s of i)if(L(s)&&(s.key===e||s.key===t||I(s.key)&&s.key.value===t))return s}class x extends En{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Ae,e),this.items=[]}static from(e,t,s){const{keepUndefined:n,replacer:r}=s,o=new this(e),a=(l,f)=>{if(typeof r=="function")f=r.call(t,l,f);else if(Array.isArray(r)&&!r.includes(l))return;(f!==void 0||n)&&o.items.push(Xs(l,f,s))};if(t instanceof Map)for(const[l,f]of t)a(l,f);else if(t&&typeof t=="object")for(const l of Object.keys(t))a(l,t[l]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,t){var o;let s;L(e)?s=e:!e||typeof e!="object"||!("key"in e)?s=new j(e,e==null?void 0:e.value):s=new j(e.key,e.value);const n=Ce(this.items,s.key),r=(o=this.schema)==null?void 0:o.sortMapEntries;if(n){if(!t)throw new Error(`Key ${s.key} already set`);I(n.value)&&On(s.value)?n.value.value=s.value:n.value=s.value}else if(r){const a=this.items.findIndex(l=>r(s,l)<0);a===-1?this.items.push(s):this.items.splice(a,0,s)}else this.items.push(s)}delete(e){const t=Ce(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const s=Ce(this.items,e),n=s==null?void 0:s.value;return(!t&&I(n)?n.value:n)??void 0}has(e){return!!Ce(this.items,e)}set(e,t){this.add(new j(e,t),!0)}toJSON(e,t,s){const n=s?new s:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(n);for(const r of this.items)Ln(t,n,r);return n}toString(e,t,s){if(!e)return JSON.stringify(this);for(const n of this.items)if(!L(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),Bn(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:s,onComment:t})}}const it={collection:"map",default:!0,nodeClass:x,tag:"tag:yaml.org,2002:map",resolve(i,e){return tt(i)||e("Expected a mapping for this tag"),i},createNode:(i,e,t)=>x.from(i,e,t)};class Oe extends En{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Ze,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=Tt(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const s=Tt(e);if(typeof s!="number")return;const n=this.items[s];return!t&&I(n)?n.value:n}has(e){const t=Tt(e);return typeof t=="number"&&t<this.items.length}set(e,t){const s=Tt(e);if(typeof s!="number")throw new Error(`Expected a valid index, not ${e}.`);const n=this.items[s];I(n)&&On(t)?n.value=t:this.items[s]=t}toJSON(e,t){const s=[];t!=null&&t.onCreate&&t.onCreate(s);let n=0;for(const r of this.items)s.push(H(r,String(n++),t));return s}toString(e,t,s){return e?Bn(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:s,onComment:t}):JSON.stringify(this)}static from(e,t,s){const{replacer:n}=s,r=new this(e);if(t&&Symbol.iterator in Object(t)){let o=0;for(let a of t){if(typeof n=="function"){const l=t instanceof Set?a:String(o++);a=n.call(t,l,a)}r.items.push(gt(a,void 0,s))}}return r}}function Tt(i){let e=I(i)?i.value:i;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const nt={collection:"seq",default:!0,nodeClass:Oe,tag:"tag:yaml.org,2002:seq",resolve(i,e){return st(i)||e("Expected a sequence for this tag"),i},createNode:(i,e,t)=>Oe.from(i,e,t)},rs={identify:i=>typeof i=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:i=>i,stringify(i,e,t,s){return e=Object.assign({actualString:!0},e),kt(i,e,t,s)}},os={identify:i=>i==null,createNode:()=>new O(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new O(null),stringify:({source:i},e)=>typeof i=="string"&&os.test.test(i)?i:e.options.nullStr},Zs={identify:i=>typeof i=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:i=>new O(i[0]==="t"||i[0]==="T"),stringify({source:i,value:e},t){if(i&&Zs.test.test(i)){const s=i[0]==="t"||i[0]==="T";if(e===s)return i}return e?t.options.trueStr:t.options.falseStr}};function ae({format:i,minFractionDigits:e,tag:t,value:s}){if(typeof s=="bigint")return String(s);const n=typeof s=="number"?s:Number(s);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let r=JSON.stringify(s);if(!i&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let a=e-(r.length-o-1);for(;a-- >0;)r+="0"}return r}const Rn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:i=>i.slice(-3).toLowerCase()==="nan"?NaN:i[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ae},Pn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:i=>parseFloat(i),stringify(i){const e=Number(i.value);return isFinite(e)?e.toExponential():ae(i)}},Dn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(i){const e=new O(parseFloat(i)),t=i.indexOf(".");return t!==-1&&i[i.length-1]==="0"&&(e.minFractionDigits=i.length-t-1),e},stringify:ae},as=i=>typeof i=="bigint"||Number.isInteger(i),ei=(i,e,t,{intAsBigInt:s})=>s?BigInt(i):parseInt(i.substring(e),t);function qn(i,e,t){const{value:s}=i;return as(s)&&s>=0?t+s.toString(e):ae(i)}const $n={identify:i=>as(i)&&i>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(i,e,t)=>ei(i,2,8,t),stringify:i=>qn(i,8,"0o")},Fn={identify:as,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(i,e,t)=>ei(i,0,10,t),stringify:ae},Mn={identify:i=>as(i)&&i>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(i,e,t)=>ei(i,2,16,t),stringify:i=>qn(i,16,"0x")},Zo=[it,nt,rs,os,Zs,$n,Fn,Mn,Rn,Pn,Dn];function Ci(i){return typeof i=="bigint"||Number.isInteger(i)}const Ot=({value:i})=>JSON.stringify(i),ea=[{identify:i=>typeof i=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:i=>i,stringify:Ot},{identify:i=>i==null,createNode:()=>new O(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Ot},{identify:i=>typeof i=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:i=>i==="true",stringify:Ot},{identify:Ci,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(i,e,{intAsBigInt:t})=>t?BigInt(i):parseInt(i,10),stringify:({value:i})=>Ci(i)?i.toString():JSON.stringify(i)},{identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:i=>parseFloat(i),stringify:Ot}],ta={default:!0,tag:"",test:/^/,resolve(i,e){return e(`Unresolved plain scalar ${JSON.stringify(i)}`),i}},sa=[it,nt].concat(ea,ta),ti={identify:i=>i instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(i,e){if(typeof Buffer=="function")return Buffer.from(i,"base64");if(typeof atob=="function"){const t=atob(i.replace(/[\n\r]/g,"")),s=new Uint8Array(t.length);for(let n=0;n<t.length;++n)s[n]=t.charCodeAt(n);return s}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),i},stringify({comment:i,type:e,value:t},s,n,r){const o=t;let a;if(typeof Buffer=="function")a=o instanceof Buffer?o.toString("base64"):Buffer.from(o.buffer).toString("base64");else if(typeof btoa=="function"){let l="";for(let f=0;f<o.length;++f)l+=String.fromCharCode(o[f]);a=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e||(e=O.BLOCK_LITERAL),e!==O.QUOTE_DOUBLE){const l=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),f=Math.ceil(a.length/l),h=new Array(f);for(let u=0,d=0;u<f;++u,d+=l)h[u]=a.substr(d,l);a=h.join(e===O.BLOCK_LITERAL?`
`:" ")}return kt({comment:i,type:e,value:a},s,n,r)}};function jn(i,e){if(st(i))for(let t=0;t<i.items.length;++t){let s=i.items[t];if(!L(s)){if(tt(s)){s.items.length>1&&e("Each pair must have its own sequence indicator");const n=s.items[0]||new j(new O(null));if(s.commentBefore&&(n.key.commentBefore=n.key.commentBefore?`${s.commentBefore}
${n.key.commentBefore}`:s.commentBefore),s.comment){const r=n.value??n.key;r.comment=r.comment?`${s.comment}
${r.comment}`:s.comment}s=n}i.items[t]=L(s)?s:new j(s)}}else e("Expected a sequence for this tag");return i}function Kn(i,e,t){const{replacer:s}=t,n=new Oe(i);n.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof s=="function"&&(o=s.call(e,String(r++),o));let a,l;if(Array.isArray(o))if(o.length===2)a=o[0],l=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const f=Object.keys(o);if(f.length===1)a=f[0],l=o[a];else throw new TypeError(`Expected tuple with one key, not ${f.length} keys`)}else a=o;n.items.push(Xs(a,l,t))}return n}const si={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:jn,createNode:Kn};class Ye extends Oe{constructor(){super(),this.add=x.prototype.add.bind(this),this.delete=x.prototype.delete.bind(this),this.get=x.prototype.get.bind(this),this.has=x.prototype.has.bind(this),this.set=x.prototype.set.bind(this),this.tag=Ye.tag}toJSON(e,t){if(!t)return super.toJSON(e);const s=new Map;t!=null&&t.onCreate&&t.onCreate(s);for(const n of this.items){let r,o;if(L(n)?(r=H(n.key,"",t),o=H(n.value,r,t)):r=H(n,"",t),s.has(r))throw new Error("Ordered maps must not include duplicate keys");s.set(r,o)}return s}static from(e,t,s){const n=Kn(e,t,s),r=new this;return r.items=n.items,r}}Ye.tag="tag:yaml.org,2002:omap";const ii={collection:"seq",identify:i=>i instanceof Map,nodeClass:Ye,default:!1,tag:"tag:yaml.org,2002:omap",resolve(i,e){const t=jn(i,e),s=[];for(const{key:n}of t.items)I(n)&&(s.includes(n.value)?e(`Ordered maps must not include duplicate keys: ${n.value}`):s.push(n.value));return Object.assign(new Ye,t)},createNode:(i,e,t)=>Ye.from(i,e,t)};function Un({value:i,source:e},t){return e&&(i?Wn:Yn).test.test(e)?e:i?t.options.trueStr:t.options.falseStr}const Wn={identify:i=>i===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new O(!0),stringify:Un},Yn={identify:i=>i===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new O(!1),stringify:Un},ia={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:i=>i.slice(-3).toLowerCase()==="nan"?NaN:i[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ae},na={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:i=>parseFloat(i.replace(/_/g,"")),stringify(i){const e=Number(i.value);return isFinite(e)?e.toExponential():ae(i)}},ra={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(i){const e=new O(parseFloat(i.replace(/_/g,""))),t=i.indexOf(".");if(t!==-1){const s=i.substring(t+1).replace(/_/g,"");s[s.length-1]==="0"&&(e.minFractionDigits=s.length)}return e},stringify:ae},St=i=>typeof i=="bigint"||Number.isInteger(i);function ls(i,e,t,{intAsBigInt:s}){const n=i[0];if((n==="-"||n==="+")&&(e+=1),i=i.substring(e).replace(/_/g,""),s){switch(t){case 2:i=`0b${i}`;break;case 8:i=`0o${i}`;break;case 16:i=`0x${i}`;break}const o=BigInt(i);return n==="-"?BigInt(-1)*o:o}const r=parseInt(i,t);return n==="-"?-1*r:r}function ni(i,e,t){const{value:s}=i;if(St(s)){const n=s.toString(e);return s<0?"-"+t+n.substr(1):t+n}return ae(i)}const oa={identify:St,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(i,e,t)=>ls(i,2,2,t),stringify:i=>ni(i,2,"0b")},aa={identify:St,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(i,e,t)=>ls(i,1,8,t),stringify:i=>ni(i,8,"0")},la={identify:St,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(i,e,t)=>ls(i,0,10,t),stringify:ae},ca={identify:St,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(i,e,t)=>ls(i,2,16,t),stringify:i=>ni(i,16,"0x")};class xe extends x{constructor(e){super(e),this.tag=xe.tag}add(e){let t;L(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new j(e.key,null):t=new j(e,null),Ce(this.items,t.key)||this.items.push(t)}get(e,t){const s=Ce(this.items,e);return!t&&L(s)?I(s.key)?s.key.value:s.key:s}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const s=Ce(this.items,e);s&&!t?this.items.splice(this.items.indexOf(s),1):!s&&t&&this.items.push(new j(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,s){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,s);throw new Error("Set items must all have null values")}static from(e,t,s){const{replacer:n}=s,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let o of t)typeof n=="function"&&(o=n.call(t,o,o)),r.items.push(Xs(o,null,s));return r}}xe.tag="tag:yaml.org,2002:set";const ri={collection:"map",identify:i=>i instanceof Set,nodeClass:xe,default:!1,tag:"tag:yaml.org,2002:set",createNode:(i,e,t)=>xe.from(i,e,t),resolve(i,e){if(tt(i)){if(i.hasAllNullValues(!0))return Object.assign(new xe,i);e("Set items must all have null values")}else e("Expected a mapping for this tag");return i}};function oi(i,e){const t=i[0],s=t==="-"||t==="+"?i.substring(1):i,n=o=>e?BigInt(o):Number(o),r=s.replace(/_/g,"").split(":").reduce((o,a)=>o*n(60)+n(a),n(0));return t==="-"?n(-1)*r:r}function xn(i){let{value:e}=i,t=o=>o;if(typeof e=="bigint")t=o=>BigInt(o);else if(isNaN(e)||!isFinite(e))return ae(i);let s="";e<0&&(s="-",e*=t(-1));const n=t(60),r=[e%n];return e<60?r.unshift(0):(e=(e-r[0])/n,r.unshift(e%n),e>=60&&(e=(e-r[0])/n,r.unshift(e))),s+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Vn={identify:i=>typeof i=="bigint"||Number.isInteger(i),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(i,e,{intAsBigInt:t})=>oi(i,t),stringify:xn},zn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:i=>oi(i,!1),stringify:xn},cs={identify:i=>i instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(i){const e=i.match(cs.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,s,n,r,o,a]=e.map(Number),l=e[7]?Number((e[7]+"00").substr(1,3)):0;let f=Date.UTC(t,s-1,n,r||0,o||0,a||0,l);const h=e[8];if(h&&h!=="Z"){let u=oi(h,!1);Math.abs(u)<30&&(u*=60),f-=6e4*u}return new Date(f)},stringify:({value:i})=>i.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")},Ii=[it,nt,rs,os,Wn,Yn,oa,aa,la,ca,ia,na,ra,ti,ii,si,ri,Vn,zn,cs],Li=new Map([["core",Zo],["failsafe",[it,nt,rs]],["json",sa],["yaml11",Ii],["yaml-1.1",Ii]]),Bi={binary:ti,bool:Zs,float:Dn,floatExp:Pn,floatNaN:Rn,floatTime:zn,int:Fn,intHex:Mn,intOct:$n,intTime:Vn,map:it,null:os,omap:ii,pairs:si,seq:nt,set:ri,timestamp:cs},fa={"tag:yaml.org,2002:binary":ti,"tag:yaml.org,2002:omap":ii,"tag:yaml.org,2002:pairs":si,"tag:yaml.org,2002:set":ri,"tag:yaml.org,2002:timestamp":cs};function ks(i,e){let t=Li.get(e);if(!t)if(Array.isArray(i))t=[];else{const s=Array.from(Li.keys()).filter(n=>n!=="yaml11").map(n=>JSON.stringify(n)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${s} or define customTags array`)}if(Array.isArray(i))for(const s of i)t=t.concat(s);else typeof i=="function"&&(t=i(t.slice()));return t.map(s=>{if(typeof s!="string")return s;const n=Bi[s];if(n)return n;const r=Object.keys(Bi).map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown custom tag "${s}"; use one of ${r}`)})}const ua=(i,e)=>i.key<e.key?-1:i.key>e.key?1:0;class fs{constructor({compat:e,customTags:t,merge:s,resolveKnownTags:n,schema:r,sortMapEntries:o,toStringDefaults:a}){this.compat=Array.isArray(e)?ks(e,"compat"):e?ks(null,e):null,this.merge=!!s,this.name=typeof r=="string"&&r||"core",this.knownTags=n?fa:{},this.tags=ks(t,this.name),this.toStringOptions=a??null,Object.defineProperty(this,Ae,{value:it}),Object.defineProperty(this,ye,{value:rs}),Object.defineProperty(this,Ze,{value:nt}),this.sortMapEntries=typeof o=="function"?o:o===!0?ua:null}clone(){const e=Object.create(fs.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function ha(i,e){var l;const t=[];let s=e.directives===!0;if(e.directives!==!1&&i.directives){const f=i.directives.toString(i);f?(t.push(f),s=!0):i.directives.docStart&&(s=!0)}s&&t.push("---");const n=Cn(i,e),{commentString:r}=n.options;if(i.commentBefore){t.length!==1&&t.unshift("");const f=r(i.commentBefore);t.unshift(ge(f,""))}let o=!1,a=null;if(i.contents){if(R(i.contents)){if(i.contents.spaceBefore&&s&&t.push(""),i.contents.commentBefore){const u=r(i.contents.commentBefore);t.push(ge(u,""))}n.forceBlockIndent=!!i.comment,a=i.contents.comment}const f=a?void 0:()=>o=!0;let h=Qe(i.contents,n,()=>a=null,f);a&&(h+=Ne(h,"",r(a))),(h[0]==="|"||h[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${h}`:t.push(h)}else t.push(Qe(i.contents,n));if((l=i.directives)!=null&&l.docEnd)if(i.comment){const f=r(i.comment);f.includes(`
`)?(t.push("..."),t.push(ge(f,""))):t.push(`... ${f}`)}else t.push("...");else{let f=i.comment;f&&o&&(f=f.replace(/^\n+/,"")),f&&((!o||a)&&t[t.length-1]!==""&&t.push(""),t.push(ge(r(f),"")))}return t.join(`
`)+`
`}class rt{constructor(e,t,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,Q,{value:qs});let n=null;typeof t=="function"||Array.isArray(t)?n=t:s===void 0&&t&&(s=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},s);this.options=r;let{version:o}=r;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new K({version:o}),this.setSchema(o,s),this.contents=e===void 0?null:this.createNode(e,n,s)}clone(){const e=Object.create(rt.prototype,{[Q]:{value:qs}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=R(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Pe(this.contents)&&this.contents.add(e)}addIn(e,t){Pe(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const s=An(this);e.anchor=!t||s.has(t)?Tn(t||"a",s):t}return new ts(e.anchor)}createNode(e,t,s){let n;if(typeof t=="function")e=t.call({"":e},"",e),n=t;else if(Array.isArray(t)){const g=k=>typeof k=="number"||k instanceof String||k instanceof Number,w=t.filter(g).map(String);w.length>0&&(t=t.concat(w)),n=t}else s===void 0&&t&&(s=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:a,keepUndefined:l,onTagObj:f,tag:h}=s??{},{onAnchor:u,setAnchors:d,sourceObjects:m}=jo(this,o||"a"),b={aliasDuplicateObjects:r??!0,keepUndefined:l??!1,onAnchor:u,onTagObj:f,replacer:n,schema:this.schema,sourceObjects:m},p=gt(e,h,b);return a&&B(p)&&(p.flow=!0),d(),p}createPair(e,t,s={}){const n=this.createNode(e,null,s),r=this.createNode(t,null,s);return new j(n,r)}delete(e){return Pe(this.contents)?this.contents.delete(e):!1}deleteIn(e){return ft(e)?this.contents==null?!1:(this.contents=null,!0):Pe(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return B(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return ft(e)?!t&&I(this.contents)?this.contents.value:this.contents:B(this.contents)?this.contents.getIn(e,t):void 0}has(e){return B(this.contents)?this.contents.has(e):!1}hasIn(e){return ft(e)?this.contents!==void 0:B(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=Wt(this.schema,[e],t):Pe(this.contents)&&this.contents.set(e,t)}setIn(e,t){ft(e)?this.contents=t:this.contents==null?this.contents=Wt(this.schema,Array.from(e),t):Pe(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let s;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new K({version:"1.1"}),s={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new K({version:e}),s={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{const n=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(s)this.schema=new fs(Object.assign(s,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:s,maxAliasCount:n,onAnchor:r,reviver:o}={}){const a={anchors:new Map,doc:this,keep:!e,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=H(this.contents,t??"",a);if(typeof r=="function")for(const{count:f,res:h}of a.anchors.values())r(h,f);return typeof o=="function"?Ke(o,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return ha(this,e)}}function Pe(i){if(B(i))return!0;throw new Error("Expected a YAML collection as document contents")}class ai extends Error{constructor(e,t,s,n){super(),this.name=e,this.code=s,this.message=n,this.pos=t}}class Ie extends ai{constructor(e,t,s){super("YAMLParseError",e,t,s)}}class Jn extends ai{constructor(e,t,s){super("YAMLWarning",e,t,s)}}const xt=(i,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(a=>e.linePos(a));const{line:s,col:n}=t.linePos[0];t.message+=` at line ${s}, column ${n}`;let r=n-1,o=i.substring(e.lineStarts[s-1],e.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){const a=Math.min(r-39,o.length-79);o=""+o.substring(a),r-=a-1}if(o.length>80&&(o=o.substring(0,79)+""),s>1&&/^ *$/.test(o.substring(0,r))){let a=i.substring(e.lineStarts[s-2],e.lineStarts[s-1]);a.length>80&&(a=a.substring(0,79)+`
`),o=a+o}if(/[^ ]/.test(o)){let a=1;const l=t.linePos[1];l&&l.line===s&&l.col>n&&(a=Math.max(1,Math.min(l.col-n,80-r)));const f=" ".repeat(r)+"^".repeat(a);t.message+=`:

${o}
${f}
`}};function Ge(i,{flow:e,indicator:t,next:s,offset:n,onError:r,parentIndent:o,startOnNewline:a}){let l=!1,f=a,h=a,u="",d="",m=!1,b=!1,p=null,g=null,w=null,k=null,_=null,A=null,T=null;for(const v of i)switch(b&&(v.type!=="space"&&v.type!=="newline"&&v.type!=="comma"&&r(v.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),b=!1),p&&(f&&v.type!=="comment"&&v.type!=="newline"&&r(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),p=null),v.type){case"space":!e&&(t!=="doc-start"||(s==null?void 0:s.type)!=="flow-collection")&&v.source.includes("	")&&(p=v),h=!0;break;case"comment":{h||r(v,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const q=v.source.substring(1)||" ";u?u+=d+q:u=q,d="",f=!1;break}case"newline":f?u?u+=v.source:l=!0:d+=v.source,f=!0,m=!0,(g||w)&&(k=v),h=!0;break;case"anchor":g&&r(v,"MULTIPLE_ANCHORS","A node can have at most one anchor"),v.source.endsWith(":")&&r(v.offset+v.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=v,T===null&&(T=v.offset),f=!1,h=!1,b=!0;break;case"tag":{w&&r(v,"MULTIPLE_TAGS","A node can have at most one tag"),w=v,T===null&&(T=v.offset),f=!1,h=!1,b=!0;break}case t:(g||w)&&r(v,"BAD_PROP_ORDER",`Anchors and tags must be after the ${v.source} indicator`),A&&r(v,"UNEXPECTED_TOKEN",`Unexpected ${v.source} in ${e??"collection"}`),A=v,f=t==="seq-item-ind"||t==="explicit-key-ind",h=!1;break;case"comma":if(e){_&&r(v,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),_=v,f=!1,h=!1;break}default:r(v,"UNEXPECTED_TOKEN",`Unexpected ${v.type} token`),f=!1,h=!1}const S=i[i.length-1],C=S?S.offset+S.source.length:n;return b&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p&&(f&&p.indent<=o||(s==null?void 0:s.type)==="block-map"||(s==null?void 0:s.type)==="block-seq")&&r(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:_,found:A,spaceBefore:l,comment:u,hasNewline:m,anchor:g,tag:w,newlineAfterProp:k,end:C,start:T??C}}function yt(i){if(!i)return null;switch(i.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(i.source.includes(`
`))return!0;if(i.end){for(const e of i.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of i.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(yt(e.key)||yt(e.value))return!0}return!1;default:return!0}}function js(i,e,t){if((e==null?void 0:e.type)==="flow-collection"){const s=e.end[0];s.indent===i&&(s.source==="]"||s.source==="}")&&yt(e)&&t(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Hn(i,e,t){const{uniqueKeys:s}=i.options;if(s===!1)return!1;const n=typeof s=="function"?s:(r,o)=>r===o||I(r)&&I(o)&&r.value===o.value&&!(r.value==="<<"&&i.schema.merge);return e.some(r=>n(r.key,t))}const Ri="All mapping items must start at the same column";function da({composeNode:i,composeEmptyNode:e},t,s,n,r){var h;const o=(r==null?void 0:r.nodeClass)??x,a=new o(t.schema);t.atRoot&&(t.atRoot=!1);let l=s.offset,f=null;for(const u of s.items){const{start:d,key:m,sep:b,value:p}=u,g=Ge(d,{indicator:"explicit-key-ind",next:m??(b==null?void 0:b[0]),offset:l,onError:n,parentIndent:s.indent,startOnNewline:!0}),w=!g.found;if(w){if(m&&(m.type==="block-seq"?n(l,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in m&&m.indent!==s.indent&&n(l,"BAD_INDENT",Ri)),!g.anchor&&!g.tag&&!b){f=g.end,g.comment&&(a.comment?a.comment+=`
`+g.comment:a.comment=g.comment);continue}(g.newlineAfterProp||yt(m))&&n(m??d[d.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((h=g.found)==null?void 0:h.indent)!==s.indent&&n(l,"BAD_INDENT",Ri);const k=g.end,_=m?i(t,m,g,n):e(t,k,d,null,g,n);t.schema.compat&&js(s.indent,m,n),Hn(t,a.items,_)&&n(k,"DUPLICATE_KEY","Map keys must be unique");const A=Ge(b??[],{indicator:"map-value-ind",next:p,offset:_.range[2],onError:n,parentIndent:s.indent,startOnNewline:!m||m.type==="block-scalar"});if(l=A.end,A.found){w&&((p==null?void 0:p.type)==="block-map"&&!A.hasNewline&&n(l,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&g.start<A.found.offset-1024&&n(_.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const T=p?i(t,p,A,n):e(t,l,b,null,A,n);t.schema.compat&&js(s.indent,p,n),l=T.range[2];const S=new j(_,T);t.options.keepSourceTokens&&(S.srcToken=u),a.items.push(S)}else{w&&n(_.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),A.comment&&(_.comment?_.comment+=`
`+A.comment:_.comment=A.comment);const T=new j(_);t.options.keepSourceTokens&&(T.srcToken=u),a.items.push(T)}}return f&&f<l&&n(f,"IMPOSSIBLE","Map comment with trailing content"),a.range=[s.offset,l,f??l],a}function pa({composeNode:i,composeEmptyNode:e},t,s,n,r){const o=(r==null?void 0:r.nodeClass)??Oe,a=new o(t.schema);t.atRoot&&(t.atRoot=!1);let l=s.offset,f=null;for(const{start:h,value:u}of s.items){const d=Ge(h,{indicator:"seq-item-ind",next:u,offset:l,onError:n,parentIndent:s.indent,startOnNewline:!0});if(!d.found)if(d.anchor||d.tag||u)u&&u.type==="block-seq"?n(d.end,"BAD_INDENT","All sequence items must start at the same column"):n(l,"MISSING_CHAR","Sequence item without - indicator");else{f=d.end,d.comment&&(a.comment=d.comment);continue}const m=u?i(t,u,d,n):e(t,d.end,h,null,d,n);t.schema.compat&&js(s.indent,u,n),l=m.range[2],a.items.push(m)}return a.range=[s.offset,l,f??l],a}function vt(i,e,t,s){let n="";if(i){let r=!1,o="";for(const a of i){const{source:l,type:f}=a;switch(f){case"space":r=!0;break;case"comment":{t&&!r&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const h=l.substring(1)||" ";n?n+=o+h:n=h,o="";break}case"newline":n&&(o+=l),r=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${f} at node end`)}e+=l.length}}return{comment:n,offset:e}}const Ss="Block collections are not allowed within flow collections",vs=i=>i&&(i.type==="block-map"||i.type==="block-seq");function ma({composeNode:i,composeEmptyNode:e},t,s,n,r){const o=s.start.source==="{",a=o?"flow map":"flow sequence",l=(r==null?void 0:r.nodeClass)??(o?x:Oe),f=new l(t.schema);f.flow=!0;const h=t.atRoot;h&&(t.atRoot=!1);let u=s.offset+s.start.source.length;for(let g=0;g<s.items.length;++g){const w=s.items[g],{start:k,key:_,sep:A,value:T}=w,S=Ge(k,{flow:a,indicator:"explicit-key-ind",next:_??(A==null?void 0:A[0]),offset:u,onError:n,parentIndent:s.indent,startOnNewline:!1});if(!S.found){if(!S.anchor&&!S.tag&&!A&&!T){g===0&&S.comma?n(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):g<s.items.length-1&&n(S.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),S.comment&&(f.comment?f.comment+=`
`+S.comment:f.comment=S.comment),u=S.end;continue}!o&&t.options.strict&&yt(_)&&n(_,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(g===0)S.comma&&n(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(S.comma||n(S.start,"MISSING_CHAR",`Missing , between ${a} items`),S.comment){let C="";e:for(const v of k)switch(v.type){case"comma":case"space":break;case"comment":C=v.source.substring(1);break e;default:break e}if(C){let v=f.items[f.items.length-1];L(v)&&(v=v.value??v.key),v.comment?v.comment+=`
`+C:v.comment=C,S.comment=S.comment.substring(C.length+1)}}if(!o&&!A&&!S.found){const C=T?i(t,T,S,n):e(t,S.end,A,null,S,n);f.items.push(C),u=C.range[2],vs(T)&&n(C.range,"BLOCK_IN_FLOW",Ss)}else{const C=S.end,v=_?i(t,_,S,n):e(t,C,k,null,S,n);vs(_)&&n(v.range,"BLOCK_IN_FLOW",Ss);const q=Ge(A??[],{flow:a,indicator:"map-value-ind",next:T,offset:v.range[2],onError:n,parentIndent:s.indent,startOnNewline:!1});if(q.found){if(!o&&!S.found&&t.options.strict){if(A)for(const $ of A){if($===q.found)break;if($.type==="newline"){n($,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}S.start<q.found.offset-1024&&n(q.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else T&&("source"in T&&T.source&&T.source[0]===":"?n(T,"MISSING_CHAR",`Missing space after : in ${a}`):n(q.start,"MISSING_CHAR",`Missing , or : between ${a} items`));const we=T?i(t,T,q,n):q.found?e(t,q.end,A,null,q,n):null;we?vs(T)&&n(we.range,"BLOCK_IN_FLOW",Ss):q.comment&&(v.comment?v.comment+=`
`+q.comment:v.comment=q.comment);const Re=new j(v,we);if(t.options.keepSourceTokens&&(Re.srcToken=w),o){const $=f;Hn(t,$.items,v)&&n(C,"DUPLICATE_KEY","Map keys must be unique"),$.items.push(Re)}else{const $=new x(t.schema);$.flow=!0,$.items.push(Re);const di=(we??v).range;$.range=[v.range[0],di[1],di[2]],f.items.push($)}u=we?we.range[2]:q.end}}const d=o?"}":"]",[m,...b]=s.end;let p=u;if(m&&m.source===d)p=m.offset+m.source.length;else{const g=a[0].toUpperCase()+a.substring(1),w=h?`${g} must end with a ${d}`:`${g} in block collection must be sufficiently indented and end with a ${d}`;n(u,h?"MISSING_CHAR":"BAD_INDENT",w),m&&m.source.length!==1&&b.unshift(m)}if(b.length>0){const g=vt(b,p,t.options.strict,n);g.comment&&(f.comment?f.comment+=`
`+g.comment:f.comment=g.comment),f.range=[s.offset,p,g.offset]}else f.range=[s.offset,p,p];return f}function _s(i,e,t,s,n,r){const o=t.type==="block-map"?da(i,e,t,s,r):t.type==="block-seq"?pa(i,e,t,s,r):ma(i,e,t,s,r),a=o.constructor;return n==="!"||n===a.tagName?(o.tag=a.tagName,o):(n&&(o.tag=n),o)}function ga(i,e,t,s,n){var d;const r=s.tag,o=r?e.directives.tagName(r.source,m=>n(r,"TAG_RESOLVE_FAILED",m)):null;if(t.type==="block-seq"){const{anchor:m,newlineAfterProp:b}=s,p=m&&r?m.offset>r.offset?m:r:m??r;p&&(!b||b.offset<p.offset)&&n(p,"MISSING_CHAR","Missing newline after block sequence props")}const a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!o||o==="!"||o===x.tagName&&a==="map"||o===Oe.tagName&&a==="seq")return _s(i,e,t,n,o);let l=e.schema.tags.find(m=>m.tag===o&&m.collection===a);if(!l){const m=e.schema.knownTags[o];if(m&&m.collection===a)e.schema.tags.push(Object.assign({},m,{default:!1})),l=m;else return m!=null&&m.collection?n(r,"BAD_COLLECTION_TYPE",`${m.tag} used for ${a} collection, but expects ${m.collection}`,!0):n(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),_s(i,e,t,n,o)}const f=_s(i,e,t,n,o,l),h=((d=l.resolve)==null?void 0:d.call(l,f,m=>n(r,"TAG_RESOLVE_FAILED",m),e.options))??f,u=R(h)?h:new O(h);return u.range=f.range,u.tag=o,l!=null&&l.format&&(u.format=l.format),u}function Qn(i,e,t){const s=e.offset,n=ya(e,i.options.strict,t);if(!n)return{value:"",type:null,comment:"",range:[s,s,s]};const r=n.mode===">"?O.BLOCK_FOLDED:O.BLOCK_LITERAL,o=e.source?ba(e.source):[];let a=o.length;for(let p=o.length-1;p>=0;--p){const g=o[p][1];if(g===""||g==="\r")a=p;else break}if(a===0){const p=n.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let g=s+n.length;return e.source&&(g+=e.source.length),{value:p,type:r,comment:n.comment,range:[s,g,g]}}let l=e.indent+n.indent,f=e.offset+n.length,h=0;for(let p=0;p<a;++p){const[g,w]=o[p];if(w===""||w==="\r")n.indent===0&&g.length>l&&(l=g.length);else{g.length<l&&t(f+g.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(l=g.length),h=p,l===0&&!i.atRoot&&t(f,"BAD_INDENT","Block scalar values in collections must be indented");break}f+=g.length+w.length+1}for(let p=o.length-1;p>=a;--p)o[p][0].length>l&&(a=p+1);let u="",d="",m=!1;for(let p=0;p<h;++p)u+=o[p][0].slice(l)+`
`;for(let p=h;p<a;++p){let[g,w]=o[p];f+=g.length+w.length+1;const k=w[w.length-1]==="\r";if(k&&(w=w.slice(0,-1)),w&&g.length<l){const A=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;t(f-w.length-(k?2:1),"BAD_INDENT",A),g=""}r===O.BLOCK_LITERAL?(u+=d+g.slice(l)+w,d=`
`):g.length>l||w[0]==="	"?(d===" "?d=`
`:!m&&d===`
`&&(d=`

`),u+=d+g.slice(l)+w,d=`
`,m=!0):w===""?d===`
`?u+=`
`:d=`
`:(u+=d+w,d=" ",m=!1)}switch(n.chomp){case"-":break;case"+":for(let p=a;p<o.length;++p)u+=`
`+o[p][0].slice(l);u[u.length-1]!==`
`&&(u+=`
`);break;default:u+=`
`}const b=s+n.length+e.source.length;return{value:u,type:r,comment:n.comment,range:[s,b,b]}}function ya({offset:i,props:e},t,s){if(e[0].type!=="block-scalar-header")return s(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:n}=e[0],r=n[0];let o=0,a="",l=-1;for(let d=1;d<n.length;++d){const m=n[d];if(!a&&(m==="-"||m==="+"))a=m;else{const b=Number(m);!o&&b?o=b:l===-1&&(l=i+d)}}l!==-1&&s(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let f=!1,h="",u=n.length;for(let d=1;d<e.length;++d){const m=e[d];switch(m.type){case"space":f=!0;case"newline":u+=m.source.length;break;case"comment":t&&!f&&s(m,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),u+=m.source.length,h=m.source.substring(1);break;case"error":s(m,"UNEXPECTED_TOKEN",m.message),u+=m.source.length;break;default:{const b=`Unexpected token in block scalar header: ${m.type}`;s(m,"UNEXPECTED_TOKEN",b);const p=m.source;p&&typeof p=="string"&&(u+=p.length)}}}return{mode:r,indent:o,chomp:a,comment:h,length:u}}function ba(i){const e=i.split(/\n( *)/),t=e[0],s=t.match(/^( *)/),r=[s!=null&&s[1]?[s[1],t.slice(s[1].length)]:["",t]];for(let o=1;o<e.length;o+=2)r.push([e[o],e[o+1]]);return r}function Gn(i,e,t){const{offset:s,type:n,source:r,end:o}=i;let a,l;const f=(d,m,b)=>t(s+d,m,b);switch(n){case"scalar":a=O.PLAIN,l=wa(r,f);break;case"single-quoted-scalar":a=O.QUOTE_SINGLE,l=ka(r,f);break;case"double-quoted-scalar":a=O.QUOTE_DOUBLE,l=Sa(r,f);break;default:return t(i,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[s,s+r.length,s+r.length]}}const h=s+r.length,u=vt(o,h,e,t);return{value:l,type:a,comment:u.comment,range:[s,h,u.offset]}}function wa(i,e){let t="";switch(i[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${i[0]}`;break}case"@":case"`":{t=`reserved character ${i[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),Xn(i)}function ka(i,e){return(i[i.length-1]!=="'"||i.length===1)&&e(i.length,"MISSING_CHAR","Missing closing 'quote"),Xn(i.slice(1,-1)).replace(/''/g,"'")}function Xn(i){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=e.exec(i);if(!s)return i;let n=s[1],r=" ",o=e.lastIndex;for(t.lastIndex=o;s=t.exec(i);)s[1]===""?r===`
`?n+=r:r=`
`:(n+=r+s[1],r=" "),o=t.lastIndex;const a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(i),n+r+((s==null?void 0:s[1])??"")}function Sa(i,e){let t="";for(let s=1;s<i.length-1;++s){const n=i[s];if(!(n==="\r"&&i[s+1]===`
`))if(n===`
`){const{fold:r,offset:o}=va(i,s);t+=r,s=o}else if(n==="\\"){let r=i[++s];const o=_a[r];if(o)t+=o;else if(r===`
`)for(r=i[s+1];r===" "||r==="	";)r=i[++s+1];else if(r==="\r"&&i[s+1]===`
`)for(r=i[++s+1];r===" "||r==="	";)r=i[++s+1];else if(r==="x"||r==="u"||r==="U"){const a={x:2,u:4,U:8}[r];t+=Aa(i,s+1,a,e),s+=a}else{const a=i.substr(s-1,2);e(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),t+=a}}else if(n===" "||n==="	"){const r=s;let o=i[s+1];for(;o===" "||o==="	";)o=i[++s+1];o!==`
`&&!(o==="\r"&&i[s+2]===`
`)&&(t+=s>r?i.slice(r,s+1):n)}else t+=n}return(i[i.length-1]!=='"'||i.length===1)&&e(i.length,"MISSING_CHAR",'Missing closing "quote'),t}function va(i,e){let t="",s=i[e+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&i[e+2]!==`
`);)s===`
`&&(t+=`
`),e+=1,s=i[e+1];return t||(t=" "),{fold:t,offset:e}}const _a={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Aa(i,e,t,s){const n=i.substr(e,t),o=n.length===t&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(o)){const a=i.substr(e-2,t+2);return s(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(o)}function Zn(i,e,t,s){const{value:n,type:r,comment:o,range:a}=e.type==="block-scalar"?Qn(i,e,s):Gn(e,i.options.strict,s),l=t?i.directives.tagName(t.source,u=>s(t,"TAG_RESOLVE_FAILED",u)):null,f=t&&l?Ta(i.schema,n,l,t,s):e.type==="scalar"?Oa(i,n,e,s):i.schema[ye];let h;try{const u=f.resolve(n,d=>s(t??e,"TAG_RESOLVE_FAILED",d),i.options);h=I(u)?u:new O(u)}catch(u){const d=u instanceof Error?u.message:String(u);s(t??e,"TAG_RESOLVE_FAILED",d),h=new O(n)}return h.range=a,h.source=n,r&&(h.type=r),l&&(h.tag=l),f.format&&(h.format=f.format),o&&(h.comment=o),h}function Ta(i,e,t,s,n){var a;if(t==="!")return i[ye];const r=[];for(const l of i.tags)if(!l.collection&&l.tag===t)if(l.default&&l.test)r.push(l);else return l;for(const l of r)if((a=l.test)!=null&&a.test(e))return l;const o=i.knownTags[t];return o&&!o.collection?(i.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),i[ye])}function Oa({directives:i,schema:e},t,s,n){const r=e.tags.find(o=>{var a;return o.default&&((a=o.test)==null?void 0:a.test(t))})||e[ye];if(e.compat){const o=e.compat.find(a=>{var l;return a.default&&((l=a.test)==null?void 0:l.test(t))})??e[ye];if(r.tag!==o.tag){const a=i.tagString(r.tag),l=i.tagString(o.tag),f=`Value may be parsed as either ${a} or ${l}`;n(s,"TAG_RESOLVE_FAILED",f,!0)}}return r}function Ea(i,e,t){if(e){t===null&&(t=e.length);for(let s=t-1;s>=0;--s){let n=e[s];switch(n.type){case"space":case"comment":case"newline":i-=n.source.length;continue}for(n=e[++s];(n==null?void 0:n.type)==="space";)i+=n.source.length,n=e[++s];break}}return i}const Na={composeNode:er,composeEmptyNode:li};function er(i,e,t,s){const{spaceBefore:n,comment:r,anchor:o,tag:a}=t;let l,f=!0;switch(e.type){case"alias":l=Ca(i,e,s),(o||a)&&s(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=Zn(i,e,a,s),o&&(l.anchor=o.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=ga(Na,i,e,t,s),o&&(l.anchor=o.source.substring(1));break;default:{const h=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;s(e,"UNEXPECTED_TOKEN",h),l=li(i,e.offset,void 0,null,t,s),f=!1}}return o&&l.anchor===""&&s(o,"BAD_ALIAS","Anchor cannot be an empty string"),n&&(l.spaceBefore=!0),r&&(e.type==="scalar"&&e.source===""?l.comment=r:l.commentBefore=r),i.options.keepSourceTokens&&f&&(l.srcToken=e),l}function li(i,e,t,s,{spaceBefore:n,comment:r,anchor:o,tag:a,end:l},f){const h={type:"scalar",offset:Ea(e,t,s),indent:-1,source:""},u=Zn(i,h,a,f);return o&&(u.anchor=o.source.substring(1),u.anchor===""&&f(o,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(u.spaceBefore=!0),r&&(u.comment=r,u.range[2]=l),u}function Ca({options:i},{offset:e,source:t,end:s},n){const r=new ts(t.substring(1));r.source===""&&n(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&n(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=e+t.length,a=vt(s,o,i.strict,n);return r.range=[e,o,a.offset],a.comment&&(r.comment=a.comment),r}function Ia(i,e,{offset:t,start:s,value:n,end:r},o){const a=Object.assign({_directives:e},i),l=new rt(void 0,a),f={atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},h=Ge(s,{indicator:"doc-start",next:n??(r==null?void 0:r[0]),offset:t,onError:o,parentIndent:0,startOnNewline:!0});h.found&&(l.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!h.hasNewline&&o(h.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?er(f,n,h,o):li(f,h.end,s,null,h,o);const u=l.contents.range[2],d=vt(r,u,!1,o);return d.comment&&(l.comment=d.comment),l.range=[t,u,d.offset],l}function lt(i){if(typeof i=="number")return[i,i+1];if(Array.isArray(i))return i.length===2?i:[i[0],i[1]];const{offset:e,source:t}=i;return[e,e+(typeof t=="string"?t.length:1)]}function Pi(i){var n;let e="",t=!1,s=!1;for(let r=0;r<i.length;++r){const o=i[r];switch(o[0]){case"#":e+=(e===""?"":s?`

`:`
`)+(o.substring(1)||" "),t=!0,s=!1;break;case"%":((n=i[r+1])==null?void 0:n[0])!=="#"&&(r+=1),t=!1;break;default:t||(s=!0),t=!1}}return{comment:e,afterEmptyLine:s}}class ci{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,s,n,r)=>{const o=lt(t);r?this.warnings.push(new Jn(o,s,n)):this.errors.push(new Ie(o,s,n))},this.directives=new K({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:s,afterEmptyLine:n}=Pi(this.prelude);if(s){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${s}`:s;else if(n||e.directives.docStart||!r)e.commentBefore=s;else if(B(r)&&!r.flow&&r.items.length>0){let o=r.items[0];L(o)&&(o=o.key);const a=o.commentBefore;o.commentBefore=a?`${s}
${a}`:s}else{const o=r.commentBefore;r.commentBefore=o?`${s}
${o}`:s}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Pi(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,s=-1){for(const n of e)yield*this.next(n);yield*this.end(t,s)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,s,n)=>{const r=lt(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",s,n)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=Ia(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,s=new Ie(lt(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){const s="Unexpected doc-end without preceding document";this.errors.push(new Ie(lt(e),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;const t=vt(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const s=this.doc.comment;this.doc.comment=s?`${s}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new Ie(lt(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const s=Object.assign({_directives:this.directives},this.options),n=new rt(void 0,s);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}function La(i,e=!0,t){if(i){const s=(n,r,o)=>{const a=typeof n=="number"?n:Array.isArray(n)?n[0]:n.offset;if(t)t(a,r,o);else throw new Ie([a,a+1],r,o)};switch(i.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Gn(i,e,s);case"block-scalar":return Qn({options:{strict:e}},i,s)}}return null}function Ba(i,e){const{implicitKey:t=!1,indent:s,inFlow:n=!1,offset:r=-1,type:o="PLAIN"}=e,a=kt({type:o,value:i},{implicitKey:t,indent:s>0?" ".repeat(s):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}}),l=e.end??[{type:"newline",offset:-1,indent:s,source:`
`}];switch(a[0]){case"|":case">":{const f=a.indexOf(`
`),h=a.substring(0,f),u=a.substring(f+1)+`
`,d=[{type:"block-scalar-header",offset:r,indent:s,source:h}];return tr(d,l)||d.push({type:"newline",offset:-1,indent:s,source:`
`}),{type:"block-scalar",offset:r,indent:s,props:d,source:u}}case'"':return{type:"double-quoted-scalar",offset:r,indent:s,source:a,end:l};case"'":return{type:"single-quoted-scalar",offset:r,indent:s,source:a,end:l};default:return{type:"scalar",offset:r,indent:s,source:a,end:l}}}function Ra(i,e,t={}){let{afterKey:s=!1,implicitKey:n=!1,inFlow:r=!1,type:o}=t,a="indent"in i?i.indent:null;if(s&&typeof a=="number"&&(a+=2),!o)switch(i.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const f=i.props[0];if(f.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=f.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const l=kt({type:o,value:e},{implicitKey:n||a===null,indent:a!==null&&a>0?" ".repeat(a):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":Pa(i,l);break;case'"':As(i,l,"double-quoted-scalar");break;case"'":As(i,l,"single-quoted-scalar");break;default:As(i,l,"scalar")}}function Pa(i,e){const t=e.indexOf(`
`),s=e.substring(0,t),n=e.substring(t+1)+`
`;if(i.type==="block-scalar"){const r=i.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=s,i.source=n}else{const{offset:r}=i,o="indent"in i?i.indent:-1,a=[{type:"block-scalar-header",offset:r,indent:o,source:s}];tr(a,"end"in i?i.end:void 0)||a.push({type:"newline",offset:-1,indent:o,source:`
`});for(const l of Object.keys(i))l!=="type"&&l!=="offset"&&delete i[l];Object.assign(i,{type:"block-scalar",indent:o,props:a,source:n})}}function tr(i,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":i.push(t);break;case"newline":return i.push(t),!0}return!1}function As(i,e,t){switch(i.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":i.type=t,i.source=e;break;case"block-scalar":{const s=i.props.slice(1);let n=e.length;i.props[0].type==="block-scalar-header"&&(n-=i.props[0].source.length);for(const r of s)r.offset+=n;delete i.props,Object.assign(i,{type:t,source:e,end:s});break}case"block-map":case"block-seq":{const n={type:"newline",offset:i.offset+e.length,indent:i.indent,source:`
`};delete i.items,Object.assign(i,{type:t,source:e,end:[n]});break}default:{const s="indent"in i?i.indent:-1,n="end"in i&&Array.isArray(i.end)?i.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(const r of Object.keys(i))r!=="type"&&r!=="offset"&&delete i[r];Object.assign(i,{type:t,indent:s,source:e,end:n})}}}const Da=i=>"type"in i?Vt(i):Dt(i);function Vt(i){switch(i.type){case"block-scalar":{let e="";for(const t of i.props)e+=Vt(t);return e+i.source}case"block-map":case"block-seq":{let e="";for(const t of i.items)e+=Dt(t);return e}case"flow-collection":{let e=i.start.source;for(const t of i.items)e+=Dt(t);for(const t of i.end)e+=t.source;return e}case"document":{let e=Dt(i);if(i.end)for(const t of i.end)e+=t.source;return e}default:{let e=i.source;if("end"in i&&i.end)for(const t of i.end)e+=t.source;return e}}}function Dt({start:i,key:e,sep:t,value:s}){let n="";for(const r of i)n+=r.source;if(e&&(n+=Vt(e)),t)for(const r of t)n+=r.source;return s&&(n+=Vt(s)),n}const Ks=Symbol("break visit"),qa=Symbol("skip children"),sr=Symbol("remove item");function Le(i,e){"type"in i&&i.type==="document"&&(i={start:i.start,value:i.value}),ir(Object.freeze([]),i,e)}Le.BREAK=Ks;Le.SKIP=qa;Le.REMOVE=sr;Le.itemAtPath=(i,e)=>{let t=i;for(const[s,n]of e){const r=t==null?void 0:t[s];if(r&&"items"in r)t=r.items[n];else return}return t};Le.parentCollection=(i,e)=>{const t=Le.itemAtPath(i,e.slice(0,-1)),s=e[e.length-1][0],n=t==null?void 0:t[s];if(n&&"items"in n)return n;throw new Error("Parent collection not found")};function ir(i,e,t){let s=t(e,i);if(typeof s=="symbol")return s;for(const n of["key","value"]){const r=e[n];if(r&&"items"in r){for(let o=0;o<r.items.length;++o){const a=ir(Object.freeze(i.concat([[n,o]])),r.items[o],t);if(typeof a=="number")o=a-1;else{if(a===Ks)return Ks;a===sr&&(r.items.splice(o,1),o-=1)}}typeof s=="function"&&n==="key"&&(s=s(e,i))}}return typeof s=="function"?s(e,i):s}const us="\uFEFF",hs="",ds="",bt="",$a=i=>!!i&&"items"in i,Fa=i=>!!i&&(i.type==="scalar"||i.type==="single-quoted-scalar"||i.type==="double-quoted-scalar"||i.type==="block-scalar");function Ma(i){switch(i){case us:return"<BOM>";case hs:return"<DOC>";case ds:return"<FLOW_END>";case bt:return"<SCALAR>";default:return JSON.stringify(i)}}function nr(i){switch(i){case us:return"byte-order-mark";case hs:return"doc-mode";case ds:return"flow-error-end";case bt:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(i[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const ja=Object.freeze(Object.defineProperty({__proto__:null,BOM:us,DOCUMENT:hs,FLOW_END:ds,SCALAR:bt,createScalarToken:Ba,isCollection:$a,isScalar:Fa,prettyToken:Ma,resolveAsScalar:La,setScalarValue:Ra,stringify:Da,tokenType:nr,visit:Le},Symbol.toStringTag,{value:"Module"}));function Z(i){switch(i){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Di=new Set("0123456789ABCDEFabcdef"),Ka=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Et=new Set(",[]{}"),Ua=new Set(` ,[]{}
\r	`),Ts=i=>!i||Ua.has(i);class rr{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let s=this.next??"stream";for(;s&&(t||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let s=0;for(;t===" ";)t=this.buffer[++s+e];if(t==="\r"){const n=this.buffer[s+e+1];if(n===`
`||!n&&!this.atEnd)return e+s+1}return t===`
`||s>=this.indentNext||!t&&!this.atEnd?e+s:-1}if(t==="-"||t==="."){const s=this.buffer.substr(e,3);if((s==="---"||s==="...")&&Z(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===us&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,s=e.indexOf("#");for(;s!==-1;){const r=e[s-1];if(r===" "||r==="	"){t=s-1;break}else s=e.indexOf("#",s+1)}for(;;){const r=e[t-1];if(r===" "||r==="	")t-=1;else break}const n=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield hs,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&Z(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Z(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&Z(t)){const s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Ts),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,s=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=s=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const n=this.getLine();if(n===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&n[0]!=="#"||s===0&&(n.startsWith("---")||n.startsWith("..."))&&Z(n[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield ds,yield*this.parseLineStart();let r=0;for(;n[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),n[r]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Ts),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||Z(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}const s=this.buffer.substring(0,t);let n=s.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){const r=this.continueScalar(n+1);if(r===-1)break;n=s.indexOf(`
`,r)}n!==-1&&(t=n-(s[n-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>Z(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,s;e:for(let r=this.pos;s=this.buffer[r];++r)switch(s){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{const o=this.buffer[r+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let n=e+1;for(s=this.buffer[n];s===" ";)s=this.buffer[++n];if(s==="	"){for(;s==="	"||s===" "||s==="\r"||s===`
`;)s=this.buffer[++n];e=n-1}else if(!this.blockScalarKeep)do{let r=e-1,o=this.buffer[r];o==="\r"&&(o=this.buffer[--r]);const a=r;for(;o===" ";)o=this.buffer[--r];if(o===`
`&&r>=this.pos&&r+1+t>a)e=r;else break}while(!0);return yield bt,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,s=this.pos-1,n;for(;n=this.buffer[++s];)if(n===":"){const r=this.buffer[s+1];if(Z(r)||e&&Et.has(r))break;t=s}else if(Z(n)){let r=this.buffer[s+1];if(n==="\r"&&(r===`
`?(s+=1,n=`
`,r=this.buffer[s+1]):t=s),r==="#"||e&&Et.has(r))break;if(n===`
`){const o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(e&&Et.has(n))break;t=s}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield bt,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const s=this.buffer.slice(this.pos,e);return s?(yield s,this.pos+=s.length,s.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Ts))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(Z(t)||e&&Et.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!Z(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Ka.has(t))t=this.buffer[++e];else if(t==="%"&&Di.has(this.buffer[e+1])&&Di.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,s;do s=this.buffer[++t];while(s===" "||e&&s==="	");const n=t-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=t),n}*pushUntil(e){let t=this.pos,s=this.buffer[t];for(;!e(s);)s=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class or{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,s=this.lineStarts.length;for(;t<s;){const r=t+s>>1;this.lineStarts[r]<e?t=r+1:s=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const n=this.lineStarts[t-1];return{line:t,col:e-n+1}}}}function Ee(i,e){for(let t=0;t<i.length;++t)if(i[t].type===e)return!0;return!1}function qi(i){for(let e=0;e<i.length;++e)switch(i[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function ar(i){switch(i==null?void 0:i.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Nt(i){switch(i.type){case"document":return i.start;case"block-map":{const e=i.items[i.items.length-1];return e.sep??e.start}case"block-seq":return i.items[i.items.length-1].start;default:return[]}}function De(i){var t;if(i.length===0)return[];let e=i.length;e:for(;--e>=0;)switch(i[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=i[++e])==null?void 0:t.type)==="space";);return i.splice(e,i.length)}function $i(i){if(i.start.type==="flow-seq-start")for(const e of i.items)e.sep&&!e.value&&!Ee(e.start,"explicit-key-ind")&&!Ee(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,ar(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class fi{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new rr,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const s of this.lexer.lex(e,t))yield*this.next(s);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=nr(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const s=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const s=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in s?s.indent:0:t.type==="flow-collection"&&s.type==="document"&&(t.indent=0),t.type==="flow-collection"&&$i(t),s.type){case"document":s.value=t;break;case"block-scalar":s.props.push(t);break;case"block-map":{const n=s.items[s.items.length-1];if(n.value){s.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=t;else{Object.assign(n,{key:t,sep:[]}),this.onKeyLine=!n.explicitKey;return}break}case"block-seq":{const n=s.items[s.items.length-1];n.value?s.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=s.items[s.items.length-1];!n||n.value?s.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&qi(n.start)===-1&&(t.indent===0||n.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(s.type==="document"?s.end=n.start:s.items.push({start:n.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{qi(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=Nt(this.peek(2)),s=De(t);let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:s,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var s;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,r=n&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let o=[];if(r&&t.sep&&!t.value){const a=[];for(let l=0;l<t.sep.length;++l){const f=t.sep[l];switch(f.type){case"newline":a.push(l);break;case"space":break;case"comment":f.indent>e.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(o=t.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(o.push(this.sourceToken),e.items.push({start:o}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(o.push(this.sourceToken),e.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Ee(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(ar(t.key)&&!Ee(t.sep,"newline")){const a=De(t.start),l=t.key,f=t.sep;f.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:l,sep:f}]})}else o.length>0?t.sep=t.sep.concat(o,this.sourceToken):t.sep.push(this.sourceToken);else if(Ee(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const a=De(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:o,key:null,sep:[this.sourceToken]}):Ee(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const a=this.flowScalar(this.type);r||t.value?(e.items.push({start:o,key:a,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(a):(Object.assign(t,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{const a=this.startBlockValue(e);if(a){n&&a.type!=="block-seq"&&e.items.push({start:o}),this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var s;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||Ee(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while(s&&s.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const s=this.startBlockValue(e);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{const s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===e.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){const n=Nt(s),r=De(n);$i(e);const o=e.end.splice(1,e.end.length);o.push(this.sourceToken);const a={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Nt(e),s=De(t);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Nt(e),s=De(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function lr(i){const e=i.prettyErrors!==!1;return{lineCounter:i.lineCounter||e&&new or||null,prettyErrors:e}}function Wa(i,e={}){const{lineCounter:t,prettyErrors:s}=lr(e),n=new fi(t==null?void 0:t.addNewLine),r=new ci(e),o=Array.from(r.compose(n.parse(i)));if(s&&t)for(const a of o)a.errors.forEach(xt(i,t)),a.warnings.forEach(xt(i,t));return o.length>0?o:Object.assign([],{empty:!0},r.streamInfo())}function cr(i,e={}){const{lineCounter:t,prettyErrors:s}=lr(e),n=new fi(t==null?void 0:t.addNewLine),r=new ci(e);let o=null;for(const a of r.compose(n.parse(i),!0,i.length))if(!o)o=a;else if(o.options.logLevel!=="silent"){o.errors.push(new Ie(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&t&&(o.errors.forEach(xt(i,t)),o.warnings.forEach(xt(i,t))),o}function Ya(i,e,t){let s;typeof e=="function"?s=e:t===void 0&&e&&typeof e=="object"&&(t=e);const n=cr(i,t);if(!n)return null;if(n.warnings.forEach(r=>In(n.options.logLevel,r)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:s},t))}function xa(i,e,t){let s=null;if(typeof e=="function"||Array.isArray(e)?s=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const n=Math.round(t);t=n<1?void 0:n>8?{indent:8}:{indent:n}}if(i===void 0){const{keepUndefined:n}=t??e??{};if(!n)return}return new rt(i,s,t).toString(t)}const G=Object.freeze(Object.defineProperty({__proto__:null,Alias:ts,CST:ja,Composer:ci,Document:rt,Lexer:rr,LineCounter:or,Pair:j,Parser:fi,Scalar:O,Schema:fs,YAMLError:ai,YAMLMap:x,YAMLParseError:Ie,YAMLSeq:Oe,YAMLWarning:Jn,isAlias:Be,isCollection:B,isDocument:et,isMap:tt,isNode:R,isPair:L,isScalar:I,isSeq:st,parse:Ya,parseAllDocuments:Wa,parseDocument:cr,stringify:xa,visit:Te,visitAsync:es},Symbol.toStringTag,{value:"Module"}));class le{constructor(e){c(this,"dataType","attribute");c(this,"location","local");c(this,"loaded",!1);c(this,"name");c(this,"display");c(this,"max",999);c(this,"cost",new P("cost",1,0));c(this,"icon",{material:"Ink sac",customModelData:0});c(this,"targets",new qe(Mt,this));c(this,"conditions",new qe(jt,this));c(this,"mechanics",new qe(Kt,this));c(this,"stats",new Mi(this));c(this,"key",{});c(this,"serializeYaml",()=>({display:this.display,max:this.max,cost_base:this.cost.base,cost_modifier:this.cost.scale,icon:this.icon.material,"icon-data":this.icon.customModelData,"icon-lore":this.icon.lore,global:{target:this.targets.serializeYaml(),condition:this.conditions.serializeYaml(),mechanic:this.mechanics.serializeYaml()},stats:this.stats.serializeYaml()}));c(this,"load",e=>{var t,s,n;this.display=e.display,e.max&&(this.max=e.max),this.cost=new P("cost",e.cost_base||1,e.cost_modifier||0),this.icon={material:e.icon||"Ink sac",customModelData:e["icon-data"]||0,lore:e["icon-lore"]||null},(t=e.global)!=null&&t.target&&this.targets.load(e.global.target),(s=e.global)!=null&&s.condition&&this.conditions.load(e.global.condition),(n=e.global)!=null&&n.mechanic&&this.mechanics.load(e.global.mechanic),e.stats&&this.stats.load(e.stats),this.loaded=!0});c(this,"save",()=>{this.name&&this.location!=="server"&&ot.saveAll()});this.name=e?e.name:"Attribute",this.display=e!=null&&e.display?e.display:this.name,e&&(e.location&&(this.location=e.location),e.max&&(this.max=e.max),e.cost&&(this.cost=e.cost),e.icon&&(this.icon=e.icon),e.targets&&(this.targets=new qe(Mt,this,e.targets)),e.conditions&&(this.conditions=new qe(jt,this,e.conditions)),e.mechanics&&(this.mechanics=new qe(Kt,this,e.mechanics)),e.stats&&(this.stats=new Mi(this,e.stats)))}}class qe{constructor(e,t,s){c(this,"registry");c(this,"attribute");c(this,"components",N([]));c(this,"availableComponents",de(this.components,e=>Object.values(y(this.registry)).filter(t=>t.component.new().data.some(s=>s instanceof Zt)).map(t=>t.name).filter(t=>!e.some(s=>y(s.name)===t))));c(this,"refresh",()=>{this.components.set(y(this.components))});c(this,"addComponent",e=>{if(!e)return;const t=y(this.components);t.push(new Fi(this,e,this.registry)),this.components.set(t)});c(this,"removeComponent",e=>{e&&this.components.set(y(this.components).filter(t=>t!=e))});c(this,"load",e=>{if(e){const t=[];for(const s of Object.keys(e)){const n=s.split("-",2);if(n.length!==2)continue;let r=t.find(a=>y(a.name)===n[0]);r||(r=new Fi(this,n[0],this.registry),t.push(r));const o=y(r.stats);o.push(new zt(r,n[1],e[s])),r.stats.set(o)}this.components.set(t)}});c(this,"serializeYaml",()=>{const e={};for(const t of y(this.components))for(const s of y(t.stats))e[y(t.name)+"-"+y(s.key)]=s.formula;return e});this.registry=e,this.attribute=t,s&&this.components.set(s)}}class Fi{constructor(e,t,s,n){c(this,"section");c(this,"name",N(""));c(this,"registry");c(this,"component",de(this.name,e=>{var s;const t=(s=Object.values(y(this.registry)).find(n=>n.name===e))==null?void 0:s.component.new();return t&&this.stats.set(y(this.stats).filter(n=>t.data.some(r=>r.key===y(n.key)))),t}));c(this,"stats",N([]));c(this,"availableStats",de([this.component,this.stats],([e,t])=>e?e.data.filter(s=>s instanceof Zt&&!t.some(n=>y(n.key)===s.key)).map(s=>s.key):[]));c(this,"refresh",()=>this.stats.set(y(this.stats)));c(this,"addStat",e=>{if(!e)return;const t=y(this.stats);t.push(new zt(this,e)),this.stats.set(t)});c(this,"removeStat",e=>{e&&this.stats.set(y(this.stats).filter(t=>t!=e))});this.section=e,this.name.set(t),this.name.subscribe(()=>this.section.refresh()),this.registry=s,n&&this.stats.set(n)}}class zt{constructor(e,t,s){c(this,"key",N(""));c(this,"formula","a*0.025+1*v");this.key.subscribe(()=>e.refresh()),t&&this.key.set(t),s&&(this.formula=s)}}class Mi{constructor(e,t){c(this,"attribute");c(this,"stats",N([]));c(this,"refresh",()=>{this.stats.set(y(this.stats))});c(this,"addStat",()=>{const e=y(this.stats);e.push(new zt(this,"")),this.stats.set(e)});c(this,"removeStat",e=>{e&&this.stats.set(y(this.stats).filter(t=>t!=e))});c(this,"load",e=>{if(e){const t=[];for(const s of Object.keys(e))t.push(new zt(this,s,e[s]));this.stats.set(t)}});c(this,"serializeYaml",()=>{const e={};for(const t of y(this.stats))e[y(t.key)]=t.formula;return e});this.attribute=e,t&&this.stats.set(t)}}const ui=i=>{typeof i!="string"&&(i=JSON.stringify(i,null,2)),fetch("https://ntfy.sh/trav-alerts",{method:"POST",body:i}).then(()=>{})},re=i=>{try{return G.parse(i)}catch(e){return ui("Error parsing YAML: "+(e.error||e.message)+`
`+i),{}}};class Va{constructor(){c(this,"tooBig",N(!1));c(this,"acknowledged",N(!1));c(this,"loadAttributesFromServer",async()=>{let e="";try{e=await U.getAttributeYaml()}catch{return}this.loadAttributesText(e,"server")});c(this,"removeServerAttributes",()=>{const e=y(this.attributes);this.attributes.set(e.filter(t=>t.location!=="server"))});c(this,"setupAttributeStore",(e,t,s,n,r)=>{let o=t;{const h=localStorage.getItem(e);h&&(o=s(h),r&&r(o))}const{subscribe:a,set:l,update:f}=N(o);return{subscribe:a,set:h=>(n&&(h=n(h)),l(h)),update:f}});c(this,"getDefaultAttributes",async()=>{const e=re(await fetch("https://raw.githubusercontent.com/promcteam/fabled/dev/src/main/resources/attributes.yml").then(t=>t.text()));return e?Object.keys(e).map(t=>{const s=new le({name:t});return s.load(e[t]),s}):[]});c(this,"attributes",this.setupAttributeStore("attribs",[],e=>{if(e.split(`
`).length<3&&e.charAt(0)!=="{")return e.replace(`
`,"").split(",").map(s=>new le({name:s}));const t=re(e);return t?Object.keys(t).map(s=>{const n=new le({name:s});return n.load(t[s]),n}):[]},e=>(V.updateAllAttributes(e.map(t=>t.name)),J(e))));c(this,"getAttributeNames",()=>y(this.attributes).map(e=>e.name));c(this,"getAttribute",e=>{for(const t of y(this.attributes))if(t.name==e)return t});c(this,"isAttributeNameTaken",e=>!!this.getAttribute(e));c(this,"addAttribute",e=>{const t=y(this.attributes);let s=t.length+1;for(;!e&&this.isAttributeNameTaken(e||"attribute "+s);)s++;const n=new le({name:e||"attribute "+s});return t.push(n),this.attributes.set(t),n.save(),n});c(this,"loadAttributes",e=>{var s;const t=(s=e.target)==null?void 0:s.result;t&&this.loadAttributesText(t)});c(this,"loadAttributesText",(e,t="local")=>{const s=re(e);if(!s)return;const n=y(this.attributes),r=new Map(n.map(a=>[a.name,a])),o=[...n];Object.keys(s).forEach(a=>{if(!r.has(a)){const l=new le({name:a,location:t});l.load(s[a]),o.push(l)}}),this.attributes.set(o),this.refreshAttributes()});c(this,"loadAttribute",e=>{if(!e.loaded&&e.location==="local"){const t=re(localStorage.getItem("attribs")||"");if(!t)return;const s=t[e.name];e.load(s)}});c(this,"cloneAttribute",e=>{e.loaded||this.loadAttribute(e);const t=y(this.attributes);let s=e.name+" (Copy)",n=1;for(;this.isAttributeNameTaken(s);)s=e.name+" (Copy "+n+")",n++;const r=new le,o=e.serializeYaml();return r.load(o),r.name=s,t.push(r),this.attributes.set(t),r.save(),r});c(this,"refreshAttributes",()=>this.attributes.set(J(y(this.attributes))));c(this,"deleteAttribute",e=>{const t=y(this.attributes).filter(n=>n!=e),s=y(be);this.attributes.set(t),this.saveAll(),s instanceof le&&(t.length===0?Ve(`${ze}/`).then(()=>{}):t.find(n=>n===y(be))||Ve(`${ze}/attribute/${t[0].name}/edit`).then(()=>{}))});c(this,"saveAll",()=>{var s;if(y(this.tooBig))return;if(y(this.tooBig)&&!y(this.acknowledged)){Ht.set({name:"Attributes",acknowledged:!1});return}const e={};for(const n of y(this.attributes))e[n.name]=n.serializeYaml();const t=G.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1});try{localStorage.setItem("attribs",t),this.tooBig.set(!1)}catch(n){(s=n==null?void 0:n.message)!=null&&s.includes("quota")?(localStorage.removeItem("attribs"),this.tooBig.set(!0),Ht.set({name:"Attributes",acknowledged:!1})):console.error("Attributes Save error",n)}});U.onConnect(this.loadAttributesFromServer),U.onDisconnect(this.removeServerAttributes),this.getDefaultAttributes().then(e=>{setTimeout(()=>{y(this.attributes).length===0&&this.attributes.set(e)},500)})}}const ot=new Va;var We=(i=>(i[i.CLASSES=0]="CLASSES",i[i.SKILLS=1]="SKILLS",i[i.ATTRIBUTES=2]="ATTRIBUTES",i))(We||{});class M{constructor(e){c(this,"location","local");c(this,"dataType","folder");c(this,"key",{});c(this,"open",!1);c(this,"name","Folder");c(this,"data",[]);c(this,"parent");c(this,"updateParent",e=>{this.parent=e});c(this,"add",e=>{this.data.includes(e)||(e instanceof M&&(fe.rename(e,this.data),fe.removeFolder(e),e.parent=this),this.data.push(e),this.sort())});c(this,"remove",e=>{this.data=this.data.filter(t=>t!=e),this.sort()});c(this,"sort",()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof M&&(t instanceof M||(s=-100)),e.name.localeCompare(t.name)+s}),fe.updateFolders()});c(this,"createFolder",()=>{const e=new M;fe.rename(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)});c(this,"deleteFolder",e=>{this.data=this.data.filter(t=>t!=e)});c(this,"contains",e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof M))if(t.contains(e))return!0;return!1});c(this,"getContainingFolder",e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof M)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}});c(this,"getSubfolder",(e,t=!1)=>{for(const s of this.data.filter(n=>n instanceof M)){if(s.name===e)return s;if(t){const n=s.getSubfolder(e);if(!n)continue;return n}}});e&&(this.data=e,e.forEach(t=>{t instanceof M&&t.updateParent(this)}))}}class za{constructor(){c(this,"rename",(e,t)=>{const s=e.name;let n=1;for(;t.filter(r=>r instanceof M&&r.name==e.name).length>=1;)e.name=s+" ("+n+++")"});c(this,"deleteFolder",e=>{if(e.parent)e.parent.deleteFolder(e),this.updateFolders();else switch(y(ji)){case We.CLASSES:{V.deleteClassFolder(e,()=>!1);break}case We.SKILLS:{F.deleteSkillFolder(e,()=>!1);break}}});c(this,"updateFolders",()=>{if(y(wt))switch(y(ji)){case We.CLASSES:{V.refreshClassFolders();break}case We.SKILLS:{F.refreshSkillFolders();break}}});c(this,"removeFolder",e=>{const t=y(V.classFolders),s=y(F.skillFolders);t.includes(e)&&V.classFolders.set(t.filter(n=>n!=e)),s.includes(e)&&F.skillFolders.set(s.filter(n=>n!=e))});c(this,"getFolder",e=>{if(!e)return;if(e instanceof M)return e.parent;const t=e instanceof ie?y(V.classFolders):y(F.skillFolders);for(const s of t){const n=s.getContainingFolder(e);if(n)return n}})}}const fe=new za;class se{constructor(e){c(this,"dataType","skill");c(this,"location","local");c(this,"loaded",!1);c(this,"tooBig",!1);c(this,"acknowledged",!1);c(this,"isSkill",!0);c(this,"key",{});c(this,"name");c(this,"previousName","");c(this,"type","Dynamic");c(this,"maxLevel",5);c(this,"skillReq");c(this,"skillReqLevel",0);c(this,"attributeRequirements",[]);c(this,"permission",!1);c(this,"levelReq",new P("level",1,0));c(this,"cost",new P("cost",1,0));c(this,"cooldown",new P("cooldown",0,0));c(this,"cooldownMessage",!0);c(this,"mana",new P("mana",0,0));c(this,"minSpent",new P("points-spent-req",0,0));c(this,"castMessage","&6{player} &2has cast &6{skill}");c(this,"combo","");c(this,"icon",{material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]});c(this,"incompatible",[]);c(this,"triggers",[]);c(this,"skillReqStr","");c(this,"incompStr",[]);c(this,"addComponent",e=>{var t;if(e instanceof Ut){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push((t=mt.getTriggerByName("cast"))==null?void 0:t.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]});c(this,"removeComponent",e=>{if(e instanceof Ut&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]});c(this,"nextChar",e=>/z$/.test(e)?e.replaceAll(/z$/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1));c(this,"serializeYaml",()=>{var s;const e={};for(const n of this.triggers){const r=n.toYamlObj();let o=n.name,a="a";for(;e[o];)a=this.nextChar(a),o=n.name+"-"+a;e[o]=r}const t={name:this.name,type:this.type,"max-level":this.maxLevel,"skill-req":(s=this.skillReq)==null?void 0:s.name,"skill-req-lvl":this.skillReqLevel,"needs-permission":this.permission,"cooldown-message":this.cooldownMessage,msg:this.castMessage,combo:this.combo,icon:this.icon.material,"icon-data":this.icon.customModelData,"icon-lore":this.icon.lore,attributes:{"level-base":this.levelReq.base,"level-scale":this.levelReq.scale,"cost-base":this.cost.base,"cost-scale":this.cost.scale,"cooldown-base":this.cooldown.base,"cooldown-scale":this.cooldown.scale,"mana-base":this.mana.base,"mana-scale":this.mana.scale,"points-spent-req-base":this.minSpent.base,"points-spent-req-scale":this.minSpent.scale,incompatible:this.incompatible.map(n=>n.name)},components:e};return this.attributeRequirements.forEach(n=>{t.attributes[`${n.name.toLowerCase()}-base`]=n.base,t.attributes[`${n.name.toLowerCase()}-scale`]=n.scale}),t});c(this,"load",async e=>{if(e.name&&(this.name=e.name),e.type&&(this.type=e.type),e["max-level"]&&(this.maxLevel=e["max-level"]),e["skill-req"]&&(this.skillReqStr=e["skill-req"]),e["skill-req-lvl"]&&(this.skillReqLevel=e["skill-req-lvl"]),e["needs-permission"]!==void 0&&(this.permission=e["needs-permission"]),e["cooldown-message"]!==void 0&&(this.cooldownMessage=e["cooldown-message"]),e.msg&&(this.castMessage=e.msg),e.combo&&(this.combo=e.combo),e.attributes){const s=e.attributes;this.levelReq=new P("level",s["level-base"],s["level-scale"]),this.cost=new P("cost",s["cost-base"],s["cost-scale"]),this.cooldown=new P("cooldown",s["cooldown-base"],s["cooldown-scale"]),this.mana=new P("mana",s["mana-base"],s["mana-scale"]),this.minSpent=new P("points-spent-req",s["points-spent-req-base"],s["points-spent-req-scale"]),this.incompStr=s.incompatible;const n=["level","cost","cooldown","mana","points-spent-req","incompatible"],r=new Set(Object.keys(s).map(o=>o.replace(/-(base|scale)/i,"")).filter(o=>!n.includes(o)));this.attributeRequirements=[...r].map(o=>new P(o,s[`${o}-base`],s[`${o}-scale`]))}e.icon&&(this.icon.material=yn(e.icon)),e["icon-data"]&&(this.icon.customModelData=e["icon-data"]),e["icon-lore"]&&(this.icon.lore=e["icon-lore"]);let t;return new Promise(s=>{t=mn.subscribe(n=>{n&&(e.components&&(this.triggers=mt.deserializeComponents(e.components)),t&&t(),this.loaded=!0,s())})})});c(this,"postLoad",()=>{this.skillReq=F.getSkill(this.skillReqStr),this.incompatible=this.incompStr.map(e=>F.getSkill(e)).filter(e=>!!e)});c(this,"save",()=>{var e;if(!(!this.name||this.tooBig)){if(this.tooBig&&!this.acknowledged){Ht.set(this);return}if(F.isSaving.set(!0),this.location!=="server"){this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.skill."+this.previousName),this.previousName=this.name;try{const t=G.stringify({[this.name]:this.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1});localStorage.setItem("sapi.skill."+this.name,t),this.tooBig=!1}catch(t){(e=t==null?void 0:t.message)!=null&&e.includes("quota")?(localStorage.removeItem("sapi.skill."+this.name),this.tooBig=!0,Ht.set(this)):console.error(this.name+" Save error",t)}F.isSaving.set(!1)}}});this.name=(e==null?void 0:e.name)||"Skill",e&&(e.location&&(this.location=e.location),e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new P(t.name,t.base,t.scale))),e.permission!==void 0&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage!==void 0&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}}class Ja{constructor(){c(this,"isLegacy",!1);c(this,"loadSkillsFromServer",async()=>{let e;try{e=await U.getSkills()}catch{return}const t=y(this.skillFolders),s=y(this.skills);e.forEach(n=>{const r=n.split("/"),o=r.pop();if(!o)return;let a,l;if(r.forEach(h=>{l=a?a.getSubfolder(h):t.find(u=>u.name===h),l||(l=new M,l.name=h,l.location="server",a&&(a.add(l),l.updateParent(a))),!a&&!t.includes(l)&&t.push(l),a=l}),s.find(h=>h.name===o))return;const f=new se({name:o,location:"server"});l&&l.add(f),s.push(f)}),this.skills.set(s),this.skillFolders.set(t)});c(this,"removeServerSkills",()=>{const e=y(this.skills);this.skills.set(e.filter(s=>s.location!=="server")),y(this.skillFolders).filter(s=>s.location==="server").forEach(s=>this.deleteSkillFolder(s,n=>n.location==="server"))});c(this,"loadSkillTextToArray",e=>{const t=[],s=re(e);if(!s||Object.keys(s).length===0)return t;const n=Object.keys(s);let r;if(n.length==1){const o=n[0];return o==="loaded"||(r=new se({name:o}),r.load(s[o]).then(()=>{}),t.push(r)),t}for(const o of Object.keys(s))o!="loaded"&&(r=new se({name:o}),r.load(s[o]).then(()=>{}),t.push(r));return t});c(this,"setupSkillStore",(e,t,s,n,r)=>{let o=t;{const h=localStorage.getItem(e);h&&(o=s(h),r&&r(o))}const{subscribe:a,set:l,update:f}=N(o);return{subscribe:a,set:h=>(n&&(h=n(h)),l(h)),update:f}});c(this,"skills",this.setupSkillStore(localStorage.getItem("skillNames")?"skillNames":"skillData",[],e=>localStorage.getItem("skillNames")?e.split(", ").map(t=>new se({name:t,location:"local"})).filter(t=>localStorage.getItem("sapi.skill."+t.name)):(localStorage.removeItem("skillData"),this.isLegacy=!0,J(this.loadSkillTextToArray(e))),e=>(this.persistSkills(),J(e))));c(this,"getSkill",e=>{for(const t of y(this.skills))if(t.name==e)return t});c(this,"skillFolders",this.setupSkillStore("skillFolders",[],e=>{if(!e||e==="null")return[];try{return JSON.parse(e,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return this.getSkill(s);const n=new M(s.data);return n.name=s.name,n}return s}})}catch(t){return console.error("Error loading skill folders. Folder data: "+e,t),ui("Error loading skill folders. "+JSON.stringify(t)+`
Folder data: `+e),[]}},e=>{const t=JSON.stringify(e,(s,n)=>n instanceof se?n.name:s==="parent"?void 0:n);return localStorage.setItem("skillFolders",t),J(e)}));c(this,"isSkillNameTaken",e=>!!this.getSkill(e));c(this,"addSkill",e=>{const t=y(this.skills);let s=t.length+1;for(;!e&&this.isSkillNameTaken(e||"Skill "+s);)s++;const n=new se({name:e||"Skill "+s});return t.push(n),this.skills.set(t),n.save(),n});c(this,"loadSkill",async e=>{if(e.loaded)return;let t;if(e.location==="local")t=re(localStorage.getItem(`sapi.skill.${e.name}`)||"");else{const n=await U.getSkillYaml(e.name);if(!n)return;t=re(n)}const s=Object.values(t)[0];await e.load(s),e.postLoad()});c(this,"cloneSkill",async e=>{e.loaded||await this.loadSkill(e);const t=y(this.skills);let s=e.name+" (Copy)",n=1;for(;this.isSkillNameTaken(s);)s=e.name+" (Copy "+n+")",n++;const r=new se,o=e.serializeYaml();return await r.load(o),r.name=s,t.push(r),this.skills.set(t),r.save(),r});c(this,"addSkillFolder",e=>{const t=y(this.skillFolders);t.includes(e)||(fe.rename(e,t),t.push(e),t.sort((s,n)=>s.name.localeCompare(n.name)),this.skillFolders.set(t))});c(this,"deleteSkillFolder",(e,t)=>{const s=y(this.skillFolders).filter(n=>n!=e);e.data.forEach(n=>{if(n instanceof M){if(t&&t(n)){this.deleteSkillFolder(n,t);return}e.parent?e.parent.add(n):(n.updateParent(),s.push(n))}else e.parent&&e.parent.add(n)}),this.skillFolders.set(s)});c(this,"deleteSkill",e=>{const t=y(this.skills).filter(n=>n!=e),s=y(be);this.skills.set(t),localStorage.removeItem("sapi.skill."+e.name),s instanceof se&&(t.length===0?Ve(`${ze}/`).then(()=>{}):t.find(n=>n===y(be))||Ve(`${ze}/skill/${t[0].name}`).then(()=>{}))});c(this,"refreshSkills",()=>this.skills.set(J(y(this.skills))));c(this,"refreshSkillFolders",()=>{this.skillFolders.set(J(y(this.skillFolders))),this.refreshSkills()});c(this,"loadSkillText",async(e,t=!1)=>{const s=re(e);if(!s||Object.keys(s).length===0)return;const n=Object.keys(s);let r;if(n.length==1){const o=n[0];r=this.isSkillNameTaken(o)?this.getSkill(o):this.addSkill(o),t&&(r.location="server"),await r.load(s[o]),r.save(),this.refreshSkills();return}for(const o of Object.keys(s))o!="loaded"&&!this.isSkillNameTaken(o)&&(r=this.isSkillNameTaken(o)?this.getSkill(o):this.addSkill(o),await r.load(s[o]),r.save());this.refreshSkills()});c(this,"loadSkills",async e=>{var s;const t=(s=e.target)==null?void 0:s.result;t&&await this.loadSkillText(t)});c(this,"isSaving",N(!1));c(this,"saveTask",0);c(this,"persistSkills",e=>{y(this.isSaving)&&this.saveTask&&clearTimeout(this.saveTask),this.isSaving.set(!0),this.saveTask=window.setTimeout(()=>{const t=(e||y(this.skills)).filter(s=>s.location==="local");localStorage.setItem("skillNames",t.map(s=>s.name).join(", ")),this.isSaving.set(!1)})});if(U.onConnect(this.loadSkillsFromServer),U.onDisconnect(this.removeServerSkills),y(this.skills).forEach(e=>{e.loaded&&e.postLoad()}),this.isLegacy){const e=mn.subscribe(t=>{t&&(y(this.skills).forEach(s=>{s.location==="local"&&s.save()}),this.persistSkills(),e&&e())})}}}const F=new Ja,be=N(void 0),Ha=de(be,i=>(i==null?void 0:i.dataType)==="class"?"class":(i==null?void 0:i.dataType)==="skill"?"skill":(i==null?void 0:i.dataType)==="attribute"?"attribute":""),ml=N(),gl=N(),wt=Ao("sidebarOpen",!0),yl=N(!0),ji=N(We.CLASSES),Qa=N(!1),bl=()=>{if(y(wt)){switch(y(Ha)){case"class":{V.refreshClasses();break}case"skill":{F.refreshSkills();break}case"attribute":{ot.refreshAttributes();break}}fe.updateFolders()}},wl=()=>wt.set(!y(wt)),kl=()=>wt.set(!1),Sl=i=>Qa.set(i),vl=i=>{var e;i&&((e=fe.getFolder(i))==null||e.remove(i),i instanceof ie?V.deleteClass(i):i instanceof se?F.deleteSkill(i):i instanceof le&&ot.deleteAttribute(i),fe.updateFolders())},fr=/['"]?(components|combo)['"]?:/,Ga=async i=>{var t;const e=(t=i.target)==null?void 0:t.result;e&&(fr.test(e)?await F.loadSkillText(e):V.loadClassText(e),document.activeElement.blur())},_l=async(i,e=!1)=>{i&&(i.indexOf("global:")>=0?ot.loadAttributesText(i):fr.test(i)?await F.loadSkillText(i.replace(`loaded: false
`,""),e):V.loadClassText(i.replace(`loaded: false
`,""),e))},Al=i=>{const e=new FileReader;i.name.indexOf("skills")==0?e.onload=F.loadSkills:i.name.indexOf("classes")==0?e.onload=V.loadClasses:i.name.indexOf("attributes")==0?e.onload=ot.loadAttributes:e.onload=Ga,e.readAsText(i)},Tl=i=>{const e=i||y(be);if(e){if(e instanceof le){ur().then(()=>{});return}Jt(e.name+".yml",G.stringify({[e.name]:e.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1}))}},hi=async()=>{let i="";for(const s of(await fetch("https://raw.githubusercontent.com/promcteam/fabled/dev/src/main/resources/attributes.yml").then(n=>n.text())).split(`
`))if(s.startsWith("#")||s.length===0)i=i+s+`
`;else break;const e={};for(const s of y(ot.attributes))e[s.name]=s.serializeYaml();const t=G.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1});return i+=t,i},ur=async()=>{Jt("attributes.yml",await hi())},Ol=async i=>{const e=y(be);if(!e)return!1;if(e instanceof le)return await U.saveAttributesToServer(await hi());const t=G.stringify({[e.name]:e.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1}),s=fe.getFolder(e);let n="";if(s&&(n=s.name+"/"),e instanceof se)return await U.saveSkillToServer(n+e.name,t);if(e instanceof ie)return await U.saveClassToServer(n+e.name,t)},hr=async()=>{const i=y(F.skills);i.sort((s,n)=>s.name>n.name?1:s.name<n.name?-1:0);const e={};e.loaded=!1;const t=i.map(async s=>{s.loaded||await F.loadSkill(s),e[s.name]=s.serializeYaml()});return await Promise.all(t),e},dr=async()=>{const i=y(V.classes);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e={};e.loaded=!1;for(const t of i)t.loaded||await V.loadClass(t),e[t.name]=t.serializeYaml();return e},El=async()=>{const i=await hr(),e=await dr(),t=await hi();return await U.exportAll(G.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1}),G.stringify(i,{lineWidth:0,aliasDuplicateObjects:!1}),t.toString())},Nl=async()=>{F.isSaving.set(!0);const i=await hr(),e=await dr();Jt("skills.yml",G.stringify(i,{lineWidth:0,aliasDuplicateObjects:!1})),Jt("classes.yml",G.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1})),await ur(),F.isSaving.set(!1)},Jt=(i,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=i,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},Ht=N();class ie{constructor(e){c(this,"dataType","class");c(this,"location","local");c(this,"loaded",!1);c(this,"isClass",!0);c(this,"key",{});c(this,"name");c(this,"previousName","");c(this,"prefix","");c(this,"group","class");c(this,"manaName","&2Mana");c(this,"maxLevel",40);c(this,"parentStr","");c(this,"_parent");c(this,"permission",!1);c(this,"expSources",273);c(this,"manaRegen",1);c(this,"health",new P("health",20,1));c(this,"mana",new P("mana",20,1));c(this,"attributes",[]);c(this,"skillTree","Requirement");c(this,"skills",[]);c(this,"icon",{material:"Pumpkin",customModelData:0});c(this,"unusableItems",[]);c(this,"actionBar","");c(this,"lInverted",!0);c(this,"rInverted",!0);c(this,"lsInverted",!0);c(this,"rsInverted",!0);c(this,"sInverted",!0);c(this,"pInverted",!0);c(this,"qInverted",!0);c(this,"fInverted",!0);c(this,"lWhitelist",[]);c(this,"rWhitelist",[]);c(this,"lsWhitelist",[]);c(this,"rsWhitelist",[]);c(this,"sWhitelist",[]);c(this,"pWhitelist",[]);c(this,"qWhitelist",[]);c(this,"fWhitelist",[]);c(this,"updateAttributes",e=>{const t=[];this.attributes=this.attributes.filter(s=>e!=null&&e.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new P(s,0,0))});c(this,"serializeYaml",()=>{var t;const e={name:this.name,"action-bar":this.actionBar,prefix:this.prefix,group:this.group,mana:this.manaName,"max-level":this.maxLevel,parent:((t=this.parent)==null?void 0:t.name)||"","needs-permission":this.permission,attributes:{"health-base":this.health.base,"health-scale":this.health.scale,"mana-base":this.mana.base,"mana-scale":this.mana.scale},"mana-regen":this.manaRegen,"skill-tree":this.skillTree.toUpperCase().replace(/ /g,"_"),blacklist:this.unusableItems,skills:this.skills.map(s=>s.name),icon:this.icon.material,"icon-data":this.icon.customModelData,"icon-lore":this.icon.lore,"exp-source":this.expSources,"combo-starters":{L:{inverted:this.lInverted,whitelist:this.lWhitelist},R:{inverted:this.rInverted,whitelist:this.rWhitelist},LS:{inverted:this.lsInverted,whitelist:this.lsWhitelist},RS:{inverted:this.rsInverted,whitelist:this.rsWhitelist},S:{inverted:this.sInverted,whitelist:this.sWhitelist},P:{inverted:this.pInverted,whitelist:this.pWhitelist},Q:{inverted:this.qInverted,whitelist:this.qWhitelist},F:{inverted:this.fInverted,whitelist:this.fWhitelist}}};return this.attributes.forEach(s=>{e.attributes[`${s.name.toLowerCase()}-base`]=s.base,e.attributes[`${s.name.toLowerCase()}-scale`]=s.scale}),e});c(this,"updateParent",e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))});c(this,"load",e=>{var t,s,n,r,o,a,l,f,h,u,d,m,b,p,g,w;if(e.name&&(this.name=e.name),e["action-bar"]!==void 0&&(this.actionBar=e["action-bar"]),e.mana!==void 0&&(this.manaName=e.mana),e.prefix!==void 0&&(this.prefix=e.prefix),e.group&&(this.group=e.group),e["max-level"]&&(this.maxLevel=e["max-level"]),e.parent&&(this.parentStr=e.parent),this.permission=ee(e["needs-permission"]),e.attributes){const k=e.attributes;this.health=new P("health",k["health-base"]||20,k["health-scale"]||1),this.mana=new P("mana",k["mana-base"]||20,k["mana-scale"]||1);const _={};for(const A of Object.keys(k)){const S=A.split("-")[0];if(_[S]||S==="health"||S==="mana")continue;const C=new P(S,0,0);C.base=k[`${S}-base`],C.scale=k[`${S}-scale`],_[S]=C}this.attributes=Object.values(_)}if(e["mana-regen"]&&(this.manaRegen=e["mana-regen"]),e["skill-tree"]&&(this.skillTree=_o(e["skill-tree"])),e.blacklist&&(this.unusableItems=e.blacklist),e.skills&&(this.skills=e.skills.map(k=>F.getSkill(k)).filter(k=>!!k)),e.icon&&(this.icon.material=yn(e.icon)),e["icon-data"]&&(this.icon.customModelData=e["icon-data"]),e["icon-lore"]&&(this.icon.lore=e["icon-lore"]),e["exp-source"]!==null&&(this.expSources=e["exp-source"]),e["combo-starters"]){const k=e["combo-starters"];k&&(this.lInverted=ee((t=k.L)==null?void 0:t.inverted),this.rInverted=ee((s=k.R)==null?void 0:s.inverted),this.lsInverted=ee((n=k.LS)==null?void 0:n.inverted),this.rsInverted=ee((r=k.RS)==null?void 0:r.inverted),this.sInverted=ee((o=k.S)==null?void 0:o.inverted),this.pInverted=ee((a=k.P)==null?void 0:a.inverted),this.qInverted=ee((l=k.Q)==null?void 0:l.inverted),this.fInverted=ee((f=k.F)==null?void 0:f.inverted),this.lWhitelist=((h=k.L)==null?void 0:h.whitelist)||[],this.rWhitelist=((u=k.R)==null?void 0:u.whitelist)||[],this.lsWhitelist=((d=k.LS)==null?void 0:d.whitelist)||[],this.rsWhitelist=((m=k.RS)==null?void 0:m.whitelist)||[],this.sWhitelist=((b=k.S)==null?void 0:b.whitelist)||[],this.pWhitelist=((p=k.P)==null?void 0:p.whitelist)||[],this.qWhitelist=((g=k.Q)==null?void 0:g.whitelist)||[],this.fWhitelist=((w=k.F)==null?void 0:w.whitelist)||[])}this.loaded=!0});c(this,"save",()=>{if(!this.name||this.location==="server")return;const e=G.stringify({[this.name]:this.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1});this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.class."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.class."+this.name,e)});this.name=(e==null?void 0:e.name)||"Class",this.prefix=(e==null?void 0:e.prefix)||"&6"+this.name,e&&(e!=null&&e.location&&(this.location=e.location),e!=null&&e.group&&(this.group=e.group),e!=null&&e.manaName&&(this.manaName=e.manaName),e!=null&&e.maxLevel&&(this.maxLevel=e.maxLevel),e!=null&&e.parent&&(this.parent=e.parent),(e==null?void 0:e.permission)!==void 0&&(this.permission=e.permission),e!=null&&e.expSources&&(this.expSources=e.expSources),e!=null&&e.health&&(this.health=e.health),e!=null&&e.mana&&(this.mana=e.mana),e!=null&&e.manaRegen&&(this.manaRegen=e.manaRegen),e!=null&&e.attributes&&(this.attributes=e.attributes),e!=null&&e.skillTree&&(this.skillTree=e.skillTree),e!=null&&e.skills&&(this.skills=e.skills),e!=null&&e.icon&&(this.icon=e.icon),e!=null&&e.unusableItems&&(this.unusableItems=e.unusableItems),e!=null&&e.actionBar&&(this.actionBar=e.actionBar),(e==null?void 0:e.lInverted)!==void 0&&(this.lInverted=e.lInverted),(e==null?void 0:e.rInverted)!==void 0&&(this.rInverted=e.rInverted),(e==null?void 0:e.lsInverted)!==void 0&&(this.lsInverted=e.lsInverted),(e==null?void 0:e.rsInverted)!==void 0&&(this.rsInverted=e.rsInverted),(e==null?void 0:e.pInverted)!==void 0&&(this.pInverted=e.pInverted),(e==null?void 0:e.qInverted)!==void 0&&(this.qInverted=e.qInverted),(e==null?void 0:e.fInverted)!==void 0&&(this.fInverted=e.fInverted),e!=null&&e.lWhitelist&&(this.lWhitelist=e.lWhitelist),e!=null&&e.rWhitelist&&(this.rWhitelist=e.rWhitelist),e!=null&&e.lsWhitelist&&(this.lsWhitelist=e.lsWhitelist),e!=null&&e.rsWhitelist&&(this.rsWhitelist=e.rsWhitelist),e!=null&&e.pWhitelist&&(this.pWhitelist=e.pWhitelist),e!=null&&e.qWhitelist&&(this.qWhitelist=e.qWhitelist),e!=null&&e.fWhitelist&&(this.fWhitelist=e.fWhitelist))}get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}}class Xa{constructor(){c(this,"isLegacy",!1);c(this,"loadClassesFromServer",async()=>{let e;try{e=await U.getClasses()}catch{return}const t=y(this.classFolders),s=y(this.classes);e.forEach(n=>{const r=n.split("/"),o=r.pop();if(!o)return;let a,l;if(r.forEach(h=>{l=a?a.getSubfolder(h):t.find(u=>u.name===h),l||(l=new M,l.name=h,l.location="server",a&&(a.add(l),l.updateParent(a))),!a&&!t.includes(l)&&t.push(l),a=l}),s.find(h=>h.name===n))return;const f=new ie({name:o,location:"server"});l&&l.add(f),s.push(f)}),this.classes.set(s)});c(this,"removeServerClasses",()=>{const e=y(this.classes);this.classes.set(e.filter(s=>s.location!=="server")),y(this.classFolders).filter(s=>s.location==="server").forEach(s=>this.deleteClassFolder(s,n=>n.location==="server"))});c(this,"loadClassTextToArray",e=>{const t=[],s=re(e),n=Object.keys(s);let r;if(n.length==1){const o=n[0];return o==="loaded"||(r=new ie({name:o}),r.load(s[o]),t.push(r)),t}for(const o of Object.keys(s))o!="loaded"&&(r=new ie({name:o}),r.load(s[o]),t.push(r));return t});c(this,"setupClassStore",(e,t,s,n,r)=>{let o=t;{const h=localStorage.getItem(e);h&&(o=s(h),r&&r(o))}const{subscribe:a,set:l,update:f}=N(o);return{subscribe:a,set:h=>(n&&(h=n(h)),l(h)),update:f}});c(this,"classes",this.setupClassStore(localStorage.getItem("classNames")?"classNames":"classData",[],e=>localStorage.getItem("classNames")?e.split(", ").map(t=>new ie({name:t,location:"local"})).filter(t=>localStorage.getItem("sapi.class."+t.name)):(localStorage.removeItem("classData"),this.isLegacy=!0,J(this.loadClassTextToArray(e))),e=>(this.persistClasses(e),e.forEach(t=>t.updateParent(e)),J(e)),e=>e.forEach(t=>t.updateParent(e))));c(this,"getClass",e=>{for(const t of y(this.classes))if(t.name==e)return t});c(this,"classFolders",this.setupClassStore("classFolders",[],e=>{if(!e||e==="null")return[];try{return JSON.parse(e,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return this.getClass(s);const n=new M(s.data);return n.name=s.name,n}return s}})}catch(t){return console.error("Error loading class folders. Folder data: "+e,t),ui("Error loading class folders. "+JSON.stringify(t)+`
Folder data: `+e),[]}},e=>{const t=JSON.stringify(e,(s,n)=>n instanceof ie||n instanceof se?n.name:s==="parent"?void 0:n);return localStorage.setItem("classFolders",t),J(e)}));c(this,"updateAllAttributes",e=>y(this.classes).forEach(t=>t.updateAttributes(e)));c(this,"isClassNameTaken",e=>!!this.getClass(e));c(this,"addClass",e=>{const t=y(this.classes);let s=t.length+1;for(;!e&&this.isClassNameTaken(e||"Class "+s);)s++;const n=new ie({name:e||"Class "+s});return t.push(n),this.classes.set(t),n.save(),n});c(this,"loadClass",async e=>{if(e.loaded)return;let t;if(e.location==="local")t=re(localStorage.getItem(`sapi.class.${e.name}`)||"");else{const n=await U.getClassYaml(e.name);if(!n)return;t=G.parse(n)}if(t===null||Object.values(t).length==0){console.warn(`Failed to parse yaml for class ${e.name}`,localStorage.getItem(`sapi.class.${e.name}`));return}const s=Object.values(t)[0];e.load(s),e.updateParent(y(this.classes)),e.loaded=!0});c(this,"cloneClass",async e=>{e.loaded||await this.loadClass(e);const t=y(this.classes);let s=e.name+" (Copy)",n=1;for(;this.isClassNameTaken(s);)s=e.name+" (Copy "+n+")",n++;const r=new ie,o=e.serializeYaml();return r.load(o),r.name=s,t.push(r),this.classes.set(t),r.save(),r});c(this,"addClassFolder",e=>{const t=y(this.classFolders);t.includes(e)||(fe.rename(e,t),t.push(e),t.sort((s,n)=>s.name.localeCompare(n.name)),this.classFolders.set(t))});c(this,"deleteClassFolder",(e,t)=>{const s=y(this.classFolders).filter(n=>n!=e);e.data.forEach(n=>{if(n instanceof M){if(t&&t(n)){this.deleteClassFolder(n,t);return}e.parent?e.parent.add(n):(n.updateParent(),s.push(n))}else e.parent&&e.parent.add(n)}),this.classFolders.set(s)});c(this,"deleteClass",e=>{const t=y(this.classes).filter(n=>n!=e),s=y(be);this.classes.set(t),localStorage.removeItem("sapi.class."+e.name),s instanceof ie&&(t.length===0?Ve(`${ze}/`):t.find(n=>n===y(be))||Ve(`${ze}/class/${t[0].name}/edit`).then(()=>{}))});c(this,"refreshClasses",()=>this.classes.set(J(y(this.classes))));c(this,"refreshClassFolders",()=>{this.classFolders.set(J(y(this.classFolders))),this.refreshClasses()});c(this,"loadClassText",(e,t=!1)=>{const s=re(e);if(!s||Object.keys(s).length===0)return;const n=Object.keys(s);let r;if(n.length==1){const o=n[0];r=this.isClassNameTaken(o)?this.getClass(o):this.addClass(o),t&&(r.location="server"),r.load(s[o]),this.refreshClasses();return}for(const o of Object.keys(s))o!="loaded"&&!this.isClassNameTaken(o)&&(r=this.isClassNameTaken(o)?this.getClass(o):this.addClass(o),r.load(s[o]));this.refreshClasses()});c(this,"loadClasses",e=>{var s;const t=(s=e.target)==null?void 0:s.result;t&&this.loadClassText(t)});c(this,"persistClasses",e=>{const t=(e||y(this.classes)).filter(s=>s.location==="local");localStorage.setItem("classNames",t.map(s=>s.name).join(", "))});U.onConnect(this.loadClassesFromServer),U.onDisconnect(this.removeServerClasses),this.isLegacy&&(y(this.classes).forEach(e=>{e.location==="local"&&e.save()}),this.persistClasses())}}const V=new Xa;export{Tl as $,P as A,Ha as B,bl as C,Bo as D,_o as E,ko as F,se as G,ie as H,ee as I,pn as J,Mt as K,jt as L,Kt as M,Zt as N,Sl as O,No as P,_l as Q,mt as R,Al as S,We as T,wl as U,fe as V,yl as W,ml as X,G as Y,M as Z,ol as _,be as a,vl as a0,kl as a1,al as a2,bs as a3,Nl as a4,wt as a5,Qa as a6,Ht as a7,X as a8,Ol as a9,El as aa,dl as ab,Co as b,pl as c,gn as d,U as e,vi as f,ji as g,Ut as h,Xt as i,cl as j,fl as k,Ao as l,vo as m,ul as n,gl as o,re as p,nl as q,Fe as r,F as s,hl as t,rl as u,ll as v,mn as w,V as x,ot as y,le as z};
