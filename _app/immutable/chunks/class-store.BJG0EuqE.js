var wr=Object.defineProperty;var kr=(i,e,t)=>e in i?wr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>(kr(i,typeof e!="symbol"?e+"":e,t),t);import{w as E,d as pe,g as Ve,b as ze}from"./entry.DBT9uuI8.js";import{_ as b,ad as pi,L as Sr,s as Us,q as Vi,a as qt,e as ke,g as $t,c as Se,b as dt,f as le,o as Y,$ as Je,i as He,h as ge,w as zi,x as Ji,y as Hi,J as Ft,ae as vr,p as _r,t as Os,d as Ts,u as pt,j as Ar,z as Qi,a4 as Or,a5 as Tr,a7 as $e,D as Gi,n as mi,X as Er,Y as Cr}from"./scheduler.BzVtFYUS.js";import{S as Ks,i as Ws,t as fe,g as Xi,a as ve,c as Zi,o as Es,p as Cs,h as gi,b as en,d as tn,m as sn,e as nn,f as Nr}from"./index.CfeTfVuV.js";const me=Object.create(null);me.open="0";me.close="1";me.ping="2";me.pong="3";me.message="4";me.upgrade="5";me.noop="6";const It=Object.create(null);Object.keys(me).forEach(i=>{It[me[i]]=i});const Ns={type:"error",data:"parser error"},rn=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",on=typeof ArrayBuffer=="function",ln=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,Ys=({type:i,data:e},t,s)=>rn&&e instanceof Blob?t?s(e):yi(e,s):on&&(e instanceof ArrayBuffer||ln(e))?t?s(e):yi(new Blob([e]),s):s(me[i]+(e||"")),yi=(i,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(i)};function bi(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let ds;function Ir(i,e){if(rn&&i.data instanceof Blob)return i.data.arrayBuffer().then(bi).then(e);if(on&&(i.data instanceof ArrayBuffer||ln(i.data)))return e(bi(i.data));Ys(i,!1,t=>{ds||(ds=new TextEncoder),e(ds.encode(t))})}const wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ct=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<wi.length;i++)ct[wi.charCodeAt(i)]=i;const Lr=i=>{let e=i.length*.75,t=i.length,s,n=0,r,o,l,a;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const f=new ArrayBuffer(e),h=new Uint8Array(f);for(s=0;s<t;s+=4)r=ct[i.charCodeAt(s)],o=ct[i.charCodeAt(s+1)],l=ct[i.charCodeAt(s+2)],a=ct[i.charCodeAt(s+3)],h[n++]=r<<2|o>>4,h[n++]=(o&15)<<4|l>>2,h[n++]=(l&3)<<6|a&63;return f},Br=typeof ArrayBuffer=="function",xs=(i,e)=>{if(typeof i!="string")return{type:"message",data:an(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:Rr(i.substring(1),e)}:It[t]?i.length>1?{type:It[t],data:i.substring(1)}:{type:It[t]}:Ns},Rr=(i,e)=>{if(Br){const t=Lr(i);return an(t,e)}else return{base64:!0,data:i}},an=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},cn="",Pr=(i,e)=>{const t=i.length,s=new Array(t);let n=0;i.forEach((r,o)=>{Ys(r,!1,l=>{s[o]=l,++n===t&&e(s.join(cn))})})},Dr=(i,e)=>{const t=i.split(cn),s=[];for(let n=0;n<t.length;n++){const r=xs(t[n],e);if(s.push(r),r.type==="error")break}return s};function qr(){return new TransformStream({transform(i,e){Ir(i,t=>{const s=t.length;let n;if(s<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,s);else if(s<65536){n=new Uint8Array(3);const r=new DataView(n.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{n=new Uint8Array(9);const r=new DataView(n.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}i.data&&typeof i.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}let ps;function _t(i){return i.reduce((e,t)=>e+t.length,0)}function At(i,e){if(i[0].length===e)return i.shift();const t=new Uint8Array(e);let s=0;for(let n=0;n<e;n++)t[n]=i[0][s++],s===i[0].length&&(i.shift(),s=0);return i.length&&s<i[0].length&&(i[0]=i[0].slice(s)),t}function $r(i,e){ps||(ps=new TextDecoder);const t=[];let s=0,n=-1,r=!1;return new TransformStream({transform(o,l){for(t.push(o);;){if(s===0){if(_t(t)<1)break;const a=At(t,1);r=(a[0]&128)===128,n=a[0]&127,n<126?s=3:n===126?s=1:s=2}else if(s===1){if(_t(t)<2)break;const a=At(t,2);n=new DataView(a.buffer,a.byteOffset,a.length).getUint16(0),s=3}else if(s===2){if(_t(t)<8)break;const a=At(t,8),f=new DataView(a.buffer,a.byteOffset,a.length),h=f.getUint32(0);if(h>Math.pow(2,21)-1){l.enqueue(Ns);break}n=h*Math.pow(2,32)+f.getUint32(4),s=3}else{if(_t(t)<n)break;const a=At(t,n);l.enqueue(xs(r?a:ps.decode(a),e)),s=0}if(n===0||n>i){l.enqueue(Ns);break}}}})}const fn=4;function D(i){if(i)return Fr(i)}function Fr(i){for(var e in D.prototype)i[e]=D.prototype[e];return i}D.prototype.on=D.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};D.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};D.prototype.off=D.prototype.removeListener=D.prototype.removeAllListeners=D.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var s,n=0;n<t.length;n++)if(s=t[n],s===e||s.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+i],this};D.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,n=t.length;s<n;++s)t[s].apply(this,e)}return this};D.prototype.emitReserved=D.prototype.emit;D.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};D.prototype.hasListeners=function(i){return!!this.listeners(i).length};const J=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function un(i,...e){return e.reduce((t,s)=>(i.hasOwnProperty(s)&&(t[s]=i[s]),t),{})}const Mr=J.setTimeout,jr=J.clearTimeout;function Qt(i,e){e.useNativeTimers?(i.setTimeoutFn=Mr.bind(J),i.clearTimeoutFn=jr.bind(J)):(i.setTimeoutFn=J.setTimeout.bind(J),i.clearTimeoutFn=J.clearTimeout.bind(J))}const Ur=1.33;function Kr(i){return typeof i=="string"?Wr(i):Math.ceil((i.byteLength||i.size)*Ur)}function Wr(i){let e=0,t=0;for(let s=0,n=i.length;s<n;s++)e=i.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function Yr(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function xr(i){let e={},t=i.split("&");for(let s=0,n=t.length;s<n;s++){let r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}class Vr extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class Vs extends D{constructor(e){super(),this.writable=!1,Qt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,s){return super.emitReserved("error",new Vr(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=xs(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Yr(e);return t.length?"?"+t:""}}const hn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Is=64,zr={};let ki=0,Ot=0,Si;function vi(i){let e="";do e=hn[i%Is]+e,i=Math.floor(i/Is);while(i>0);return e}function dn(){const i=vi(+new Date);return i!==Si?(ki=0,Si=i):i+"."+vi(ki++)}for(;Ot<Is;Ot++)zr[hn[Ot]]=Ot;let pn=!1;try{pn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Jr=pn;function mn(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Jr))return new XMLHttpRequest}catch{}if(!e)try{return new J[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Hr(){}const Qr=function(){return new mn({xdomain:!1}).responseType!=null}();class Gr extends Vs{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const s=location.protocol==="https:";let n=location.port;n||(n=s?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=Qr&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let s=0;this.polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Dr(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Pr(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=dn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new he(this.uri(),e)}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(n,r)=>{this.onError("xhr post error",n,r)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class he extends D{constructor(e,t){super(),Qt(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;const t=un(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const s=this.xhr=new mn(t);try{s.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&s.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(s.timeout=this.opts.requestTimeout),s.onreadystatechange=()=>{var n;s.readyState===3&&((n=this.opts.cookieJar)===null||n===void 0||n.parseCookies(s)),s.readyState===4&&(s.status===200||s.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof s.status=="number"?s.status:0)},0))},s.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=he.requestsCount++,he.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Hr,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete he.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}he.requestsCount=0;he.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",_i);else if(typeof addEventListener=="function"){const i="onpagehide"in J?"pagehide":"unload";addEventListener(i,_i,!1)}}function _i(){for(let i in he.requests)he.requests.hasOwnProperty(i)&&he.requests[i].abort()}const zs=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Tt=J.WebSocket||J.MozWebSocket,Ai=!0,Xr="arraybuffer",Oi=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Zr extends Vs{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,s=Oi?{}:un(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=Ai&&!Oi?t?new Tt(e,t):new Tt(e):new Tt(e,t,s)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;Ys(s,this.supportsBinary,r=>{const o={};try{Ai&&this.ws.send(r)}catch{}n&&zs(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=dn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Tt}}class eo extends Vs{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const t=$r(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),n=qr();n.readable.pipeTo(e.writable),this.writer=n.writable.getWriter();const r=()=>{s.read().then(({done:l,value:a})=>{l||(this.onPacket(a),r())}).catch(l=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;this.writer.write(s).then(()=>{n&&zs(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const to={websocket:Zr,webtransport:eo,polling:Gr},so=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,io=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ls(i){if(i.length>2e3)throw"URI too long";const e=i,t=i.indexOf("["),s=i.indexOf("]");t!=-1&&s!=-1&&(i=i.substring(0,t)+i.substring(t,s).replace(/:/g,";")+i.substring(s,i.length));let n=so.exec(i||""),r={},o=14;for(;o--;)r[io[o]]=n[o]||"";return t!=-1&&s!=-1&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=no(r,r.path),r.queryKey=ro(r,r.query),r}function no(i,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function ro(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,n,r){n&&(t[n]=r)}),t}let gn=class qe extends D{constructor(e,t={}){super(),this.binaryType=Xr,this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Ls(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Ls(t.host).host),Qt(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=xr(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=fn,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new to[e](s)}open(){let e;if(this.opts.rememberUpgrade&&qe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),s=!1;qe.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!s)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;qe.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function r(){s||(s=!0,h(),t.close(),t=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=t.name,r(),this.emitReserved("upgradeError",d)};function l(){o("transport closed")}function a(){o("socket closed")}function f(u){t&&u.name!==t.name&&r()}const h=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",l),this.off("close",a),this.off("upgrading",f)};t.once("open",n),t.once("error",o),t.once("close",l),this.once("close",a),this.once("upgrading",f),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onOpen(){if(this.readyState="open",qe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(t+=Kr(n)),s>0&&t>this.maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}write(e,t,s){return this.sendPacket("message",e,t,s),this}send(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,n){if(typeof t=="function"&&(n=t,t=void 0),typeof s=="function"&&(n=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}onError(e){qe.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let s=0;const n=e.length;for(;s<n;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}};gn.protocol=fn;function oo(i,e="",t){let s=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),s=Ls(i)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(t&&t.port===s.port?"":":"+s.port),s}const lo=typeof ArrayBuffer=="function",ao=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,yn=Object.prototype.toString,co=typeof Blob=="function"||typeof Blob<"u"&&yn.call(Blob)==="[object BlobConstructor]",fo=typeof File=="function"||typeof File<"u"&&yn.call(File)==="[object FileConstructor]";function Js(i){return lo&&(i instanceof ArrayBuffer||ao(i))||co&&i instanceof Blob||fo&&i instanceof File}function Lt(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,s=i.length;t<s;t++)if(Lt(i[t]))return!0;return!1}if(Js(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return Lt(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&Lt(i[t]))return!0;return!1}function uo(i){const e=[],t=i.data,s=i;return s.data=Bs(t,e),s.attachments=e.length,{packet:s,buffers:e}}function Bs(i,e){if(!i)return i;if(Js(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let s=0;s<i.length;s++)t[s]=Bs(i[s],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=Bs(i[s],e));return t}return i}function ho(i,e){return i.data=Rs(i.data,e),delete i.attachments,i}function Rs(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=Rs(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=Rs(i[t],e));return i}const po=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],mo=5;var T;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(T||(T={}));class go{constructor(e){this.replacer=e}encode(e){return(e.type===T.EVENT||e.type===T.ACK)&&Lt(e)?this.encodeAsBinary({type:e.type===T.EVENT?T.BINARY_EVENT:T.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===T.BINARY_EVENT||e.type===T.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=uo(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}function Ti(i){return Object.prototype.toString.call(i)==="[object Object]"}class Hs extends D{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===T.BINARY_EVENT;s||t.type===T.BINARY_ACK?(t.type=s?T.EVENT:T.ACK,this.reconstructor=new yo(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Js(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(T[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===T.BINARY_EVENT||s.type===T.BINARY_ACK){const r=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(r,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){const r=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(r,t)}else s.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const r=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(Hs.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case T.CONNECT:return Ti(t);case T.DISCONNECT:return t===void 0;case T.CONNECT_ERROR:return typeof t=="string"||Ti(t);case T.EVENT:case T.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&po.indexOf(t[0])===-1);case T.ACK:case T.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class yo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=ho(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const bo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Hs,Encoder:go,get PacketType(){return T},protocol:mo},Symbol.toStringTag,{value:"Module"}));function re(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const wo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class bn extends D{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[re(e,"open",this.onopen.bind(this)),re(e,"packet",this.onpacket.bind(this)),re(e,"error",this.onerror.bind(this)),re(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(wo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const s={type:T.EVENT,data:t};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,l=t.pop();this._registerAckCallback(o,l),s.id=o}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,t){var s;const n=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&this.sendBuffer.splice(l,1);t.call(this,new Error("operation has timed out"))},n),o=(...l)=>{this.io.clearTimeoutFn(r),t.apply(this,l)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,n)=>{const r=(o,l)=>o?n(o):s(l);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...r)=>s!==this._queue[0]?void 0:(n!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(n)):(this._queue.shift(),t&&t(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:T.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case T.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case T.EVENT:case T.BINARY_EVENT:this.onevent(e);break;case T.ACK:case T.BINARY_ACK:this.onack(e);break;case T.DISCONNECT:this.ondisconnect();break;case T.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...n){s||(s=!0,t.packet({type:T.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:T.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function Xe(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}Xe.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=Math.floor(e*10)&1?i+t:i-t}return Math.min(i,this.max)|0};Xe.prototype.reset=function(){this.attempts=0};Xe.prototype.setMin=function(i){this.ms=i};Xe.prototype.setMax=function(i){this.max=i};Xe.prototype.setJitter=function(i){this.jitter=i};class Ps extends D{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Qt(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Xe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||bo;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new gn(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=re(t,"open",function(){s.onopen(),e&&e()}),r=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},o=re(t,"error",r);if(this._timeout!==!1){const l=this._timeout,a=this.setTimeoutFn(()=>{n(),r(new Error("timeout")),t.close()},l);this.opts.autoUnref&&a.unref(),this.subs.push(()=>{this.clearTimeoutFn(a)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(re(e,"ping",this.onping.bind(this)),re(e,"data",this.ondata.bind(this)),re(e,"error",this.onerror.bind(this)),re(e,"close",this.onclose.bind(this)),re(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){zs(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new bn(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const lt={};function ms(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=oo(i,e.path||"/socket.io"),s=t.source,n=t.id,r=t.path,o=lt[n]&&r in lt[n].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let a;return l?a=new Ps(s,e):(lt[n]||(lt[n]=new Ps(s,e)),a=lt[n]),t.query&&!e.query&&(e.query=t.queryKey),a.socket(t.path,e)}Object.assign(ms,{Manager:Ps,Socket:bn,io:ms,connect:ms});const na=(()=>{let i=!0;{const n=localStorage.getItem("show-summary-items");i=n!==null?n==="true":i}const{subscribe:e,set:t,update:s}=E(i);return{subscribe:e,set:n=>(localStorage.setItem("show-summary-items",String(n)),t(n)),update:s}})(),ra=(()=>{let i=!0;i=localStorage.getItem("use-symbols")==="true";const{subscribe:e,set:t,update:s}=E(i);return{subscribe:e,set:n=>(localStorage.setItem("use-symbols",String(n)),t(n)),update:s}})(),oa=(()=>{let i=!0;{const n=localStorage.getItem("animation-enabled");i=n!==null?n==="true":i}const{subscribe:e,set:t,update:s}=E(i);return{subscribe:e,set:n=>(localStorage.setItem("animation-enabled",String(n)),t(n)),update:s}})(),la=E(!1),Z=E(!1),gs=E(-1);class ko{constructor(){c(this,"socket");c(this,"sessionId","");c(this,"clientId","");c(this,"serverId","");c(this,"dcTimeout",4*60*1e3);c(this,"_dcTask",null);c(this,"_dcWarningTask",null);c(this,"_onConnect",[]);c(this,"_onDisconnect",[]);c(this,"keyphrase",E(""));this.socket=null}onConnect(e){this._onConnect.includes(e)||this._onConnect.push(e)}offConnect(e){this._onConnect=this._onConnect.filter(t=>t!==e)}clearOnConnect(){this._onConnect=[]}onDisconnect(e){this._onDisconnect.includes(e)||this._onDisconnect.push(e)}offDisconnect(e){this._onDisconnect=this._onDisconnect.filter(t=>t!==e)}clearOnDisconnect(){this._onDisconnect=[]}connect(e,t=void 0){return null}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}resetTimeout(){this._dcTask&&window.clearTimeout(this._dcTask),this._dcWarningTask&&window.clearTimeout(this._dcWarningTask),gs.set(-1),this.dcTimeout>=6e4?this._dcWarningTask=window.setTimeout(()=>gs.set(60),this.dcTimeout-6e4):this.dcTimeout>=1e3&&gs.set(this.dcTimeout/1e3),this._dcTask=window.setTimeout(()=>{var e;return(e=this.socket)==null?void 0:e.disconnect()},this.dcTimeout)}ping(){this.socket&&(this.socket.emit("ping",{to:this.serverId}),this.resetTimeout())}emit(e,t){!this.socket||!b(Z)||(this.socket.emit(e,t),this.resetTimeout())}reloadSapi(){return new Promise((e,t)=>{if(!this.socket||!b(Z)){t("No socket");return}this.socket.timeout(1e4).emitWithAck("reload",{to:this.serverId}).then(s=>{s[0]===!0?(e(!0),this.resetTimeout()):t(s[0])}).catch(s=>t(s))})}getClasses(){return!this.socket||!b(Z)?Promise.reject("No socket"):(this.socket.emit("getClasses",{to:this.serverId}),new Promise((e,t)=>{var s;(s=this.socket)==null||s.on("classes",({content:n})=>{var r;(r=this.socket)==null||r.off("classes"),typeof n=="string"&&(n=[n]),e(n)}),setTimeout(()=>t("Timeout"),3e3)}))}getSkills(){return!this.socket||!b(Z)?Promise.reject("No socket"):(this.socket.emit("getSkills",{to:this.serverId}),new Promise((e,t)=>{var s;(s=this.socket)==null||s.on("skills",({content:n})=>{var r;(r=this.socket)==null||r.off("skills"),typeof n=="string"&&(n=[n]),e(n)}),setTimeout(()=>t("Timeout"),3e3)}))}getClassYaml(e){return!this.socket||!b(Z)?Promise.reject("No socket"):(this.socket.emit("getClassYaml",{name:e,to:this.serverId}),new Promise((t,s)=>{var n;(n=this.socket)==null||n.on("classYaml",({content:r})=>{var o;(o=this.socket)==null||o.off("classYaml"),t(r)}),setTimeout(()=>s("Timeout"),3e3)}))}getSkillYaml(e){return!this.socket||!b(Z)?Promise.reject("No socket"):(this.socket.emit("getSkillYaml",{name:e,to:this.serverId}),new Promise((t,s)=>{var n;(n=this.socket)==null||n.on("skillYaml",({content:r})=>{var o;(o=this.socket)==null||o.off("skillYaml"),t(r)}),setTimeout(()=>s("Timeout"),3e3)}))}getAttributeYaml(){return!this.socket||!b(Z)?Promise.reject("No socket"):(this.socket.emit("getAttributeYaml",{to:this.serverId}),new Promise((e,t)=>{var s;(s=this.socket)==null||s.on("attributeYaml",({content:n})=>{var r;(r=this.socket)==null||r.off("attributeYaml"),e(n)}),setTimeout(()=>t("Timeout"),3e3)}))}async saveSkillToServer(e,t){if(!this.socket||!b(Z))return Promise.reject("No socket");try{const s=await this.socket.timeout(3e3).emitWithAck("saveSkill",{name:e,yaml:t,to:this.serverId}),n=s&&s[0]===e;return n||console.log("Error saving skill",s),this.resetTimeout(),n}catch(s){return console.log("Timeout saving skill to server",s),!1}}async saveClassToServer(e,t){if(!this.socket||!b(Z))return Promise.reject("No socket");try{const s=await this.socket.timeout(3e3).emitWithAck("saveClass",{name:e,yaml:t,to:this.serverId}),n=s&&s[0]===e;return n||console.log("Error saving class",s),this.resetTimeout(),n}catch(s){return console.log("Timeout saving class to server",s),!1}}async saveAttributesToServer(e){if(!this.socket||!b(Z))return console.log("socket not connected"),Promise.reject("No socket");try{const t=await this.socket.timeout(3e3).emitWithAck("saveAttributes",{yaml:e,to:this.serverId}),s=t&&t[0]==="attributes";return s||console.log("Error saving attribute",t),this.resetTimeout(),s}catch(t){return console.log("Timeout saving attribute to server",t),!1}}async exportAll(e,t,s){if(!this.socket||!b(Z))return Promise.reject("No socket");try{const n=await this.socket.timeout(4500).emitWithAck("exportAll",{to:this.serverId,classYaml:e,skillYaml:t,attributeYaml:s});return n&&n[0]?!!n[0]:(this.resetTimeout(),console.log("Error exporting all",n),!1)}catch(n){return console.log("Timeout exporting all",n),!1}}}const K=new ko;class wn{}c(wn,"new",()=>{throw new Error("'new' method not implemented")});class So extends wn{constructor(t,s,n=!1){super();c(this,"type");c(this,"name");c(this,"description");c(this,"comment");c(this,"components",E([]));c(this,"data",[]);c(this,"preview",[]);c(this,"enablePreview",!1);c(this,"summaryItems",[]);c(this,"isParent",!0);c(this,"isDeprecated",!1);c(this,"id",{});c(this,"_defaultOpen",!1);c(this,"parent");c(this,"setComponents",t=>{t.forEach(s=>s.parent=this),this.components.set([...t])});c(this,"contains",t=>{const s=b(this.components);if(s.includes(t))return!0;for(const n of s)if(n.contains(t))return!0;return!1});c(this,"addComponent",(t,s=-1)=>{const n=b(this.components);s==-1?n.push(t):n.splice(s,0,t),this.setComponents(n)});c(this,"removeComponent",t=>{const s=b(this.components);if(s.includes(t)){s.splice(s.indexOf(t),1),t.parent=void 0,this.setComponents(s);return}for(const n of s)n.contains(t)&&n.removeComponent(t)});c(this,"defaultOpen",()=>(this._defaultOpen=!0,this));c(this,"nextChar",t=>/z$/.test(t)?t.replaceAll(/z$/g,"a")+"a":t.substring(0,t.length-1)+String.fromCharCode(t.charCodeAt(t.length-1)+1));this.type=t,this.name=s.name,this.description=s.description??"",this.summaryItems=s.summaryItems??[],this.comment=s.comment??"",this.setComponents(s.components||[]),this.data=s.data||[],this.preview=s.preview||[],this.isDeprecated=n}getValue(t){var n;const s=(n=this.data)==null?void 0:n.find(r=>r.key==t);return!s||!s.meetsRequirements(this)?"":s.getSummary()}toYamlObj(){const t={type:this.type,comment:this.comment};if(this.preview.length>0){const n={enabled:this.enablePreview};this.preview.filter(r=>r.meetsPreviewRequirements(this)).forEach(r=>{const o=r.getData();Object.keys(o).forEach(l=>n[l]=o[l])}),t.preview=n}const s=this.getData();if(Object.keys(s).length>0&&(t.data=s),this.isParent){const n=b(this.components);if(n.length>0){const r={};n.forEach(o=>{const l=o.toYamlObj();let a=o.name,f="a";for(;r[a];)f=this.nextChar(f),a=o.name+"-"+f;r[a]=l}),t.children=r}}return t}getRawPreviewData(){const t={};return this.preview.forEach(s=>{const n=s.getData();Object.keys(n).forEach(r=>t[r]=n[r])}),t}deserialize(t){const s=t.preview;s&&(this.enablePreview=s.enabled,this.preview.forEach(n=>n.deserialize(s))),t.comment&&(this.comment=t.comment.replaceAll("\\n",`
`))}}const kn=E({}),Mt=E({}),jt=E({}),Ut=E({}),Sn=E(!1),Gt=E(""),vo=pe([kn,Gt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),aa=pe(vo,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),ca=pe([Mt,Gt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),fa=pe([jt,Gt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),_o=pe([Ut,Gt],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),ua=pe(_o,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),se=class se{};c(se,"getTriggerByName",e=>{var s;return(s=Object.values(b(kn)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(se,"getTargetByName",e=>{var s;return(s=Object.values(b(Mt)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(se,"getConditionByName",e=>{var s;return(s=Object.values(b(jt)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(se,"getMechanicByName",e=>{var s;return(s=Object.values(b(Ut)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),c(se,"deserializeComponents",e=>{if(!e)return[];const t=[],s=Object.keys(e);for(const n of s){let r;const o=e[n],l=o.type;if(l==="trigger"){const a=se.getTriggerByName(n.split("-")[0]);a&&(r=a.new())}else if(l==="target"){const a=se.getTargetByName(n.split("-")[0]);a&&(r=a.new())}else if(l==="condition"){const a=se.getConditionByName(n.split("-")[0]);a&&(r=a.new())}else if(l==="mechanic"){const a=se.getMechanicByName(n.split("-")[0]);a&&(r=a.new())}r&&(r.deserialize(o),t.push(r))}return t});let mt=se;function ha(i){return--i*i*((1.70158+1)*i+1.70158)+1}function vn(i){const e=i-1;return e*e*e+1}function da(i){return i/=.5,i<1?.5*i*i:(i--,-.5*(i*(i-2)-1))}function pa(i,{delay:e=0,duration:t=400,easing:s=Sr}={}){const n=+getComputedStyle(i).opacity;return{delay:e,duration:t,easing:s,css:r=>`opacity: ${r*n}`}}function Ei(i,{delay:e=0,duration:t=400,easing:s=vn,x:n=0,y:r=0,opacity:o=0}={}){const l=getComputedStyle(i),a=+l.opacity,f=l.transform==="none"?"":l.transform,h=a*(1-o),[u,d]=pi(n),[g,w]=pi(r);return{delay:e,duration:t,easing:s,css:(p,m)=>`
			transform: ${f} translate(${(1-p)*u}${d}, ${(1-p)*g}${w});
			opacity: ${a-h*m}`}}function Fe(i,{delay:e=0,duration:t=400,easing:s=vn,axis:n="y"}={}){const r=getComputedStyle(i),o=+r.opacity,l=n==="y"?"height":"width",a=parseFloat(r[l]),f=n==="y"?["top","bottom"]:["left","right"],h=f.map(k=>`${k[0].toUpperCase()}${k.slice(1)}`),u=parseFloat(r[`padding${h[0]}`]),d=parseFloat(r[`padding${h[1]}`]),g=parseFloat(r[`margin${h[0]}`]),w=parseFloat(r[`margin${h[1]}`]),p=parseFloat(r[`border${h[0]}Width`]),m=parseFloat(r[`border${h[1]}Width`]);return{delay:e,duration:t,easing:s,css:k=>`overflow: hidden;opacity: ${Math.min(k*20,1)*o};${l}: ${k*a}px;padding-${f[0]}: ${k*u}px;padding-${f[1]}: ${k*d}px;margin-${f[0]}: ${k*g}px;margin-${f[1]}: ${k*w}px;border-${f[0]}-width: ${k*p}px;border-${f[1]}-width: ${k*m}px;`}}const Ao=i=>i.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),_n=i=>(i=i.replace("_"," "),i.substring(0,1).toUpperCase()+i.substring(1).toLowerCase()),H=i=>i.sort((e,t)=>e.name.localeCompare(t.name)),Oo=(i,e)=>{let t=e;localStorage.getItem(i)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(i,e.toString()):localStorage.setItem(i,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(i)):typeof e=="boolean"?t=localStorage.getItem(i)==="true":typeof e=="string"?t=localStorage.getItem(i):t=JSON.parse(localStorage.getItem(i));const{subscribe:s,set:n,update:r}=E(t);return{subscribe:s,set:o=>(typeof o=="string"||typeof o=="number"||typeof o=="boolean"?localStorage.setItem(i,o.toString()):localStorage.setItem(i,JSON.stringify(o)),n(o)),update:r}},ee=i=>typeof i=="boolean"?i:i==="true",To=i=>({}),Ci=i=>({});function Ni(i){let e,t,s,n=(i[2]||"")+"",r,o,l,a,f,h,u,d,g,w=i[1]&&i[1].length>0&&i[8]&&Ii(i);const p=i[15].label,m=Vi(p,i,i[14],Ci);return{c(){e=ke("div"),w&&w.c(),t=qt(),s=ke("span"),r=Os(n),o=qt(),m&&m.c(),this.h()},l(k){e=Se(k,"DIV",{class:!0});var S=dt(e);w&&w.l(S),t=$t(S),s=Se(S,"SPAN",{class:!0,role:!0});var v=dt(s);r=Ts(v,n),o=$t(v),m&&m.l(v),v.forEach(le),S.forEach(le),this.h()},h(){Y(s,"class","display svelte-1aj70cs"),Y(s,"role","definition"),Je(s,"nowrap",i[4]),Y(e,"class","label svelte-1aj70cs")},m(k,S){He(k,e,S),w&&w.m(e,null),ge(e,t),ge(e,s),ge(s,r),ge(s,o),m&&m.m(s,null),u=!0,d||(g=[pt(s,"mouseenter",i[10]),pt(s,"mouseleave",i[16])],d=!0)},p(k,S){k[1]&&k[1].length>0&&k[8]?w?(w.p(k,S),S&258&&fe(w,1)):(w=Ii(k),w.c(),fe(w,1),w.m(e,t)):w&&(Xi(),ve(w,1,1,()=>{w=null}),Zi()),(!u||S&4)&&n!==(n=(k[2]||"")+"")&&Ar(r,n),m&&m.p&&(!u||S&16384)&&zi(m,p,k,k[14],u?Hi(p,k[14],S,To):Ji(k[14]),Ci),(!u||S&16)&&Je(s,"nowrap",k[4])},i(k){u||(fe(w),fe(m,k),k&&Ft(()=>{u&&(a&&a.end(1),l=Es(s,i[6],{fn:Fe}),l.start())}),k&&Ft(()=>{u&&(h&&h.end(1),f=Es(e,i[6],{fn:Fe}),f.start())}),u=!0)},o(k){ve(w),ve(m,k),l&&l.invalidate(),k&&(a=Cs(s,Fe,{})),f&&f.invalidate(),k&&(h=Cs(e,i[6],{fn:Fe})),u=!1},d(k){k&&le(e),w&&w.d(),m&&m.d(k),k&&a&&a.end(),k&&h&&h.end(),d=!1,Qi(g)}}}function Ii(i){let e,t,s,n;return{c(){e=ke("div"),t=new Or(!1),this.h()},l(r){e=Se(r,"DIV",{class:!0});var o=dt(e);t=Tr(o,!1),o.forEach(le),this.h()},h(){t.a=null,Y(e,"class","tooltip svelte-1aj70cs"),Je(e,"top",i[9]<window.innerHeight/2.5)},m(r,o){He(r,e,o),t.m(i[1],e),n=!0},p(r,o){(!n||o&2)&&t.p(r[1]),(!n||o&512)&&Je(e,"top",r[9]<window.innerHeight/2.5)},i(r){n||(r&&Ft(()=>{n&&(s||(s=gi(e,Ei,{x:-20,duration:100},!0)),s.run(1))}),n=!0)},o(r){r&&(s||(s=gi(e,Ei,{x:-20,duration:100},!1)),s.run(0)),n=!1},d(r){r&&le(e),r&&s&&s.end()}}}function Li(i){let e,t,s;return{c(){e=ke("input"),this.h()},l(n){e=Se(n,"INPUT",{placeholder:!0,class:!0}),this.h()},h(){e.disabled=i[5],Y(e,"placeholder",i[3]),Y(e,"class","svelte-1aj70cs")},m(n,r){He(n,e,r),i[17](e),$e(e,i[0]),t||(s=pt(e,"input",i[18]),t=!0)},p(n,r){r&32&&(e.disabled=n[5]),r&8&&Y(e,"placeholder",n[3]),r&1&&e.value!==n[0]&&$e(e,n[0])},d(n){n&&le(e),i[17](null),t=!1,s()}}}function Eo(i){let e,t,s,n,r,o,l=(i[11].label||i[2])&&Ni(i),a=(!!i[0]||i[0]===""||i[0]===0)&&Li(i);const f=i[15].default,h=Vi(f,i,i[14],null);return{c(){l&&l.c(),e=qt(),t=ke("div"),a&&a.c(),s=qt(),h&&h.c(),this.h()},l(u){l&&l.l(u),e=$t(u),t=Se(u,"DIV",{class:!0});var d=dt(t);a&&a.l(d),s=$t(d),h&&h.l(d),d.forEach(le),this.h()},h(){Y(t,"class","input-wrapper"),Je(t,"labeled",!!i[2])},m(u,d){l&&l.m(u,d),He(u,e,d),He(u,t,d),a&&a.m(t,null),ge(t,s),h&&h.m(t,null),o=!0},p(u,[d]){u[11].label||u[2]?l?(l.p(u,d),d&2052&&fe(l,1)):(l=Ni(u),l.c(),fe(l,1),l.m(e.parentNode,e)):l&&(Xi(),ve(l,1,1,()=>{l=null}),Zi()),u[0]||u[0]===""||u[0]===0?a?a.p(u,d):(a=Li(u),a.c(),a.m(t,s)):a&&(a.d(1),a=null),h&&h.p&&(!o||d&16384)&&zi(h,f,u,u[14],o?Hi(f,u[14],d,null):Ji(u[14]),null),(!o||d&4)&&Je(t,"labeled",!!u[2])},i(u){o||(fe(l),fe(h,u),u&&Ft(()=>{o&&(r&&r.end(1),n=Es(t,i[6],{fn:Fe}),n.start())}),o=!0)},o(u){ve(l),ve(h,u),n&&n.invalidate(),u&&(r=Cs(t,i[6],{fn:Fe})),o=!1},d(u){u&&(le(e),le(t)),l&&l.d(u),a&&a.d(),h&&h.d(u),u&&r&&r.end()}}}function Co(i,e,t){let{$$slots:s={},$$scope:n}=e;const r=vr(s);let{tooltip:o=void 0}=e,{label:l=void 0}=e,{value:a=void 0}=e,{placeholder:f=void 0}=e,{nowrap:h=!1}=e,{autofocus:u=!1}=e,{disabled:d=!1}=e,{disableAnimation:g=!1}=e,w,p=!1,m=0;_r(()=>{u&&w&&w.focus()});const k=(y,C)=>(g&&(C.duration=0),C.fn(y,C)),S=y=>{y.target&&(t(9,m=y.target.getBoundingClientRect().top),t(8,p=!0))},v=()=>t(8,p=!1);function _(y){Gi[y?"unshift":"push"](()=>{w=y,t(7,w)})}function O(){a=this.value,t(0,a)}return i.$$set=y=>{"tooltip"in y&&t(1,o=y.tooltip),"label"in y&&t(2,l=y.label),"value"in y&&t(0,a=y.value),"placeholder"in y&&t(3,f=y.placeholder),"nowrap"in y&&t(4,h=y.nowrap),"autofocus"in y&&t(12,u=y.autofocus),"disabled"in y&&t(5,d=y.disabled),"disableAnimation"in y&&t(13,g=y.disableAnimation),"$$scope"in y&&t(14,n=y.$$scope)},[a,o,l,f,h,d,k,w,p,m,S,r,u,g,n,s,v,_,O]}class No extends Ks{constructor(e){super(),Ws(this,e,Co,Eo,Us,{tooltip:1,label:2,value:0,placeholder:3,nowrap:4,autofocus:12,disabled:5,disableAnimation:13,maybe:6})}get maybe(){return this.$$.ctx[6]}}class Io{constructor(){c(this,"requirements",{});c(this,"requireValue",(e,t)=>(this.requirements[e]=t,this));c(this,"meetsRequirements",e=>{for(const t in this.requirements)if(!this.requirements[t].includes(e.getData(!0)[t]))return!1;return!0});c(this,"meetsPreviewRequirements",e=>{for(const t in this.requirements)if(!this.requirements[t].includes(e.getRawPreviewData()[t]))return!1;return!0})}}const ht=class ht extends So{constructor(t,s=!1){super("trigger",t,s);c(this,"mana",!1);c(this,"cooldown",!1);c(this,"clone",()=>new ht({name:this.name,components:[...b(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]}));this.mana=t.mana||!1,this.cooldown=t.cooldown||!1}getData(t=!1){const s={};return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(s.mana=this.mana,s.cooldown=this.cooldown),this.data.filter(n=>t||n.meetsRequirements(this)).forEach(n=>{const r=n.getData();Object.keys(r).forEach(o=>s[o]=r[o])}),s}deserialize(t){super.deserialize(t);const s=t.data;s&&(this.mana=ee(s.mana),this.cooldown=ee(s.cooldown),this.data.forEach(n=>n.deserialize(s))),t.children&&Object.keys(t.children).length>0&&this.setComponents(mt.deserializeComponents(t.children))}};c(ht,"new",()=>new ht({name:"null"}));let Kt=ht;function Lo(i){let e,t,s,n,r,o,l;return{c(){e=ke("div"),t=ke("input"),s=Os(`
	+(
	`),n=ke("input"),r=Os(`
	
	
	)`),this.h()},l(a){e=Se(a,"DIV",{class:!0});var f=dt(e);t=Se(f,"INPUT",{class:!0,placeholder:!0}),s=Ts(f,`
	+(
	`),n=Se(f,"INPUT",{class:!0,placeholder:!0}),r=Ts(f,`
	
	
	)`),f.forEach(le),this.h()},h(){Y(t,"class","base svelte-1x8zii"),Y(t,"placeholder","0"),Y(n,"class","modifier svelte-1x8zii"),Y(n,"placeholder","0"),Y(e,"class","wrap svelte-1x8zii")},m(a,f){He(a,e,f),ge(e,t),$e(t,i[0].base),ge(e,s),ge(e,n),$e(n,i[0].scale),ge(e,r),o||(l=[pt(t,"input",i[1]),pt(n,"input",i[2])],o=!0)},p(a,[f]){f&1&&t.value!==a[0].base&&$e(t,a[0].base),f&1&&n.value!==a[0].scale&&$e(n,a[0].scale)},i:mi,o:mi,d(a){a&&le(e),o=!1,Qi(l)}}}function Bo(i,e,t){let{value:s}=e;function n(){s.base=this.value,t(0,s)}function r(){s.scale=this.value,t(0,s)}return i.$$set=o=>{"value"in o&&t(0,s=o.value)},[s,n,r]}class Ro extends Ks{constructor(e){super(),Ws(this,e,Bo,Lo,Us,{value:0})}}function Po(i){let e,t,s;function n(o){i[3](o)}let r={};return i[0]!==void 0&&(r.value=i[0]),e=new Ro({props:r}),Gi.push(()=>Nr(e,"value",n)),{c(){en(e.$$.fragment)},l(o){tn(e.$$.fragment,o)},m(o,l){sn(e,o,l),s=!0},p(o,l){const a={};!t&&l&1&&(t=!0,a.value=o[0],Cr(()=>t=!1)),e.$set(a)},i(o){s||(fe(e.$$.fragment,o),s=!0)},o(o){ve(e.$$.fragment,o),s=!1},d(o){nn(e,o)}}}function Do(i){let e,t;return e=new No({props:{label:i[1],tooltip:i[2],$$slots:{default:[Po]},$$scope:{ctx:i}}}),{c(){en(e.$$.fragment)},l(s){tn(e.$$.fragment,s)},m(s,n){sn(e,s,n),t=!0},p(s,[n]){const r={};n&2&&(r.label=s[1]),n&4&&(r.tooltip=s[2]),n&33&&(r.$$scope={dirty:n,ctx:s}),e.$set(r)},i(s){t||(fe(e.$$.fragment,s),t=!0)},o(s){ve(e.$$.fragment,s),t=!1},d(s){nn(e,s)}}}function qo(i,e,t){let{data:s}=e,{name:n=""}=e,{tooltip:r=void 0}=e;const o=Er();function l(a){s=a,t(0,s)}return i.$$set=a=>{"data"in a&&t(0,s=a.data),"name"in a&&t(1,n=a.name),"tooltip"in a&&t(2,r=a.tooltip)},i.$$.update=()=>{i.$$.dirty&1&&s&&o("save")},[s,n,r,l]}class $o extends Ks{constructor(e){super(),Ws(this,e,qo,Do,Us,{data:0,name:1,tooltip:2})}}class R{constructor(e,t,s){c(this,"name");c(this,"base");c(this,"scale");this.name=e,this.base=t,this.scale=s}}class Xt extends Io{constructor(t,s,n=0,r=0){super();c(this,"component",$o);c(this,"name");c(this,"key");c(this,"data");c(this,"tooltip");c(this,"setTooltip",t=>(this.tooltip=t,this));c(this,"clone",()=>new Xt(this.name,this.key,this.data.base,this.data.scale));c(this,"getData",()=>{const t={};return t[`${this.key}-base`]=this.data.base||0,t[`${this.key}-scale`]=this.data.scale||0,t});c(this,"getSummary",()=>this.data.base.toString());c(this,"deserialize",t=>{this.data.base=t[`${this.key}-base`]||0,this.data.scale=t[`${this.key}-scale`]||0});this.name=t,this.key=s,this.data=new R(t,n,r)}}const Qs=Symbol.for("yaml.alias"),Ds=Symbol.for("yaml.document"),_e=Symbol.for("yaml.map"),An=Symbol.for("yaml.pair"),be=Symbol.for("yaml.scalar"),Ze=Symbol.for("yaml.seq"),G=Symbol.for("yaml.node.type"),Le=i=>!!i&&typeof i=="object"&&i[G]===Qs,et=i=>!!i&&typeof i=="object"&&i[G]===Ds,tt=i=>!!i&&typeof i=="object"&&i[G]===_e,I=i=>!!i&&typeof i=="object"&&i[G]===An,N=i=>!!i&&typeof i=="object"&&i[G]===be,st=i=>!!i&&typeof i=="object"&&i[G]===Ze;function L(i){if(i&&typeof i=="object")switch(i[G]){case _e:case Ze:return!0}return!1}function P(i){if(i&&typeof i=="object")switch(i[G]){case Qs:case _e:case be:case Ze:return!0}return!1}const Fo=i=>(N(i)||L(i))&&!!i.anchor,W=Symbol("break visit"),On=Symbol("skip children"),de=Symbol("remove node");function Ae(i,e){const t=Tn(e);et(i)?Me(null,i.contents,t,Object.freeze([i]))===de&&(i.contents=null):Me(null,i,t,Object.freeze([]))}Ae.BREAK=W;Ae.SKIP=On;Ae.REMOVE=de;function Me(i,e,t,s){const n=En(i,e,t,s);if(P(n)||I(n))return Cn(i,s,n),Me(i,n,t,s);if(typeof n!="symbol"){if(L(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){const o=Me(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===W)return W;o===de&&(e.items.splice(r,1),r-=1)}}}else if(I(e)){s=Object.freeze(s.concat(e));const r=Me("key",e.key,t,s);if(r===W)return W;r===de&&(e.key=null);const o=Me("value",e.value,t,s);if(o===W)return W;o===de&&(e.value=null)}}return n}async function Zt(i,e){const t=Tn(e);et(i)?await je(null,i.contents,t,Object.freeze([i]))===de&&(i.contents=null):await je(null,i,t,Object.freeze([]))}Zt.BREAK=W;Zt.SKIP=On;Zt.REMOVE=de;async function je(i,e,t,s){const n=await En(i,e,t,s);if(P(n)||I(n))return Cn(i,s,n),je(i,n,t,s);if(typeof n!="symbol"){if(L(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){const o=await je(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===W)return W;o===de&&(e.items.splice(r,1),r-=1)}}}else if(I(e)){s=Object.freeze(s.concat(e));const r=await je("key",e.key,t,s);if(r===W)return W;r===de&&(e.key=null);const o=await je("value",e.value,t,s);if(o===W)return W;o===de&&(e.value=null)}}return n}function Tn(i){return typeof i=="object"&&(i.Collection||i.Node||i.Value)?Object.assign({Alias:i.Node,Map:i.Node,Scalar:i.Node,Seq:i.Node},i.Value&&{Map:i.Value,Scalar:i.Value,Seq:i.Value},i.Collection&&{Map:i.Collection,Seq:i.Collection},i):i}function En(i,e,t,s){var n,r,o,l,a;if(typeof t=="function")return t(i,e,s);if(tt(e))return(n=t.Map)==null?void 0:n.call(t,i,e,s);if(st(e))return(r=t.Seq)==null?void 0:r.call(t,i,e,s);if(I(e))return(o=t.Pair)==null?void 0:o.call(t,i,e,s);if(N(e))return(l=t.Scalar)==null?void 0:l.call(t,i,e,s);if(Le(e))return(a=t.Alias)==null?void 0:a.call(t,i,e,s)}function Cn(i,e,t){const s=e[e.length-1];if(L(s))s.items[i]=t;else if(I(s))i==="key"?s.key=t:s.value=t;else if(et(s))s.contents=t;else{const n=Le(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}const Mo={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},jo=i=>i.replace(/[!,[\]{}]/g,e=>Mo[e]);class U{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},U.defaultYaml,e),this.tags=Object.assign({},U.defaultTags,t)}clone(){const e=new U(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new U(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:U.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},U.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:U.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},U.defaultTags),this.atNextDocument=!1);const s=e.trim().split(/[ \t]+/),n=s.shift();switch(n){case"%TAG":{if(s.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;const[r,o]=s;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[r]=s;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const o=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,o),!1}}default:return t(0,`Unknown directive ${n}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const o=e.slice(2,-1);return o==="!"||o==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),o)}const[,s,n]=e.match(/^(.*!)([^!]*)$/s);n||t(`The ${e} tag has no suffix`);const r=this.tags[s];if(r)try{return r+decodeURIComponent(n)}catch(o){return t(String(o)),null}return s==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,s]of Object.entries(this.tags))if(e.startsWith(s))return t+jo(e.substring(s.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags);let n;if(e&&s.length>0&&P(e.contents)){const r={};Ae(e.contents,(o,l)=>{P(l)&&l.tag&&(r[l.tag]=!0)}),n=Object.keys(r)}else n=[];for(const[r,o]of s)r==="!!"&&o==="tag:yaml.org,2002:"||(!e||n.some(l=>l.startsWith(o)))&&t.push(`%TAG ${r} ${o}`);return t.join(`
`)}}U.defaultYaml={explicit:!1,version:"1.2"};U.defaultTags={"!!":"tag:yaml.org,2002:"};function Nn(i){if(/[\x00-\x19\s,[\]{}]/.test(i)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(i)}`;throw new Error(t)}return!0}function In(i){const e=new Set;return Ae(i,{Value(t,s){s.anchor&&e.add(s.anchor)}}),e}function Ln(i,e){for(let t=1;;++t){const s=`${i}${t}`;if(!e.has(s))return s}}function Uo(i,e){const t=[],s=new Map;let n=null;return{onAnchor:r=>{t.push(r),n||(n=In(i));const o=Ln(e,n);return n.add(o),o},setAnchors:()=>{for(const r of t){const o=s.get(r);if(typeof o=="object"&&o.anchor&&(N(o.node)||L(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=r,l}}},sourceObjects:s}}function Ue(i,e,t,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let n=0,r=s.length;n<r;++n){const o=s[n],l=Ue(i,s,String(n),o);l===void 0?delete s[n]:l!==o&&(s[n]=l)}else if(s instanceof Map)for(const n of Array.from(s.keys())){const r=s.get(n),o=Ue(i,s,n,r);o===void 0?s.delete(n):o!==r&&s.set(n,o)}else if(s instanceof Set)for(const n of Array.from(s)){const r=Ue(i,s,n,n);r===void 0?s.delete(n):r!==n&&(s.delete(n),s.add(r))}else for(const[n,r]of Object.entries(s)){const o=Ue(i,s,n,r);o===void 0?delete s[n]:o!==r&&(s[n]=o)}return i.call(e,t,s)}function Q(i,e,t){if(Array.isArray(i))return i.map((s,n)=>Q(s,String(n),t));if(i&&typeof i.toJSON=="function"){if(!t||!Fo(i))return i.toJSON(e,t);const s={aliasCount:0,count:1,res:void 0};t.anchors.set(i,s),t.onCreate=r=>{s.res=r,delete t.onCreate};const n=i.toJSON(e,t);return t.onCreate&&t.onCreate(n),n}return typeof i=="bigint"&&!(t!=null&&t.keep)?Number(i):i}class Gs{constructor(e){Object.defineProperty(this,G,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:s,onAnchor:n,reviver:r}={}){if(!et(e))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},l=Q(this,"",o);if(typeof n=="function")for(const{count:a,res:f}of o.anchors.values())n(f,a);return typeof r=="function"?Ue(r,{"":l},"",l):l}}class es extends Gs{constructor(e){super(Qs),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return Ae(e,{Node:(s,n)=>{if(n===this)return Ae.BREAK;n.anchor===this.source&&(t=n)}}),t}toJSON(e,t){if(!t)return{source:this.source};const{anchors:s,doc:n,maxAliasCount:r}=t,o=this.resolve(n);if(!o){const a=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(a)}let l=s.get(o);if(l||(Q(o,null,t),l=s.get(o)),!l||l.res===void 0){const a="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(a)}if(r>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=Bt(n,o,s)),l.count*l.aliasCount>r)){const a="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(a)}return l.res}toString(e,t,s){const n=`*${this.source}`;if(e){if(Nn(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${n} `}return n}}function Bt(i,e,t){if(Le(e)){const s=e.resolve(i),n=t&&s&&t.get(s);return n?n.count*n.aliasCount:0}else if(L(e)){let s=0;for(const n of e.items){const r=Bt(i,n,t);r>s&&(s=r)}return s}else if(I(e)){const s=Bt(i,e.key,t),n=Bt(i,e.value,t);return Math.max(s,n)}return 1}const Bn=i=>!i||typeof i!="function"&&typeof i!="object";class A extends Gs{constructor(e){super(be),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:Q(this.value,e,t)}toString(){return String(this.value)}}A.BLOCK_FOLDED="BLOCK_FOLDED";A.BLOCK_LITERAL="BLOCK_LITERAL";A.PLAIN="PLAIN";A.QUOTE_DOUBLE="QUOTE_DOUBLE";A.QUOTE_SINGLE="QUOTE_SINGLE";const Ko="tag:yaml.org,2002:";function Wo(i,e,t){if(e){const s=t.filter(r=>r.tag===e),n=s.find(r=>!r.format)??s[0];if(!n)throw new Error(`Tag ${e} not found`);return n}return t.find(s=>{var n;return((n=s.identify)==null?void 0:n.call(s,i))&&!s.format})}function gt(i,e,t){var u,d,g;if(et(i)&&(i=i.contents),P(i))return i;if(I(i)){const w=(d=(u=t.schema[_e]).createNode)==null?void 0:d.call(u,t.schema,null,t);return w.items.push(i),w}(i instanceof String||i instanceof Number||i instanceof Boolean||typeof BigInt<"u"&&i instanceof BigInt)&&(i=i.valueOf());const{aliasDuplicateObjects:s,onAnchor:n,onTagObj:r,schema:o,sourceObjects:l}=t;let a;if(s&&i&&typeof i=="object"){if(a=l.get(i),a)return a.anchor||(a.anchor=n(i)),new es(a.anchor);a={anchor:null,node:null},l.set(i,a)}e!=null&&e.startsWith("!!")&&(e=Ko+e.slice(2));let f=Wo(i,e,o.tags);if(!f){if(i&&typeof i.toJSON=="function"&&(i=i.toJSON()),!i||typeof i!="object"){const w=new A(i);return a&&(a.node=w),w}f=i instanceof Map?o[_e]:Symbol.iterator in Object(i)?o[Ze]:o[_e]}r&&(r(f),delete t.onTagObj);const h=f!=null&&f.createNode?f.createNode(t.schema,i,t):typeof((g=f==null?void 0:f.nodeClass)==null?void 0:g.from)=="function"?f.nodeClass.from(t.schema,i,t):new A(i);return e?h.tag=e:f.default||(h.tag=f.tag),a&&(a.node=h),h}function Wt(i,e,t){let s=t;for(let n=e.length-1;n>=0;--n){const r=e[n];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const o=[];o[r]=s,s=o}else s=new Map([[r,s]])}return gt(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:i,sourceObjects:new Map})}const ft=i=>i==null||typeof i=="object"&&!!i[Symbol.iterator]().next().done;class Xs extends Gs{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(s=>P(s)||I(s)?s.clone(e):s),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(ft(e))this.add(t);else{const[s,...n]=e,r=this.get(s,!0);if(L(r))r.addIn(n,t);else if(r===void 0&&this.schema)this.set(s,Wt(this.schema,n,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}deleteIn(e){const[t,...s]=e;if(s.length===0)return this.delete(t);const n=this.get(t,!0);if(L(n))return n.deleteIn(s);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${s}`)}getIn(e,t){const[s,...n]=e,r=this.get(s,!0);return n.length===0?!t&&N(r)?r.value:r:L(r)?r.getIn(n,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!I(t))return!1;const s=t.value;return s==null||e&&N(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(e){const[t,...s]=e;if(s.length===0)return this.has(t);const n=this.get(t,!0);return L(n)?n.hasIn(s):!1}setIn(e,t){const[s,...n]=e;if(n.length===0)this.set(s,t);else{const r=this.get(s,!0);if(L(r))r.setIn(n,t);else if(r===void 0&&this.schema)this.set(s,Wt(this.schema,n,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}}Xs.maxFlowStringSingleLineLength=60;const Yo=i=>i.replace(/^(?!$)(?: $)?/gm,"#");function ye(i,e){return/^\n+$/.test(i)?i.substring(1):e?i.replace(/^(?! *$)/gm,e):i}const Ee=(i,e,t)=>i.endsWith(`
`)?ye(t,e):t.includes(`
`)?`
`+ye(t,e):(i.endsWith(" ")?"":" ")+t,Rn="flow",qs="block",Rt="quoted";function ts(i,e,t="flow",{indentAtStart:s,lineWidth:n=80,minContentWidth:r=20,onFold:o,onOverflow:l}={}){if(!n||n<0)return i;const a=Math.max(1+r,1+n-e.length);if(i.length<=a)return i;const f=[],h={};let u=n-e.length;typeof s=="number"&&(s>n-Math.max(2,r)?f.push(0):u=n-s);let d,g,w=!1,p=-1,m=-1,k=-1;t===qs&&(p=Bi(i,p,e.length),p!==-1&&(u=p+a));for(let v;v=i[p+=1];){if(t===Rt&&v==="\\"){switch(m=p,i[p+1]){case"x":p+=3;break;case"u":p+=5;break;case"U":p+=9;break;default:p+=1}k=p}if(v===`
`)t===qs&&(p=Bi(i,p,e.length)),u=p+e.length+a,d=void 0;else{if(v===" "&&g&&g!==" "&&g!==`
`&&g!=="	"){const _=i[p+1];_&&_!==" "&&_!==`
`&&_!=="	"&&(d=p)}if(p>=u)if(d)f.push(d),u=d+a,d=void 0;else if(t===Rt){for(;g===" "||g==="	";)g=v,v=i[p+=1],w=!0;const _=p>k+1?p-2:m-1;if(h[_])return i;f.push(_),h[_]=!0,u=_+a,d=void 0}else w=!0}g=v}if(w&&l&&l(),f.length===0)return i;o&&o();let S=i.slice(0,f[0]);for(let v=0;v<f.length;++v){const _=f[v],O=f[v+1]||i.length;_===0?S=`
${e}${i.slice(0,O)}`:(t===Rt&&h[_]&&(S+=`${i[_]}\\`),S+=`
${e}${i.slice(_+1,O)}`)}return S}function Bi(i,e,t){let s=e,n=e+1,r=i[n];for(;r===" "||r==="	";)if(e<n+t)r=i[++e];else{do r=i[++e];while(r&&r!==`
`);s=e,n=e+1,r=i[n]}return s}const ss=(i,e)=>({indentAtStart:e?i.indent.length:i.indentAtStart,lineWidth:i.options.lineWidth,minContentWidth:i.options.minContentWidth}),is=i=>/^(%|---|\.\.\.)/m.test(i);function xo(i,e,t){if(!e||e<0)return!1;const s=e-t,n=i.length;if(n<=s)return!1;for(let r=0,o=0;r<n;++r)if(i[r]===`
`){if(r-o>s)return!0;if(o=r+1,n-o<=s)return!1}return!0}function ut(i,e){const t=JSON.stringify(i);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:s}=e,n=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(is(i)?"  ":"");let o="",l=0;for(let a=0,f=t[a];f;f=t[++a])if(f===" "&&t[a+1]==="\\"&&t[a+2]==="n"&&(o+=t.slice(l,a)+"\\ ",a+=1,l=a,f="\\"),f==="\\")switch(t[a+1]){case"u":{o+=t.slice(l,a);const h=t.substr(a+2,4);switch(h){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:h.substr(0,2)==="00"?o+="\\x"+h.substr(2):o+=t.substr(a,6)}a+=5,l=a+1}break;case"n":if(s||t[a+2]==='"'||t.length<n)a+=1;else{for(o+=t.slice(l,a)+`

`;t[a+2]==="\\"&&t[a+3]==="n"&&t[a+4]!=='"';)o+=`
`,a+=2;o+=r,t[a+2]===" "&&(o+="\\"),a+=1,l=a+1}break;default:a+=1}return o=l?o+t.slice(l):t,s?o:ts(o,r,Rt,ss(e,!1))}function $s(i,e){if(e.options.singleQuote===!1||e.implicitKey&&i.includes(`
`)||/[ \t]\n|\n[ \t]/.test(i))return ut(i,e);const t=e.indent||(is(i)?"  ":""),s="'"+i.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?s:ts(s,t,Rn,ss(e,!1))}function Ke(i,e){const{singleQuote:t}=e.options;let s;if(t===!1)s=ut;else{const n=i.includes('"'),r=i.includes("'");n&&!r?s=$s:r&&!n?s=ut:s=t?$s:ut}return s(i,e)}let Fs;try{Fs=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Fs=/\n+(?!\n|$)/g}function Pt({comment:i,type:e,value:t},s,n,r){const{blockQuote:o,commentString:l,lineWidth:a}=s.options;if(!o||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return Ke(t,s);const f=s.indent||(s.forceBlockIndent||is(t)?"  ":""),h=o==="literal"?!0:o==="folded"||e===A.BLOCK_FOLDED?!1:e===A.BLOCK_LITERAL?!0:!xo(t,a,f.length);if(!t)return h?`|
`:`>
`;let u,d;for(d=t.length;d>0;--d){const y=t[d-1];if(y!==`
`&&y!=="	"&&y!==" ")break}let g=t.substring(d);const w=g.indexOf(`
`);w===-1?u="-":t===g||w!==g.length-1?(u="+",r&&r()):u="",g&&(t=t.slice(0,-g.length),g[g.length-1]===`
`&&(g=g.slice(0,-1)),g=g.replace(Fs,`$&${f}`));let p=!1,m,k=-1;for(m=0;m<t.length;++m){const y=t[m];if(y===" ")p=!0;else if(y===`
`)k=m;else break}let S=t.substring(0,k<m?k+1:m);S&&(t=t.substring(S.length),S=S.replace(/\n+/g,`$&${f}`));let _=(h?"|":">")+(p?f?"2":"1":"")+u;if(i&&(_+=" "+l(i.replace(/ ?[\r\n]+/g," ")),n&&n()),h)return t=t.replace(/\n+/g,`$&${f}`),`${_}
${f}${S}${t}${g}`;t=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${f}`);const O=ts(`${S}${t}${g}`,f,qs,ss(s,!0));return`${_}
${f}${O}`}function Vo(i,e,t,s){const{type:n,value:r}=i,{actualString:o,implicitKey:l,indent:a,indentStep:f,inFlow:h}=e;if(l&&r.includes(`
`)||h&&/[[\]{},]/.test(r))return Ke(r,e);if(!r||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return l||h||!r.includes(`
`)?Ke(r,e):Pt(i,e,t,s);if(!l&&!h&&n!==A.PLAIN&&r.includes(`
`))return Pt(i,e,t,s);if(is(r)){if(a==="")return e.forceBlockIndent=!0,Pt(i,e,t,s);if(l&&a===f)return Ke(r,e)}const u=r.replace(/\n+/g,`$&
${a}`);if(o){const d=p=>{var m;return p.default&&p.tag!=="tag:yaml.org,2002:str"&&((m=p.test)==null?void 0:m.test(u))},{compat:g,tags:w}=e.doc.schema;if(w.some(d)||g!=null&&g.some(d))return Ke(r,e)}return l?u:ts(u,a,Rn,ss(e,!1))}function kt(i,e,t,s){const{implicitKey:n,inFlow:r}=e,o=typeof i.value=="string"?i:Object.assign({},i,{value:String(i.value)});let{type:l}=i;l!==A.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=A.QUOTE_DOUBLE);const a=h=>{switch(h){case A.BLOCK_FOLDED:case A.BLOCK_LITERAL:return n||r?Ke(o.value,e):Pt(o,e,t,s);case A.QUOTE_DOUBLE:return ut(o.value,e);case A.QUOTE_SINGLE:return $s(o.value,e);case A.PLAIN:return Vo(o,e,t,s);default:return null}};let f=a(l);if(f===null){const{defaultKeyType:h,defaultStringType:u}=e.options,d=n&&h||u;if(f=a(d),f===null)throw new Error(`Unsupported default string type ${d}`)}return f}function Pn(i,e){const t=Object.assign({blockQuote:!0,commentString:Yo,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},i.schema.toStringOptions,e);let s;switch(t.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:i,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:s,options:t}}function zo(i,e){var n;if(e.tag){const r=i.filter(o=>o.tag===e.tag);if(r.length>0)return r.find(o=>o.format===e.format)??r[0]}let t,s;if(N(e)){s=e.value;const r=i.filter(o=>{var l;return(l=o.identify)==null?void 0:l.call(o,s)});t=r.find(o=>o.format===e.format)??r.find(o=>!o.format)}else s=e,t=i.find(r=>r.nodeClass&&s instanceof r.nodeClass);if(!t){const r=((n=s==null?void 0:s.constructor)==null?void 0:n.name)??typeof s;throw new Error(`Tag not resolved for ${r} value`)}return t}function Jo(i,e,{anchors:t,doc:s}){if(!s.directives)return"";const n=[],r=(N(i)||L(i))&&i.anchor;r&&Nn(r)&&(t.add(r),n.push(`&${r}`));const o=i.tag?i.tag:e.default?null:e.tag;return o&&n.push(s.directives.tagString(o)),n.join(" ")}function Qe(i,e,t,s){var a;if(I(i))return i.toString(e,t,s);if(Le(i)){if(e.doc.directives)return i.toString(e);if((a=e.resolvedAliases)!=null&&a.has(i))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(i):e.resolvedAliases=new Set([i]),i=i.resolve(e.doc)}let n;const r=P(i)?i:e.doc.createNode(i,{onTagObj:f=>n=f});n||(n=zo(e.doc.schema.tags,r));const o=Jo(r,n,e);o.length>0&&(e.indentAtStart=(e.indentAtStart??0)+o.length+1);const l=typeof n.stringify=="function"?n.stringify(r,e,t,s):N(r)?kt(r,e,t,s):r.toString(e,t,s);return o?N(r)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${e.indent}${l}`:l}function Ho({key:i,value:e},t,s,n){const{allNullValues:r,doc:o,indent:l,indentStep:a,options:{commentString:f,indentSeq:h,simpleKeys:u}}=t;let d=P(i)&&i.comment||null;if(u){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(L(i)){const C="With simple keys, collection cannot be used as a key value";throw new Error(C)}}let g=!u&&(!i||d&&e==null&&!t.inFlow||L(i)||(N(i)?i.type===A.BLOCK_FOLDED||i.type===A.BLOCK_LITERAL:typeof i=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!g&&(u||!r),indent:l+a});let w=!1,p=!1,m=Qe(i,t,()=>w=!0,()=>p=!0);if(!g&&!t.inFlow&&m.length>1024){if(u)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");g=!0}if(t.inFlow){if(r||e==null)return w&&s&&s(),m===""?"?":g?`? ${m}`:m}else if(r&&!u||e==null&&g)return m=`? ${m}`,d&&!w?m+=Ee(m,t.indent,f(d)):p&&n&&n(),m;w&&(d=null),g?(d&&(m+=Ee(m,t.indent,f(d))),m=`? ${m}
${l}:`):(m=`${m}:`,d&&(m+=Ee(m,t.indent,f(d))));let k,S,v;P(e)?(k=!!e.spaceBefore,S=e.commentBefore,v=e.comment):(k=!1,S=null,v=null,e&&typeof e=="object"&&(e=o.createNode(e))),t.implicitKey=!1,!g&&!d&&N(e)&&(t.indentAtStart=m.length+1),p=!1,!h&&a.length>=2&&!t.inFlow&&!g&&st(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let _=!1;const O=Qe(e,t,()=>_=!0,()=>p=!0);let y=" ";if(d||k||S){if(y=k?`
`:"",S){const C=f(S);y+=`
${ye(C,t.indent)}`}O===""&&!t.inFlow?y===`
`&&(y=`

`):y+=`
${t.indent}`}else if(!g&&L(e)){const C=O[0],B=O.indexOf(`
`),M=B!==-1,Te=t.inFlow??e.flow??e.items.length===0;if(M||!Te){let Be=!1;if(M&&(C==="&"||C==="!")){let $=O.indexOf(" ");C==="&"&&$!==-1&&$<B&&O[$+1]==="!"&&($=O.indexOf(" ",$+1)),($===-1||B<$)&&(Be=!0)}Be||(y=`
${t.indent}`)}}else(O===""||O[0]===`
`)&&(y="");return m+=y+O,t.inFlow?_&&s&&s():v&&!_?m+=Ee(m,t.indent,f(v)):p&&n&&n(),m}function Dn(i,e){(i==="debug"||i==="warn")&&(typeof process<"u"&&process.emitWarning?process.emitWarning(e):console.warn(e))}const Ri="<<";function qn(i,e,{key:t,value:s}){if(i!=null&&i.doc.schema.merge&&Qo(t))if(s=Le(s)?s.resolve(i.doc):s,st(s))for(const n of s.items)ys(i,e,n);else if(Array.isArray(s))for(const n of s)ys(i,e,n);else ys(i,e,s);else{const n=Q(t,"",i);if(e instanceof Map)e.set(n,Q(s,n,i));else if(e instanceof Set)e.add(n);else{const r=Go(t,n,i),o=Q(s,r,i);r in e?Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[r]=o}}return e}const Qo=i=>i===Ri||N(i)&&i.value===Ri&&(!i.type||i.type===A.PLAIN);function ys(i,e,t){const s=i&&Le(t)?t.resolve(i.doc):t;if(!tt(s))throw new Error("Merge sources must be maps or map aliases");const n=s.toJSON(null,i,Map);for(const[r,o]of n)e instanceof Map?e.has(r)||e.set(r,o):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}function Go(i,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(P(i)&&(t!=null&&t.doc)){const s=Pn(t.doc,{});s.anchors=new Set;for(const r of t.anchors.keys())s.anchors.add(r.anchor);s.inFlow=!0,s.inStringifyKey=!0;const n=i.toString(s);if(!t.mapKeyWarned){let r=JSON.stringify(n);r.length>40&&(r=r.substring(0,36)+'..."'),Dn(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return n}return JSON.stringify(e)}function Zs(i,e,t){const s=gt(i,void 0,t),n=gt(e,void 0,t);return new j(s,n)}class j{constructor(e,t=null){Object.defineProperty(this,G,{value:An}),this.key=e,this.value=t}clone(e){let{key:t,value:s}=this;return P(t)&&(t=t.clone(e)),P(s)&&(s=s.clone(e)),new j(t,s)}toJSON(e,t){const s=t!=null&&t.mapAsMap?new Map:{};return qn(t,s,this)}toString(e,t,s){return e!=null&&e.doc?Ho(this,e,t,s):JSON.stringify(this)}}function $n(i,e,t){return(e.inFlow??i.flow?Zo:Xo)(i,e,t)}function Xo({comment:i,items:e},t,{blockItemPrefix:s,flowChars:n,itemIndent:r,onChompKeep:o,onComment:l}){const{indent:a,options:{commentString:f}}=t,h=Object.assign({},t,{indent:r,type:null});let u=!1;const d=[];for(let w=0;w<e.length;++w){const p=e[w];let m=null;if(P(p))!u&&p.spaceBefore&&d.push(""),Yt(t,d,p.commentBefore,u),p.comment&&(m=p.comment);else if(I(p)){const S=P(p.key)?p.key:null;S&&(!u&&S.spaceBefore&&d.push(""),Yt(t,d,S.commentBefore,u))}u=!1;let k=Qe(p,h,()=>m=null,()=>u=!0);m&&(k+=Ee(k,r,f(m))),u&&m&&(u=!1),d.push(s+k)}let g;if(d.length===0)g=n.start+n.end;else{g=d[0];for(let w=1;w<d.length;++w){const p=d[w];g+=p?`
${a}${p}`:`
`}}return i?(g+=`
`+ye(f(i),a),l&&l()):u&&o&&o(),g}function Zo({items:i},e,{flowChars:t,itemIndent:s}){const{indent:n,indentStep:r,flowCollectionPadding:o,options:{commentString:l}}=e;s+=r;const a=Object.assign({},e,{indent:s,inFlow:!0,type:null});let f=!1,h=0;const u=[];for(let w=0;w<i.length;++w){const p=i[w];let m=null;if(P(p))p.spaceBefore&&u.push(""),Yt(e,u,p.commentBefore,!1),p.comment&&(m=p.comment);else if(I(p)){const S=P(p.key)?p.key:null;S&&(S.spaceBefore&&u.push(""),Yt(e,u,S.commentBefore,!1),S.comment&&(f=!0));const v=P(p.value)?p.value:null;v?(v.comment&&(m=v.comment),v.commentBefore&&(f=!0)):p.value==null&&(S!=null&&S.comment)&&(m=S.comment)}m&&(f=!0);let k=Qe(p,a,()=>m=null);w<i.length-1&&(k+=","),m&&(k+=Ee(k,s,l(m))),!f&&(u.length>h||k.includes(`
`))&&(f=!0),u.push(k),h=u.length}const{start:d,end:g}=t;if(u.length===0)return d+g;if(!f){const w=u.reduce((p,m)=>p+m.length+2,2);f=e.options.lineWidth>0&&w>e.options.lineWidth}if(f){let w=d;for(const p of u)w+=p?`
${r}${n}${p}`:`
`;return`${w}
${n}${g}`}else return`${d}${o}${u.join(" ")}${o}${g}`}function Yt({indent:i,options:{commentString:e}},t,s,n){if(s&&n&&(s=s.replace(/^\n+/,"")),s){const r=ye(e(s),i);t.push(r.trimStart())}}function Ce(i,e){const t=N(e)?e.value:e;for(const s of i)if(I(s)&&(s.key===e||s.key===t||N(s.key)&&s.key.value===t))return s}class x extends Xs{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(_e,e),this.items=[]}static from(e,t,s){const{keepUndefined:n,replacer:r}=s,o=new this(e),l=(a,f)=>{if(typeof r=="function")f=r.call(t,a,f);else if(Array.isArray(r)&&!r.includes(a))return;(f!==void 0||n)&&o.items.push(Zs(a,f,s))};if(t instanceof Map)for(const[a,f]of t)l(a,f);else if(t&&typeof t=="object")for(const a of Object.keys(t))l(a,t[a]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,t){var o;let s;I(e)?s=e:!e||typeof e!="object"||!("key"in e)?s=new j(e,e==null?void 0:e.value):s=new j(e.key,e.value);const n=Ce(this.items,s.key),r=(o=this.schema)==null?void 0:o.sortMapEntries;if(n){if(!t)throw new Error(`Key ${s.key} already set`);N(n.value)&&Bn(s.value)?n.value.value=s.value:n.value=s.value}else if(r){const l=this.items.findIndex(a=>r(s,a)<0);l===-1?this.items.push(s):this.items.splice(l,0,s)}else this.items.push(s)}delete(e){const t=Ce(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const s=Ce(this.items,e),n=s==null?void 0:s.value;return(!t&&N(n)?n.value:n)??void 0}has(e){return!!Ce(this.items,e)}set(e,t){this.add(new j(e,t),!0)}toJSON(e,t,s){const n=s?new s:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(n);for(const r of this.items)qn(t,n,r);return n}toString(e,t,s){if(!e)return JSON.stringify(this);for(const n of this.items)if(!I(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),$n(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:s,onComment:t})}}const it={collection:"map",default:!0,nodeClass:x,tag:"tag:yaml.org,2002:map",resolve(i,e){return tt(i)||e("Expected a mapping for this tag"),i},createNode:(i,e,t)=>x.from(i,e,t)};class Oe extends Xs{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Ze,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=Et(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const s=Et(e);if(typeof s!="number")return;const n=this.items[s];return!t&&N(n)?n.value:n}has(e){const t=Et(e);return typeof t=="number"&&t<this.items.length}set(e,t){const s=Et(e);if(typeof s!="number")throw new Error(`Expected a valid index, not ${e}.`);const n=this.items[s];N(n)&&Bn(t)?n.value=t:this.items[s]=t}toJSON(e,t){const s=[];t!=null&&t.onCreate&&t.onCreate(s);let n=0;for(const r of this.items)s.push(Q(r,String(n++),t));return s}toString(e,t,s){return e?$n(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:s,onComment:t}):JSON.stringify(this)}static from(e,t,s){const{replacer:n}=s,r=new this(e);if(t&&Symbol.iterator in Object(t)){let o=0;for(let l of t){if(typeof n=="function"){const a=t instanceof Set?l:String(o++);l=n.call(t,a,l)}r.items.push(gt(l,void 0,s))}}return r}}function Et(i){let e=N(i)?i.value:i;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const nt={collection:"seq",default:!0,nodeClass:Oe,tag:"tag:yaml.org,2002:seq",resolve(i,e){return st(i)||e("Expected a sequence for this tag"),i},createNode:(i,e,t)=>Oe.from(i,e,t)},ns={identify:i=>typeof i=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:i=>i,stringify(i,e,t,s){return e=Object.assign({actualString:!0},e),kt(i,e,t,s)}},rs={identify:i=>i==null,createNode:()=>new A(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new A(null),stringify:({source:i},e)=>typeof i=="string"&&rs.test.test(i)?i:e.options.nullStr},ei={identify:i=>typeof i=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:i=>new A(i[0]==="t"||i[0]==="T"),stringify({source:i,value:e},t){if(i&&ei.test.test(i)){const s=i[0]==="t"||i[0]==="T";if(e===s)return i}return e?t.options.trueStr:t.options.falseStr}};function ae({format:i,minFractionDigits:e,tag:t,value:s}){if(typeof s=="bigint")return String(s);const n=typeof s=="number"?s:Number(s);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let r=JSON.stringify(s);if(!i&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let l=e-(r.length-o-1);for(;l-- >0;)r+="0"}return r}const Fn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN))$/,resolve:i=>i.slice(-3).toLowerCase()==="nan"?NaN:i[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ae},Mn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:i=>parseFloat(i),stringify(i){const e=Number(i.value);return isFinite(e)?e.toExponential():ae(i)}},jn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(i){const e=new A(parseFloat(i)),t=i.indexOf(".");return t!==-1&&i[i.length-1]==="0"&&(e.minFractionDigits=i.length-t-1),e},stringify:ae},os=i=>typeof i=="bigint"||Number.isInteger(i),ti=(i,e,t,{intAsBigInt:s})=>s?BigInt(i):parseInt(i.substring(e),t);function Un(i,e,t){const{value:s}=i;return os(s)&&s>=0?t+s.toString(e):ae(i)}const Kn={identify:i=>os(i)&&i>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(i,e,t)=>ti(i,2,8,t),stringify:i=>Un(i,8,"0o")},Wn={identify:os,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(i,e,t)=>ti(i,0,10,t),stringify:ae},Yn={identify:i=>os(i)&&i>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(i,e,t)=>ti(i,2,16,t),stringify:i=>Un(i,16,"0x")},el=[it,nt,ns,rs,ei,Kn,Wn,Yn,Fn,Mn,jn];function Pi(i){return typeof i=="bigint"||Number.isInteger(i)}const Ct=({value:i})=>JSON.stringify(i),tl=[{identify:i=>typeof i=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:i=>i,stringify:Ct},{identify:i=>i==null,createNode:()=>new A(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Ct},{identify:i=>typeof i=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:i=>i==="true",stringify:Ct},{identify:Pi,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(i,e,{intAsBigInt:t})=>t?BigInt(i):parseInt(i,10),stringify:({value:i})=>Pi(i)?i.toString():JSON.stringify(i)},{identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:i=>parseFloat(i),stringify:Ct}],sl={default:!0,tag:"",test:/^/,resolve(i,e){return e(`Unresolved plain scalar ${JSON.stringify(i)}`),i}},il=[it,nt].concat(tl,sl),si={identify:i=>i instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(i,e){if(typeof Buffer=="function")return Buffer.from(i,"base64");if(typeof atob=="function"){const t=atob(i.replace(/[\n\r]/g,"")),s=new Uint8Array(t.length);for(let n=0;n<t.length;++n)s[n]=t.charCodeAt(n);return s}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),i},stringify({comment:i,type:e,value:t},s,n,r){const o=t;let l;if(typeof Buffer=="function")l=o instanceof Buffer?o.toString("base64"):Buffer.from(o.buffer).toString("base64");else if(typeof btoa=="function"){let a="";for(let f=0;f<o.length;++f)a+=String.fromCharCode(o[f]);l=btoa(a)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e||(e=A.BLOCK_LITERAL),e!==A.QUOTE_DOUBLE){const a=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),f=Math.ceil(l.length/a),h=new Array(f);for(let u=0,d=0;u<f;++u,d+=a)h[u]=l.substr(d,a);l=h.join(e===A.BLOCK_LITERAL?`
`:" ")}return kt({comment:i,type:e,value:l},s,n,r)}};function xn(i,e){if(st(i))for(let t=0;t<i.items.length;++t){let s=i.items[t];if(!I(s)){if(tt(s)){s.items.length>1&&e("Each pair must have its own sequence indicator");const n=s.items[0]||new j(new A(null));if(s.commentBefore&&(n.key.commentBefore=n.key.commentBefore?`${s.commentBefore}
${n.key.commentBefore}`:s.commentBefore),s.comment){const r=n.value??n.key;r.comment=r.comment?`${s.comment}
${r.comment}`:s.comment}s=n}i.items[t]=I(s)?s:new j(s)}}else e("Expected a sequence for this tag");return i}function Vn(i,e,t){const{replacer:s}=t,n=new Oe(i);n.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof s=="function"&&(o=s.call(e,String(r++),o));let l,a;if(Array.isArray(o))if(o.length===2)l=o[0],a=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const f=Object.keys(o);if(f.length===1)l=f[0],a=o[l];else throw new TypeError(`Expected tuple with one key, not ${f.length} keys`)}else l=o;n.items.push(Zs(l,a,t))}return n}const ii={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:xn,createNode:Vn};class Ye extends Oe{constructor(){super(),this.add=x.prototype.add.bind(this),this.delete=x.prototype.delete.bind(this),this.get=x.prototype.get.bind(this),this.has=x.prototype.has.bind(this),this.set=x.prototype.set.bind(this),this.tag=Ye.tag}toJSON(e,t){if(!t)return super.toJSON(e);const s=new Map;t!=null&&t.onCreate&&t.onCreate(s);for(const n of this.items){let r,o;if(I(n)?(r=Q(n.key,"",t),o=Q(n.value,r,t)):r=Q(n,"",t),s.has(r))throw new Error("Ordered maps must not include duplicate keys");s.set(r,o)}return s}static from(e,t,s){const n=Vn(e,t,s),r=new this;return r.items=n.items,r}}Ye.tag="tag:yaml.org,2002:omap";const ni={collection:"seq",identify:i=>i instanceof Map,nodeClass:Ye,default:!1,tag:"tag:yaml.org,2002:omap",resolve(i,e){const t=xn(i,e),s=[];for(const{key:n}of t.items)N(n)&&(s.includes(n.value)?e(`Ordered maps must not include duplicate keys: ${n.value}`):s.push(n.value));return Object.assign(new Ye,t)},createNode:(i,e,t)=>Ye.from(i,e,t)};function zn({value:i,source:e},t){return e&&(i?Jn:Hn).test.test(e)?e:i?t.options.trueStr:t.options.falseStr}const Jn={identify:i=>i===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new A(!0),stringify:zn},Hn={identify:i=>i===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new A(!1),stringify:zn},nl={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN)$/,resolve:i=>i.slice(-3).toLowerCase()==="nan"?NaN:i[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ae},rl={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:i=>parseFloat(i.replace(/_/g,"")),stringify(i){const e=Number(i.value);return isFinite(e)?e.toExponential():ae(i)}},ol={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(i){const e=new A(parseFloat(i.replace(/_/g,""))),t=i.indexOf(".");if(t!==-1){const s=i.substring(t+1).replace(/_/g,"");s[s.length-1]==="0"&&(e.minFractionDigits=s.length)}return e},stringify:ae},St=i=>typeof i=="bigint"||Number.isInteger(i);function ls(i,e,t,{intAsBigInt:s}){const n=i[0];if((n==="-"||n==="+")&&(e+=1),i=i.substring(e).replace(/_/g,""),s){switch(t){case 2:i=`0b${i}`;break;case 8:i=`0o${i}`;break;case 16:i=`0x${i}`;break}const o=BigInt(i);return n==="-"?BigInt(-1)*o:o}const r=parseInt(i,t);return n==="-"?-1*r:r}function ri(i,e,t){const{value:s}=i;if(St(s)){const n=s.toString(e);return s<0?"-"+t+n.substr(1):t+n}return ae(i)}const ll={identify:St,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(i,e,t)=>ls(i,2,2,t),stringify:i=>ri(i,2,"0b")},al={identify:St,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(i,e,t)=>ls(i,1,8,t),stringify:i=>ri(i,8,"0")},cl={identify:St,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(i,e,t)=>ls(i,0,10,t),stringify:ae},fl={identify:St,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(i,e,t)=>ls(i,2,16,t),stringify:i=>ri(i,16,"0x")};class xe extends x{constructor(e){super(e),this.tag=xe.tag}add(e){let t;I(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new j(e.key,null):t=new j(e,null),Ce(this.items,t.key)||this.items.push(t)}get(e,t){const s=Ce(this.items,e);return!t&&I(s)?N(s.key)?s.key.value:s.key:s}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const s=Ce(this.items,e);s&&!t?this.items.splice(this.items.indexOf(s),1):!s&&t&&this.items.push(new j(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,s){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,s);throw new Error("Set items must all have null values")}static from(e,t,s){const{replacer:n}=s,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let o of t)typeof n=="function"&&(o=n.call(t,o,o)),r.items.push(Zs(o,null,s));return r}}xe.tag="tag:yaml.org,2002:set";const oi={collection:"map",identify:i=>i instanceof Set,nodeClass:xe,default:!1,tag:"tag:yaml.org,2002:set",createNode:(i,e,t)=>xe.from(i,e,t),resolve(i,e){if(tt(i)){if(i.hasAllNullValues(!0))return Object.assign(new xe,i);e("Set items must all have null values")}else e("Expected a mapping for this tag");return i}};function li(i,e){const t=i[0],s=t==="-"||t==="+"?i.substring(1):i,n=o=>e?BigInt(o):Number(o),r=s.replace(/_/g,"").split(":").reduce((o,l)=>o*n(60)+n(l),n(0));return t==="-"?n(-1)*r:r}function Qn(i){let{value:e}=i,t=o=>o;if(typeof e=="bigint")t=o=>BigInt(o);else if(isNaN(e)||!isFinite(e))return ae(i);let s="";e<0&&(s="-",e*=t(-1));const n=t(60),r=[e%n];return e<60?r.unshift(0):(e=(e-r[0])/n,r.unshift(e%n),e>=60&&(e=(e-r[0])/n,r.unshift(e))),s+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Gn={identify:i=>typeof i=="bigint"||Number.isInteger(i),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(i,e,{intAsBigInt:t})=>li(i,t),stringify:Qn},Xn={identify:i=>typeof i=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:i=>li(i,!1),stringify:Qn},as={identify:i=>i instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(i){const e=i.match(as.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,s,n,r,o,l]=e.map(Number),a=e[7]?Number((e[7]+"00").substr(1,3)):0;let f=Date.UTC(t,s-1,n,r||0,o||0,l||0,a);const h=e[8];if(h&&h!=="Z"){let u=li(h,!1);Math.abs(u)<30&&(u*=60),f-=6e4*u}return new Date(f)},stringify:({value:i})=>i.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")},Di=[it,nt,ns,rs,Jn,Hn,ll,al,cl,fl,nl,rl,ol,si,ni,ii,oi,Gn,Xn,as],qi=new Map([["core",el],["failsafe",[it,nt,ns]],["json",il],["yaml11",Di],["yaml-1.1",Di]]),$i={binary:si,bool:ei,float:jn,floatExp:Mn,floatNaN:Fn,floatTime:Xn,int:Wn,intHex:Yn,intOct:Kn,intTime:Gn,map:it,null:rs,omap:ni,pairs:ii,seq:nt,set:oi,timestamp:as},ul={"tag:yaml.org,2002:binary":si,"tag:yaml.org,2002:omap":ni,"tag:yaml.org,2002:pairs":ii,"tag:yaml.org,2002:set":oi,"tag:yaml.org,2002:timestamp":as};function bs(i,e){let t=qi.get(e);if(!t)if(Array.isArray(i))t=[];else{const s=Array.from(qi.keys()).filter(n=>n!=="yaml11").map(n=>JSON.stringify(n)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${s} or define customTags array`)}if(Array.isArray(i))for(const s of i)t=t.concat(s);else typeof i=="function"&&(t=i(t.slice()));return t.map(s=>{if(typeof s!="string")return s;const n=$i[s];if(n)return n;const r=Object.keys($i).map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown custom tag "${s}"; use one of ${r}`)})}const hl=(i,e)=>i.key<e.key?-1:i.key>e.key?1:0;class cs{constructor({compat:e,customTags:t,merge:s,resolveKnownTags:n,schema:r,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(e)?bs(e,"compat"):e?bs(null,e):null,this.merge=!!s,this.name=typeof r=="string"&&r||"core",this.knownTags=n?ul:{},this.tags=bs(t,this.name),this.toStringOptions=l??null,Object.defineProperty(this,_e,{value:it}),Object.defineProperty(this,be,{value:ns}),Object.defineProperty(this,Ze,{value:nt}),this.sortMapEntries=typeof o=="function"?o:o===!0?hl:null}clone(){const e=Object.create(cs.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function dl(i,e){var a;const t=[];let s=e.directives===!0;if(e.directives!==!1&&i.directives){const f=i.directives.toString(i);f?(t.push(f),s=!0):i.directives.docStart&&(s=!0)}s&&t.push("---");const n=Pn(i,e),{commentString:r}=n.options;if(i.commentBefore){t.length!==1&&t.unshift("");const f=r(i.commentBefore);t.unshift(ye(f,""))}let o=!1,l=null;if(i.contents){if(P(i.contents)){if(i.contents.spaceBefore&&s&&t.push(""),i.contents.commentBefore){const u=r(i.contents.commentBefore);t.push(ye(u,""))}n.forceBlockIndent=!!i.comment,l=i.contents.comment}const f=l?void 0:()=>o=!0;let h=Qe(i.contents,n,()=>l=null,f);l&&(h+=Ee(h,"",r(l))),(h[0]==="|"||h[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${h}`:t.push(h)}else t.push(Qe(i.contents,n));if((a=i.directives)!=null&&a.docEnd)if(i.comment){const f=r(i.comment);f.includes(`
`)?(t.push("..."),t.push(ye(f,""))):t.push(`... ${f}`)}else t.push("...");else{let f=i.comment;f&&o&&(f=f.replace(/^\n+/,"")),f&&((!o||l)&&t[t.length-1]!==""&&t.push(""),t.push(ye(r(f),"")))}return t.join(`
`)+`
`}class rt{constructor(e,t,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,G,{value:Ds});let n=null;typeof t=="function"||Array.isArray(t)?n=t:s===void 0&&t&&(s=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},s);this.options=r;let{version:o}=r;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new U({version:o}),this.setSchema(o,s),this.contents=e===void 0?null:this.createNode(e,n,s)}clone(){const e=Object.create(rt.prototype,{[G]:{value:Ds}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=P(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Re(this.contents)&&this.contents.add(e)}addIn(e,t){Re(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const s=In(this);e.anchor=!t||s.has(t)?Ln(t||"a",s):t}return new es(e.anchor)}createNode(e,t,s){let n;if(typeof t=="function")e=t.call({"":e},"",e),n=t;else if(Array.isArray(t)){const m=S=>typeof S=="number"||S instanceof String||S instanceof Number,k=t.filter(m).map(String);k.length>0&&(t=t.concat(k)),n=t}else s===void 0&&t&&(s=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:l,keepUndefined:a,onTagObj:f,tag:h}=s??{},{onAnchor:u,setAnchors:d,sourceObjects:g}=Uo(this,o||"a"),w={aliasDuplicateObjects:r??!0,keepUndefined:a??!1,onAnchor:u,onTagObj:f,replacer:n,schema:this.schema,sourceObjects:g},p=gt(e,h,w);return l&&L(p)&&(p.flow=!0),d(),p}createPair(e,t,s={}){const n=this.createNode(e,null,s),r=this.createNode(t,null,s);return new j(n,r)}delete(e){return Re(this.contents)?this.contents.delete(e):!1}deleteIn(e){return ft(e)?this.contents==null?!1:(this.contents=null,!0):Re(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return L(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return ft(e)?!t&&N(this.contents)?this.contents.value:this.contents:L(this.contents)?this.contents.getIn(e,t):void 0}has(e){return L(this.contents)?this.contents.has(e):!1}hasIn(e){return ft(e)?this.contents!==void 0:L(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=Wt(this.schema,[e],t):Re(this.contents)&&this.contents.set(e,t)}setIn(e,t){ft(e)?this.contents=t:this.contents==null?this.contents=Wt(this.schema,Array.from(e),t):Re(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let s;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new U({version:"1.1"}),s={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new U({version:e}),s={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{const n=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(s)this.schema=new cs(Object.assign(s,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:s,maxAliasCount:n,onAnchor:r,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!e,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},a=Q(this.contents,t??"",l);if(typeof r=="function")for(const{count:f,res:h}of l.anchors.values())r(h,f);return typeof o=="function"?Ue(o,{"":a},"",a):a}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return dl(this,e)}}function Re(i){if(L(i))return!0;throw new Error("Expected a YAML collection as document contents")}class ai extends Error{constructor(e,t,s,n){super(),this.name=e,this.code=s,this.message=n,this.pos=t}}class Ne extends ai{constructor(e,t,s){super("YAMLParseError",e,t,s)}}class Zn extends ai{constructor(e,t,s){super("YAMLWarning",e,t,s)}}const xt=(i,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(l=>e.linePos(l));const{line:s,col:n}=t.linePos[0];t.message+=` at line ${s}, column ${n}`;let r=n-1,o=i.substring(e.lineStarts[s-1],e.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){const l=Math.min(r-39,o.length-79);o=""+o.substring(l),r-=l-1}if(o.length>80&&(o=o.substring(0,79)+""),s>1&&/^ *$/.test(o.substring(0,r))){let l=i.substring(e.lineStarts[s-2],e.lineStarts[s-1]);l.length>80&&(l=l.substring(0,79)+`
`),o=l+o}if(/[^ ]/.test(o)){let l=1;const a=t.linePos[1];a&&a.line===s&&a.col>n&&(l=Math.max(1,Math.min(a.col-n,80-r)));const f=" ".repeat(r)+"^".repeat(l);t.message+=`:

${o}
${f}
`}};function Ge(i,{flow:e,indicator:t,next:s,offset:n,onError:r,startOnNewline:o}){let l=!1,a=o,f=o,h="",u="",d=!1,g=!1,w=!1,p=null,m=null,k=null,S=null,v=null;for(const y of i)switch(w&&(y.type!=="space"&&y.type!=="newline"&&y.type!=="comma"&&r(y.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),w=!1),y.type){case"space":!e&&a&&t!=="doc-start"&&y.source[0]==="	"&&r(y,"TAB_AS_INDENT","Tabs are not allowed as indentation"),f=!0;break;case"comment":{f||r(y,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const C=y.source.substring(1)||" ";h?h+=u+C:h=C,u="",a=!1;break}case"newline":a?h?h+=y.source:l=!0:u+=y.source,a=!0,d=!0,(p||m)&&(g=!0),f=!0;break;case"anchor":p&&r(y,"MULTIPLE_ANCHORS","A node can have at most one anchor"),y.source.endsWith(":")&&r(y.offset+y.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),p=y,v===null&&(v=y.offset),a=!1,f=!1,w=!0;break;case"tag":{m&&r(y,"MULTIPLE_TAGS","A node can have at most one tag"),m=y,v===null&&(v=y.offset),a=!1,f=!1,w=!0;break}case t:(p||m)&&r(y,"BAD_PROP_ORDER",`Anchors and tags must be after the ${y.source} indicator`),S&&r(y,"UNEXPECTED_TOKEN",`Unexpected ${y.source} in ${e??"collection"}`),S=y,a=!1,f=!1;break;case"comma":if(e){k&&r(y,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),k=y,a=!1,f=!1;break}default:r(y,"UNEXPECTED_TOKEN",`Unexpected ${y.type} token`),a=!1,f=!1}const _=i[i.length-1],O=_?_.offset+_.source.length:n;return w&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),{comma:k,found:S,spaceBefore:l,comment:h,hasNewline:d,hasNewlineAfterProp:g,anchor:p,tag:m,end:O,start:v??O}}function yt(i){if(!i)return null;switch(i.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(i.source.includes(`
`))return!0;if(i.end){for(const e of i.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of i.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(yt(e.key)||yt(e.value))return!0}return!1;default:return!0}}function Ms(i,e,t){if((e==null?void 0:e.type)==="flow-collection"){const s=e.end[0];s.indent===i&&(s.source==="]"||s.source==="}")&&yt(e)&&t(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function er(i,e,t){const{uniqueKeys:s}=i.options;if(s===!1)return!1;const n=typeof s=="function"?s:(r,o)=>r===o||N(r)&&N(o)&&r.value===o.value&&!(r.value==="<<"&&i.schema.merge);return e.some(r=>n(r.key,t))}const Fi="All mapping items must start at the same column";function pl({composeNode:i,composeEmptyNode:e},t,s,n,r){var h;const o=(r==null?void 0:r.nodeClass)??x,l=new o(t.schema);t.atRoot&&(t.atRoot=!1);let a=s.offset,f=null;for(const u of s.items){const{start:d,key:g,sep:w,value:p}=u,m=Ge(d,{indicator:"explicit-key-ind",next:g??(w==null?void 0:w[0]),offset:a,onError:n,startOnNewline:!0}),k=!m.found;if(k){if(g&&(g.type==="block-seq"?n(a,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==s.indent&&n(a,"BAD_INDENT",Fi)),!m.anchor&&!m.tag&&!w){f=m.end,m.comment&&(l.comment?l.comment+=`
`+m.comment:l.comment=m.comment);continue}(m.hasNewlineAfterProp||yt(g))&&n(g??d[d.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((h=m.found)==null?void 0:h.indent)!==s.indent&&n(a,"BAD_INDENT",Fi);const S=m.end,v=g?i(t,g,m,n):e(t,S,d,null,m,n);t.schema.compat&&Ms(s.indent,g,n),er(t,l.items,v)&&n(S,"DUPLICATE_KEY","Map keys must be unique");const _=Ge(w??[],{indicator:"map-value-ind",next:p,offset:v.range[2],onError:n,startOnNewline:!g||g.type==="block-scalar"});if(a=_.end,_.found){k&&((p==null?void 0:p.type)==="block-map"&&!_.hasNewline&&n(a,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&m.start<_.found.offset-1024&&n(v.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const O=p?i(t,p,_,n):e(t,a,w,null,_,n);t.schema.compat&&Ms(s.indent,p,n),a=O.range[2];const y=new j(v,O);t.options.keepSourceTokens&&(y.srcToken=u),l.items.push(y)}else{k&&n(v.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),_.comment&&(v.comment?v.comment+=`
`+_.comment:v.comment=_.comment);const O=new j(v);t.options.keepSourceTokens&&(O.srcToken=u),l.items.push(O)}}return f&&f<a&&n(f,"IMPOSSIBLE","Map comment with trailing content"),l.range=[s.offset,a,f??a],l}function ml({composeNode:i,composeEmptyNode:e},t,s,n,r){const o=(r==null?void 0:r.nodeClass)??Oe,l=new o(t.schema);t.atRoot&&(t.atRoot=!1);let a=s.offset,f=null;for(const{start:h,value:u}of s.items){const d=Ge(h,{indicator:"seq-item-ind",next:u,offset:a,onError:n,startOnNewline:!0});if(!d.found)if(d.anchor||d.tag||u)u&&u.type==="block-seq"?n(d.end,"BAD_INDENT","All sequence items must start at the same column"):n(a,"MISSING_CHAR","Sequence item without - indicator");else{f=d.end,d.comment&&(l.comment=d.comment);continue}const g=u?i(t,u,d,n):e(t,d.end,h,null,d,n);t.schema.compat&&Ms(s.indent,u,n),a=g.range[2],l.items.push(g)}return l.range=[s.offset,a,f??a],l}function vt(i,e,t,s){let n="";if(i){let r=!1,o="";for(const l of i){const{source:a,type:f}=l;switch(f){case"space":r=!0;break;case"comment":{t&&!r&&s(l,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const h=a.substring(1)||" ";n?n+=o+h:n=h,o="";break}case"newline":n&&(o+=a),r=!0;break;default:s(l,"UNEXPECTED_TOKEN",`Unexpected ${f} at node end`)}e+=a.length}}return{comment:n,offset:e}}const ws="Block collections are not allowed within flow collections",ks=i=>i&&(i.type==="block-map"||i.type==="block-seq");function gl({composeNode:i,composeEmptyNode:e},t,s,n,r){const o=s.start.source==="{",l=o?"flow map":"flow sequence",a=(r==null?void 0:r.nodeClass)??(o?x:Oe),f=new a(t.schema);f.flow=!0;const h=t.atRoot;h&&(t.atRoot=!1);let u=s.offset+s.start.source.length;for(let m=0;m<s.items.length;++m){const k=s.items[m],{start:S,key:v,sep:_,value:O}=k,y=Ge(S,{flow:l,indicator:"explicit-key-ind",next:v??(_==null?void 0:_[0]),offset:u,onError:n,startOnNewline:!1});if(!y.found){if(!y.anchor&&!y.tag&&!_&&!O){m===0&&y.comma?n(y.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`):m<s.items.length-1&&n(y.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${l}`),y.comment&&(f.comment?f.comment+=`
`+y.comment:f.comment=y.comment),u=y.end;continue}!o&&t.options.strict&&yt(v)&&n(v,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(m===0)y.comma&&n(y.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`);else if(y.comma||n(y.start,"MISSING_CHAR",`Missing , between ${l} items`),y.comment){let C="";e:for(const B of S)switch(B.type){case"comma":case"space":break;case"comment":C=B.source.substring(1);break e;default:break e}if(C){let B=f.items[f.items.length-1];I(B)&&(B=B.value??B.key),B.comment?B.comment+=`
`+C:B.comment=C,y.comment=y.comment.substring(C.length+1)}}if(!o&&!_&&!y.found){const C=O?i(t,O,y,n):e(t,y.end,_,null,y,n);f.items.push(C),u=C.range[2],ks(O)&&n(C.range,"BLOCK_IN_FLOW",ws)}else{const C=y.end,B=v?i(t,v,y,n):e(t,C,S,null,y,n);ks(v)&&n(B.range,"BLOCK_IN_FLOW",ws);const M=Ge(_??[],{flow:l,indicator:"map-value-ind",next:O,offset:B.range[2],onError:n,startOnNewline:!1});if(M.found){if(!o&&!y.found&&t.options.strict){if(_)for(const $ of _){if($===M.found)break;if($.type==="newline"){n($,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}y.start<M.found.offset-1024&&n(M.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else O&&("source"in O&&O.source&&O.source[0]===":"?n(O,"MISSING_CHAR",`Missing space after : in ${l}`):n(M.start,"MISSING_CHAR",`Missing , or : between ${l} items`));const Te=O?i(t,O,M,n):M.found?e(t,M.end,_,null,M,n):null;Te?ks(O)&&n(Te.range,"BLOCK_IN_FLOW",ws):M.comment&&(B.comment?B.comment+=`
`+M.comment:B.comment=M.comment);const Be=new j(B,Te);if(t.options.keepSourceTokens&&(Be.srcToken=k),o){const $=f;er(t,$.items,B)&&n(C,"DUPLICATE_KEY","Map keys must be unique"),$.items.push(Be)}else{const $=new x(t.schema);$.flow=!0,$.items.push(Be),f.items.push($)}u=Te?Te.range[2]:M.end}}const d=o?"}":"]",[g,...w]=s.end;let p=u;if(g&&g.source===d)p=g.offset+g.source.length;else{const m=l[0].toUpperCase()+l.substring(1),k=h?`${m} must end with a ${d}`:`${m} in block collection must be sufficiently indented and end with a ${d}`;n(u,h?"MISSING_CHAR":"BAD_INDENT",k),g&&g.source.length!==1&&w.unshift(g)}if(w.length>0){const m=vt(w,p,t.options.strict,n);m.comment&&(f.comment?f.comment+=`
`+m.comment:f.comment=m.comment),f.range=[s.offset,p,m.offset]}else f.range=[s.offset,p,p];return f}function Ss(i,e,t,s,n,r){const o=t.type==="block-map"?pl(i,e,t,s,r):t.type==="block-seq"?ml(i,e,t,s,r):gl(i,e,t,s,r),l=o.constructor;return n==="!"||n===l.tagName?(o.tag=l.tagName,o):(n&&(o.tag=n),o)}function yl(i,e,t,s,n){var u;const r=s?e.directives.tagName(s.source,d=>n(s,"TAG_RESOLVE_FAILED",d)):null,o=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!s||!r||r==="!"||r===x.tagName&&o==="map"||r===Oe.tagName&&o==="seq"||!o)return Ss(i,e,t,n,r);let l=e.schema.tags.find(d=>d.tag===r&&d.collection===o);if(!l){const d=e.schema.knownTags[r];if(d&&d.collection===o)e.schema.tags.push(Object.assign({},d,{default:!1})),l=d;else return d!=null&&d.collection?n(s,"BAD_COLLECTION_TYPE",`${d.tag} used for ${o} collection, but expects ${d.collection}`,!0):n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${r}`,!0),Ss(i,e,t,n,r)}const a=Ss(i,e,t,n,r,l),f=((u=l.resolve)==null?void 0:u.call(l,a,d=>n(s,"TAG_RESOLVE_FAILED",d),e.options))??a,h=P(f)?f:new A(f);return h.range=a.range,h.tag=r,l!=null&&l.format&&(h.format=l.format),h}function tr(i,e,t){const s=i.offset,n=bl(i,e,t);if(!n)return{value:"",type:null,comment:"",range:[s,s,s]};const r=n.mode===">"?A.BLOCK_FOLDED:A.BLOCK_LITERAL,o=i.source?wl(i.source):[];let l=o.length;for(let p=o.length-1;p>=0;--p){const m=o[p][1];if(m===""||m==="\r")l=p;else break}if(l===0){const p=n.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let m=s+n.length;return i.source&&(m+=i.source.length),{value:p,type:r,comment:n.comment,range:[s,m,m]}}let a=i.indent+n.indent,f=i.offset+n.length,h=0;for(let p=0;p<l;++p){const[m,k]=o[p];if(k===""||k==="\r")n.indent===0&&m.length>a&&(a=m.length);else{m.length<a&&t(f+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(a=m.length),h=p;break}f+=m.length+k.length+1}for(let p=o.length-1;p>=l;--p)o[p][0].length>a&&(l=p+1);let u="",d="",g=!1;for(let p=0;p<h;++p)u+=o[p][0].slice(a)+`
`;for(let p=h;p<l;++p){let[m,k]=o[p];f+=m.length+k.length+1;const S=k[k.length-1]==="\r";if(S&&(k=k.slice(0,-1)),k&&m.length<a){const _=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;t(f-k.length-(S?2:1),"BAD_INDENT",_),m=""}r===A.BLOCK_LITERAL?(u+=d+m.slice(a)+k,d=`
`):m.length>a||k[0]==="	"?(d===" "?d=`
`:!g&&d===`
`&&(d=`

`),u+=d+m.slice(a)+k,d=`
`,g=!0):k===""?d===`
`?u+=`
`:d=`
`:(u+=d+k,d=" ",g=!1)}switch(n.chomp){case"-":break;case"+":for(let p=l;p<o.length;++p)u+=`
`+o[p][0].slice(a);u[u.length-1]!==`
`&&(u+=`
`);break;default:u+=`
`}const w=s+n.length+i.source.length;return{value:u,type:r,comment:n.comment,range:[s,w,w]}}function bl({offset:i,props:e},t,s){if(e[0].type!=="block-scalar-header")return s(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:n}=e[0],r=n[0];let o=0,l="",a=-1;for(let d=1;d<n.length;++d){const g=n[d];if(!l&&(g==="-"||g==="+"))l=g;else{const w=Number(g);!o&&w?o=w:a===-1&&(a=i+d)}}a!==-1&&s(a,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let f=!1,h="",u=n.length;for(let d=1;d<e.length;++d){const g=e[d];switch(g.type){case"space":f=!0;case"newline":u+=g.source.length;break;case"comment":t&&!f&&s(g,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),u+=g.source.length,h=g.source.substring(1);break;case"error":s(g,"UNEXPECTED_TOKEN",g.message),u+=g.source.length;break;default:{const w=`Unexpected token in block scalar header: ${g.type}`;s(g,"UNEXPECTED_TOKEN",w);const p=g.source;p&&typeof p=="string"&&(u+=p.length)}}}return{mode:r,indent:o,chomp:l,comment:h,length:u}}function wl(i){const e=i.split(/\n( *)/),t=e[0],s=t.match(/^( *)/),r=[s!=null&&s[1]?[s[1],t.slice(s[1].length)]:["",t]];for(let o=1;o<e.length;o+=2)r.push([e[o],e[o+1]]);return r}function sr(i,e,t){const{offset:s,type:n,source:r,end:o}=i;let l,a;const f=(d,g,w)=>t(s+d,g,w);switch(n){case"scalar":l=A.PLAIN,a=kl(r,f);break;case"single-quoted-scalar":l=A.QUOTE_SINGLE,a=Sl(r,f);break;case"double-quoted-scalar":l=A.QUOTE_DOUBLE,a=vl(r,f);break;default:return t(i,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[s,s+r.length,s+r.length]}}const h=s+r.length,u=vt(o,h,e,t);return{value:a,type:l,comment:u.comment,range:[s,h,u.offset]}}function kl(i,e){let t="";switch(i[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${i[0]}`;break}case"@":case"`":{t=`reserved character ${i[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),ir(i)}function Sl(i,e){return(i[i.length-1]!=="'"||i.length===1)&&e(i.length,"MISSING_CHAR","Missing closing 'quote"),ir(i.slice(1,-1)).replace(/''/g,"'")}function ir(i){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=e.exec(i);if(!s)return i;let n=s[1],r=" ",o=e.lastIndex;for(t.lastIndex=o;s=t.exec(i);)s[1]===""?r===`
`?n+=r:r=`
`:(n+=r+s[1],r=" "),o=t.lastIndex;const l=/[ \t]*(.*)/sy;return l.lastIndex=o,s=l.exec(i),n+r+((s==null?void 0:s[1])??"")}function vl(i,e){let t="";for(let s=1;s<i.length-1;++s){const n=i[s];if(!(n==="\r"&&i[s+1]===`
`))if(n===`
`){const{fold:r,offset:o}=_l(i,s);t+=r,s=o}else if(n==="\\"){let r=i[++s];const o=Al[r];if(o)t+=o;else if(r===`
`)for(r=i[s+1];r===" "||r==="	";)r=i[++s+1];else if(r==="\r"&&i[s+1]===`
`)for(r=i[++s+1];r===" "||r==="	";)r=i[++s+1];else if(r==="x"||r==="u"||r==="U"){const l={x:2,u:4,U:8}[r];t+=Ol(i,s+1,l,e),s+=l}else{const l=i.substr(s-1,2);e(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),t+=l}}else if(n===" "||n==="	"){const r=s;let o=i[s+1];for(;o===" "||o==="	";)o=i[++s+1];o!==`
`&&!(o==="\r"&&i[s+2]===`
`)&&(t+=s>r?i.slice(r,s+1):n)}else t+=n}return(i[i.length-1]!=='"'||i.length===1)&&e(i.length,"MISSING_CHAR",'Missing closing "quote'),t}function _l(i,e){let t="",s=i[e+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&i[e+2]!==`
`);)s===`
`&&(t+=`
`),e+=1,s=i[e+1];return t||(t=" "),{fold:t,offset:e}}const Al={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Ol(i,e,t,s){const n=i.substr(e,t),o=n.length===t&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(o)){const l=i.substr(e-2,t+2);return s(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),l}return String.fromCodePoint(o)}function nr(i,e,t,s){const{value:n,type:r,comment:o,range:l}=e.type==="block-scalar"?tr(e,i.options.strict,s):sr(e,i.options.strict,s),a=t?i.directives.tagName(t.source,u=>s(t,"TAG_RESOLVE_FAILED",u)):null,f=t&&a?Tl(i.schema,n,a,t,s):e.type==="scalar"?El(i,n,e,s):i.schema[be];let h;try{const u=f.resolve(n,d=>s(t??e,"TAG_RESOLVE_FAILED",d),i.options);h=N(u)?u:new A(u)}catch(u){const d=u instanceof Error?u.message:String(u);s(t??e,"TAG_RESOLVE_FAILED",d),h=new A(n)}return h.range=l,h.source=n,r&&(h.type=r),a&&(h.tag=a),f.format&&(h.format=f.format),o&&(h.comment=o),h}function Tl(i,e,t,s,n){var l;if(t==="!")return i[be];const r=[];for(const a of i.tags)if(!a.collection&&a.tag===t)if(a.default&&a.test)r.push(a);else return a;for(const a of r)if((l=a.test)!=null&&l.test(e))return a;const o=i.knownTags[t];return o&&!o.collection?(i.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),i[be])}function El({directives:i,schema:e},t,s,n){const r=e.tags.find(o=>{var l;return o.default&&((l=o.test)==null?void 0:l.test(t))})||e[be];if(e.compat){const o=e.compat.find(l=>{var a;return l.default&&((a=l.test)==null?void 0:a.test(t))})??e[be];if(r.tag!==o.tag){const l=i.tagString(r.tag),a=i.tagString(o.tag),f=`Value may be parsed as either ${l} or ${a}`;n(s,"TAG_RESOLVE_FAILED",f,!0)}}return r}function Cl(i,e,t){if(e){t===null&&(t=e.length);for(let s=t-1;s>=0;--s){let n=e[s];switch(n.type){case"space":case"comment":case"newline":i-=n.source.length;continue}for(n=e[++s];(n==null?void 0:n.type)==="space";)i+=n.source.length,n=e[++s];break}}return i}const Nl={composeNode:rr,composeEmptyNode:ci};function rr(i,e,t,s){const{spaceBefore:n,comment:r,anchor:o,tag:l}=t;let a,f=!0;switch(e.type){case"alias":a=Il(i,e,s),(o||l)&&s(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":a=nr(i,e,l,s),o&&(a.anchor=o.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":a=yl(Nl,i,e,l,s),o&&(a.anchor=o.source.substring(1));break;default:{const h=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;s(e,"UNEXPECTED_TOKEN",h),a=ci(i,e.offset,void 0,null,t,s),f=!1}}return o&&a.anchor===""&&s(o,"BAD_ALIAS","Anchor cannot be an empty string"),n&&(a.spaceBefore=!0),r&&(e.type==="scalar"&&e.source===""?a.comment=r:a.commentBefore=r),i.options.keepSourceTokens&&f&&(a.srcToken=e),a}function ci(i,e,t,s,{spaceBefore:n,comment:r,anchor:o,tag:l,end:a},f){const h={type:"scalar",offset:Cl(e,t,s),indent:-1,source:""},u=nr(i,h,l,f);return o&&(u.anchor=o.source.substring(1),u.anchor===""&&f(o,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(u.spaceBefore=!0),r&&(u.comment=r,u.range[2]=a),u}function Il({options:i},{offset:e,source:t,end:s},n){const r=new es(t.substring(1));r.source===""&&n(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&n(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=e+t.length,l=vt(s,o,i.strict,n);return r.range=[e,o,l.offset],l.comment&&(r.comment=l.comment),r}function Ll(i,e,{offset:t,start:s,value:n,end:r},o){const l=Object.assign({_directives:e},i),a=new rt(void 0,l),f={atRoot:!0,directives:a.directives,options:a.options,schema:a.schema},h=Ge(s,{indicator:"doc-start",next:n??(r==null?void 0:r[0]),offset:t,onError:o,startOnNewline:!0});h.found&&(a.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!h.hasNewline&&o(h.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),a.contents=n?rr(f,n,h,o):ci(f,h.end,s,null,h,o);const u=a.contents.range[2],d=vt(r,u,!1,o);return d.comment&&(a.comment=d.comment),a.range=[t,u,d.offset],a}function at(i){if(typeof i=="number")return[i,i+1];if(Array.isArray(i))return i.length===2?i:[i[0],i[1]];const{offset:e,source:t}=i;return[e,e+(typeof t=="string"?t.length:1)]}function Mi(i){var n;let e="",t=!1,s=!1;for(let r=0;r<i.length;++r){const o=i[r];switch(o[0]){case"#":e+=(e===""?"":s?`

`:`
`)+(o.substring(1)||" "),t=!0,s=!1;break;case"%":((n=i[r+1])==null?void 0:n[0])!=="#"&&(r+=1),t=!1;break;default:t||(s=!0),t=!1}}return{comment:e,afterEmptyLine:s}}class fi{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,s,n,r)=>{const o=at(t);r?this.warnings.push(new Zn(o,s,n)):this.errors.push(new Ne(o,s,n))},this.directives=new U({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:s,afterEmptyLine:n}=Mi(this.prelude);if(s){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${s}`:s;else if(n||e.directives.docStart||!r)e.commentBefore=s;else if(L(r)&&!r.flow&&r.items.length>0){let o=r.items[0];I(o)&&(o=o.key);const l=o.commentBefore;o.commentBefore=l?`${s}
${l}`:s}else{const o=r.commentBefore;r.commentBefore=o?`${s}
${o}`:s}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Mi(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,s=-1){for(const n of e)yield*this.next(n);yield*this.end(t,s)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,s,n)=>{const r=at(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",s,n)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=Ll(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,s=new Ne(at(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){const s="Unexpected doc-end without preceding document";this.errors.push(new Ne(at(e),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;const t=vt(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const s=this.doc.comment;this.doc.comment=s?`${s}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new Ne(at(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const s=Object.assign({_directives:this.directives},this.options),n=new rt(void 0,s);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}function Bl(i,e=!0,t){if(i){const s=(n,r,o)=>{const l=typeof n=="number"?n:Array.isArray(n)?n[0]:n.offset;if(t)t(l,r,o);else throw new Ne([l,l+1],r,o)};switch(i.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return sr(i,e,s);case"block-scalar":return tr(i,e,s)}}return null}function Rl(i,e){const{implicitKey:t=!1,indent:s,inFlow:n=!1,offset:r=-1,type:o="PLAIN"}=e,l=kt({type:o,value:i},{implicitKey:t,indent:s>0?" ".repeat(s):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}}),a=e.end??[{type:"newline",offset:-1,indent:s,source:`
`}];switch(l[0]){case"|":case">":{const f=l.indexOf(`
`),h=l.substring(0,f),u=l.substring(f+1)+`
`,d=[{type:"block-scalar-header",offset:r,indent:s,source:h}];return or(d,a)||d.push({type:"newline",offset:-1,indent:s,source:`
`}),{type:"block-scalar",offset:r,indent:s,props:d,source:u}}case'"':return{type:"double-quoted-scalar",offset:r,indent:s,source:l,end:a};case"'":return{type:"single-quoted-scalar",offset:r,indent:s,source:l,end:a};default:return{type:"scalar",offset:r,indent:s,source:l,end:a}}}function Pl(i,e,t={}){let{afterKey:s=!1,implicitKey:n=!1,inFlow:r=!1,type:o}=t,l="indent"in i?i.indent:null;if(s&&typeof l=="number"&&(l+=2),!o)switch(i.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const f=i.props[0];if(f.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=f.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const a=kt({type:o,value:e},{implicitKey:n||l===null,indent:l!==null&&l>0?" ".repeat(l):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(a[0]){case"|":case">":Dl(i,a);break;case'"':vs(i,a,"double-quoted-scalar");break;case"'":vs(i,a,"single-quoted-scalar");break;default:vs(i,a,"scalar")}}function Dl(i,e){const t=e.indexOf(`
`),s=e.substring(0,t),n=e.substring(t+1)+`
`;if(i.type==="block-scalar"){const r=i.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=s,i.source=n}else{const{offset:r}=i,o="indent"in i?i.indent:-1,l=[{type:"block-scalar-header",offset:r,indent:o,source:s}];or(l,"end"in i?i.end:void 0)||l.push({type:"newline",offset:-1,indent:o,source:`
`});for(const a of Object.keys(i))a!=="type"&&a!=="offset"&&delete i[a];Object.assign(i,{type:"block-scalar",indent:o,props:l,source:n})}}function or(i,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":i.push(t);break;case"newline":return i.push(t),!0}return!1}function vs(i,e,t){switch(i.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":i.type=t,i.source=e;break;case"block-scalar":{const s=i.props.slice(1);let n=e.length;i.props[0].type==="block-scalar-header"&&(n-=i.props[0].source.length);for(const r of s)r.offset+=n;delete i.props,Object.assign(i,{type:t,source:e,end:s});break}case"block-map":case"block-seq":{const n={type:"newline",offset:i.offset+e.length,indent:i.indent,source:`
`};delete i.items,Object.assign(i,{type:t,source:e,end:[n]});break}default:{const s="indent"in i?i.indent:-1,n="end"in i&&Array.isArray(i.end)?i.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(const r of Object.keys(i))r!=="type"&&r!=="offset"&&delete i[r];Object.assign(i,{type:t,indent:s,source:e,end:n})}}}const ql=i=>"type"in i?Vt(i):Dt(i);function Vt(i){switch(i.type){case"block-scalar":{let e="";for(const t of i.props)e+=Vt(t);return e+i.source}case"block-map":case"block-seq":{let e="";for(const t of i.items)e+=Dt(t);return e}case"flow-collection":{let e=i.start.source;for(const t of i.items)e+=Dt(t);for(const t of i.end)e+=t.source;return e}case"document":{let e=Dt(i);if(i.end)for(const t of i.end)e+=t.source;return e}default:{let e=i.source;if("end"in i&&i.end)for(const t of i.end)e+=t.source;return e}}}function Dt({start:i,key:e,sep:t,value:s}){let n="";for(const r of i)n+=r.source;if(e&&(n+=Vt(e)),t)for(const r of t)n+=r.source;return s&&(n+=Vt(s)),n}const js=Symbol("break visit"),$l=Symbol("skip children"),lr=Symbol("remove item");function Ie(i,e){"type"in i&&i.type==="document"&&(i={start:i.start,value:i.value}),ar(Object.freeze([]),i,e)}Ie.BREAK=js;Ie.SKIP=$l;Ie.REMOVE=lr;Ie.itemAtPath=(i,e)=>{let t=i;for(const[s,n]of e){const r=t==null?void 0:t[s];if(r&&"items"in r)t=r.items[n];else return}return t};Ie.parentCollection=(i,e)=>{const t=Ie.itemAtPath(i,e.slice(0,-1)),s=e[e.length-1][0],n=t==null?void 0:t[s];if(n&&"items"in n)return n;throw new Error("Parent collection not found")};function ar(i,e,t){let s=t(e,i);if(typeof s=="symbol")return s;for(const n of["key","value"]){const r=e[n];if(r&&"items"in r){for(let o=0;o<r.items.length;++o){const l=ar(Object.freeze(i.concat([[n,o]])),r.items[o],t);if(typeof l=="number")o=l-1;else{if(l===js)return js;l===lr&&(r.items.splice(o,1),o-=1)}}typeof s=="function"&&n==="key"&&(s=s(e,i))}}return typeof s=="function"?s(e,i):s}const fs="\uFEFF",us="",hs="",bt="",Fl=i=>!!i&&"items"in i,Ml=i=>!!i&&(i.type==="scalar"||i.type==="single-quoted-scalar"||i.type==="double-quoted-scalar"||i.type==="block-scalar");function jl(i){switch(i){case fs:return"<BOM>";case us:return"<DOC>";case hs:return"<FLOW_END>";case bt:return"<SCALAR>";default:return JSON.stringify(i)}}function cr(i){switch(i){case fs:return"byte-order-mark";case us:return"doc-mode";case hs:return"flow-error-end";case bt:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(i[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const Ul=Object.freeze(Object.defineProperty({__proto__:null,BOM:fs,DOCUMENT:us,FLOW_END:hs,SCALAR:bt,createScalarToken:Rl,isCollection:Fl,isScalar:Ml,prettyToken:jl,resolveAsScalar:Bl,setScalarValue:Pl,stringify:ql,tokenType:cr,visit:Ie},Symbol.toStringTag,{value:"Module"}));function z(i){switch(i){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const ji="0123456789ABCDEFabcdef".split(""),Kl="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()".split(""),_s=",[]{}".split(""),Wl=` ,[]{}
\r	`.split(""),As=i=>!i||Wl.includes(i);class fr{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){e&&(this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null),this.atEnd=!t;let s=this.next??"stream";for(;s&&(t||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let s=0;for(;t===" ";)t=this.buffer[++s+e];if(t==="\r"){const n=this.buffer[s+e+1];if(n===`
`||!n&&!this.atEnd)return e+s+1}return t===`
`||s>=this.indentNext||!t&&!this.atEnd?e+s:-1}if(t==="-"||t==="."){const s=this.buffer.substr(e,3);if((s==="---"||s==="...")&&z(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===fs&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length;const s=e.indexOf("#");if(s!==-1){const r=e[s-1];(r===" "||r==="	")&&(t=s-1)}for(;;){const r=e[t-1];if(r===" "||r==="	")t-=1;else break}const n=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield us,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if(t==="---"&&z(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"doc";if(t==="..."&&z(this.charAt(3)))return yield*this.pushCount(3),"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!z(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&z(t)){const s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(As),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,s=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=s=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const n=this.getLine();if(n===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&n[0]!=="#"||s===0&&(n.startsWith("---")||n.startsWith("..."))&&z(n[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield hs,yield*this.parseLineStart();let r=0;for(;n[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),n[r]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(As),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||z(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}const s=this.buffer.substring(0,t);let n=s.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){const r=this.continueScalar(n+1);if(r===-1)break;n=s.indexOf(`
`,r)}n!==-1&&(t=n-(s[n-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>z(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,s;e:for(let n=this.pos;s=this.buffer[n];++n)switch(s){case" ":t+=1;break;case`
`:e=n,t=0;break;case"\r":{const r=this.buffer[n+1];if(!r&&!this.atEnd)return this.setNext("block-scalar");if(r===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext+=this.blockScalarIndent;do{const n=this.continueScalar(e+1);if(n===-1)break;e=this.buffer.indexOf(`
`,n)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}if(!this.blockScalarKeep)do{let n=e-1,r=this.buffer[n];r==="\r"&&(r=this.buffer[--n]);const o=n;for(;r===" "||r==="	";)r=this.buffer[--n];if(r===`
`&&n>=this.pos&&n+1+t>o)e=n;else break}while(!0);return yield bt,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,s=this.pos-1,n;for(;n=this.buffer[++s];)if(n===":"){const r=this.buffer[s+1];if(z(r)||e&&r===",")break;t=s}else if(z(n)){let r=this.buffer[s+1];if(n==="\r"&&(r===`
`?(s+=1,n=`
`,r=this.buffer[s+1]):t=s),r==="#"||e&&_s.includes(r))break;if(n===`
`){const o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(e&&_s.includes(n))break;t=s}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield bt,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const s=this.buffer.slice(this.pos,e);return s?(yield s,this.pos+=s.length,s.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(As))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(z(t)||e&&_s.includes(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!z(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Kl.includes(t))t=this.buffer[++e];else if(t==="%"&&ji.includes(this.buffer[e+1])&&ji.includes(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,s;do s=this.buffer[++t];while(s===" "||e&&s==="	");const n=t-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=t),n}*pushUntil(e){let t=this.pos,s=this.buffer[t];for(;!e(s);)s=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class ur{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,s=this.lineStarts.length;for(;t<s;){const r=t+s>>1;this.lineStarts[r]<e?t=r+1:s=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const n=this.lineStarts[t-1];return{line:t,col:e-n+1}}}}function te(i,e){for(let t=0;t<i.length;++t)if(i[t].type===e)return!0;return!1}function Ui(i){for(let e=0;e<i.length;++e)switch(i[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function hr(i){switch(i==null?void 0:i.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Nt(i){switch(i.type){case"document":return i.start;case"block-map":{const e=i.items[i.items.length-1];return e.sep??e.start}case"block-seq":return i.items[i.items.length-1].start;default:return[]}}function Pe(i){var t;if(i.length===0)return[];let e=i.length;e:for(;--e>=0;)switch(i[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=i[++e])==null?void 0:t.type)==="space";);return i.splice(e,i.length)}function Ki(i){if(i.start.type==="flow-seq-start")for(const e of i.items)e.sep&&!e.value&&!te(e.start,"explicit-key-ind")&&!te(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,hr(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class ui{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new fr,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const s of this.lexer.lex(e,t))yield*this.next(s);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=cr(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const s=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const s=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in s?s.indent:0:t.type==="flow-collection"&&s.type==="document"&&(t.indent=0),t.type==="flow-collection"&&Ki(t),s.type){case"document":s.value=t;break;case"block-scalar":s.props.push(t);break;case"block-map":{const n=s.items[s.items.length-1];if(n.value){s.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=t;else{Object.assign(n,{key:t,sep:[]}),this.onKeyLine=!te(n.start,"explicit-key-ind");return}break}case"block-seq":{const n=s.items[s.items.length-1];n.value?s.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=s.items[s.items.length-1];!n||n.value?s.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&Ui(n.start)===-1&&(t.indent===0||n.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(s.type==="document"?s.end=n.start:s.items.push({start:n.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Ui(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=Nt(this.peek(2)),s=Pe(t);let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:s,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var s;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent&&t.sep&&this.type!=="seq-item-ind";let r=[];if(n&&t.sep&&!t.value){const o=[];for(let l=0;l<t.sep.length;++l){const a=t.sep[l];switch(a.type){case"newline":o.push(l);break;case"space":break;case"comment":a.indent>e.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(r=t.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":n||t.value?(r.push(this.sourceToken),e.items.push({start:r}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!te(t.start,"explicit-key-ind")?t.start.push(this.sourceToken):n||t.value?(r.push(this.sourceToken),e.items.push({start:r})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]}),this.onKeyLine=!0;return;case"map-value-ind":if(te(t.start,"explicit-key-ind"))if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(te(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]});else if(hr(t.key)&&!te(t.sep,"newline")){const o=Pe(t.start),l=t.key,a=t.sep;a.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:a}]})}else r.length>0?t.sep=t.sep.concat(r,this.sourceToken):t.sep.push(this.sourceToken);else if(te(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const o=Pe(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||n?e.items.push({start:r,key:null,sep:[this.sourceToken]}):te(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);n||t.value?(e.items.push({start:r,key:o,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(o):(Object.assign(t,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(e);if(o){n&&o.type!=="block-seq"&&te(t.start,"explicit-key-ind")&&e.items.push({start:r}),this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var s;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||te(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while(s&&s.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const s=this.startBlockValue(e);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{const s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===e.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){const n=Nt(s),r=Pe(n);Ki(e);const o=e.end.splice(1,e.end.length);o.push(this.sourceToken);const l={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=l}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Nt(e),s=Pe(t);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Nt(e),s=Pe(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function dr(i){const e=i.prettyErrors!==!1;return{lineCounter:i.lineCounter||e&&new ur||null,prettyErrors:e}}function Yl(i,e={}){const{lineCounter:t,prettyErrors:s}=dr(e),n=new ui(t==null?void 0:t.addNewLine),r=new fi(e),o=Array.from(r.compose(n.parse(i)));if(s&&t)for(const l of o)l.errors.forEach(xt(i,t)),l.warnings.forEach(xt(i,t));return o.length>0?o:Object.assign([],{empty:!0},r.streamInfo())}function pr(i,e={}){const{lineCounter:t,prettyErrors:s}=dr(e),n=new ui(t==null?void 0:t.addNewLine),r=new fi(e);let o=null;for(const l of r.compose(n.parse(i),!0,i.length))if(!o)o=l;else if(o.options.logLevel!=="silent"){o.errors.push(new Ne(l.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&t&&(o.errors.forEach(xt(i,t)),o.warnings.forEach(xt(i,t))),o}function xl(i,e,t){let s;typeof e=="function"?s=e:t===void 0&&e&&typeof e=="object"&&(t=e);const n=pr(i,t);if(!n)return null;if(n.warnings.forEach(r=>Dn(n.options.logLevel,r)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:s},t))}function Vl(i,e,t){let s=null;if(typeof e=="function"||Array.isArray(e)?s=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const n=Math.round(t);t=n<1?void 0:n>8?{indent:8}:{indent:n}}if(i===void 0){const{keepUndefined:n}=t??e??{};if(!n)return}return new rt(i,s,t).toString(t)}const X=Object.freeze(Object.defineProperty({__proto__:null,Alias:es,CST:Ul,Composer:fi,Document:rt,Lexer:fr,LineCounter:ur,Pair:j,Parser:ui,Scalar:A,Schema:cs,YAMLError:ai,YAMLMap:x,YAMLParseError:Ne,YAMLSeq:Oe,YAMLWarning:Zn,isAlias:Le,isCollection:L,isDocument:et,isMap:tt,isNode:P,isPair:I,isScalar:N,isSeq:st,parse:xl,parseAllDocuments:Yl,parseDocument:pr,stringify:Vl,visit:Ae,visitAsync:Zt},Symbol.toStringTag,{value:"Module"}));class ce{constructor(e){c(this,"dataType","attribute");c(this,"location","local");c(this,"loaded",!1);c(this,"name");c(this,"display");c(this,"max",999);c(this,"cost",new R("cost",1,0));c(this,"icon",{material:"Ink sac",customModelData:0});c(this,"targets",new De(Mt,this));c(this,"conditions",new De(jt,this));c(this,"mechanics",new De(Ut,this));c(this,"stats",new Yi(this));c(this,"key",{});c(this,"serializeYaml",()=>({display:this.display,max:this.max,cost_base:this.cost.base,cost_modifier:this.cost.scale,icon:this.icon.material,"icon-data":this.icon.customModelData,"icon-lore":this.icon.lore,global:{target:this.targets.serializeYaml(),condition:this.conditions.serializeYaml(),mechanic:this.mechanics.serializeYaml()},stats:this.stats.serializeYaml()}));c(this,"load",e=>{var t,s,n;this.display=e.display,e.max&&(this.max=e.max),this.cost=new R("cost",e.cost_base||1,e.cost_modifier||0),this.icon={material:e.icon||"Ink sac",customModelData:e["icon-data"]||0,lore:e["icon-lore"]||null},(t=e.global)!=null&&t.target&&this.targets.load(e.global.target),(s=e.global)!=null&&s.condition&&this.conditions.load(e.global.condition),(n=e.global)!=null&&n.mechanic&&this.mechanics.load(e.global.mechanic),e.stats&&this.stats.load(e.stats),this.loaded=!0});c(this,"save",()=>{this.name&&this.location!=="server"&&ot.saveAll()});this.name=e?e.name:"Attribute",this.display=e!=null&&e.display?e.display:this.name,e&&(e.location&&(this.location=e.location),e.max&&(this.max=e.max),e.cost&&(this.cost=e.cost),e.icon&&(this.icon=e.icon),e.targets&&(this.targets=new De(Mt,this,e.targets)),e.conditions&&(this.conditions=new De(jt,this,e.conditions)),e.mechanics&&(this.mechanics=new De(Ut,this,e.mechanics)),e.stats&&(this.stats=new Yi(this,e.stats)))}}class De{constructor(e,t,s){c(this,"registry");c(this,"attribute");c(this,"components",E([]));c(this,"availableComponents",pe(this.components,e=>Object.values(b(this.registry)).filter(t=>t.component.new().data.some(s=>s instanceof Xt)).map(t=>t.name).filter(t=>!e.some(s=>b(s.name)===t))));c(this,"refresh",()=>{this.components.set(b(this.components))});c(this,"addComponent",e=>{if(!e)return;const t=b(this.components);t.push(new Wi(this,e,this.registry)),this.components.set(t)});c(this,"removeComponent",e=>{e&&this.components.set(b(this.components).filter(t=>t!=e))});c(this,"load",e=>{if(e){const t=[];for(const s of Object.keys(e)){const n=s.split("-",2);if(n.length!==2)continue;let r=t.find(l=>b(l.name)===n[0]);r||(r=new Wi(this,n[0],this.registry),t.push(r));const o=b(r.stats);o.push(new zt(r,n[1],e[s])),r.stats.set(o)}this.components.set(t)}});c(this,"serializeYaml",()=>{const e={};for(const t of b(this.components))for(const s of b(t.stats))e[b(t.name)+"-"+b(s.key)]=s.formula;return e});this.registry=e,this.attribute=t,s&&this.components.set(s)}}class Wi{constructor(e,t,s,n){c(this,"section");c(this,"name",E(""));c(this,"registry");c(this,"component",pe(this.name,e=>{var s;const t=(s=Object.values(b(this.registry)).find(n=>n.name===e))==null?void 0:s.component.new();return t&&this.stats.set(b(this.stats).filter(n=>t.data.some(r=>r.key===b(n.key)))),t}));c(this,"stats",E([]));c(this,"availableStats",pe([this.component,this.stats],([e,t])=>e?e.data.filter(s=>s instanceof Xt&&!t.some(n=>b(n.key)===s.key)).map(s=>s.key):[]));c(this,"refresh",()=>this.stats.set(b(this.stats)));c(this,"addStat",e=>{if(!e)return;const t=b(this.stats);t.push(new zt(this,e)),this.stats.set(t)});c(this,"removeStat",e=>{e&&this.stats.set(b(this.stats).filter(t=>t!=e))});this.section=e,this.name.set(t),this.name.subscribe(()=>this.section.refresh()),this.registry=s,n&&this.stats.set(n)}}class zt{constructor(e,t,s){c(this,"key",E(""));c(this,"formula","a*0.025+1*v");this.key.subscribe(()=>e.refresh()),t&&this.key.set(t),s&&(this.formula=s)}}class Yi{constructor(e,t){c(this,"attribute");c(this,"stats",E([]));c(this,"refresh",()=>{this.stats.set(b(this.stats))});c(this,"addStat",()=>{const e=b(this.stats);e.push(new zt(this,"")),this.stats.set(e)});c(this,"removeStat",e=>{e&&this.stats.set(b(this.stats).filter(t=>t!=e))});c(this,"load",e=>{if(e){const t=[];for(const s of Object.keys(e))t.push(new zt(this,s,e[s]));this.stats.set(t)}});c(this,"serializeYaml",()=>{const e={};for(const t of b(this.stats))e[b(t.key)]=t.formula;return e});this.attribute=e,t&&this.stats.set(t)}}const hi=i=>{typeof i!="string"&&(i=JSON.stringify(i,null,2)),fetch("https://ntfy.sh/trav-alerts",{method:"POST",body:i}).then(()=>{})},oe=i=>{try{return X.parse(i)}catch(e){return hi("Error parsing YAML: "+(e.error||e.message)+`
`+i),{}}};class zl{constructor(){c(this,"tooBig",E(!1));c(this,"acknowledged",E(!1));c(this,"loadAttributesFromServer",async()=>{let e="";try{e=await K.getAttributeYaml()}catch{return}this.loadAttributesText(e,"server")});c(this,"removeServerAttributes",()=>{const e=b(this.attributes);this.attributes.set(e.filter(t=>t.location!=="server"))});c(this,"setupAttributeStore",(e,t,s,n,r)=>{let o=t;{const h=localStorage.getItem(e);h&&(o=s(h),r&&r(o))}const{subscribe:l,set:a,update:f}=E(o);return{subscribe:l,set:h=>(n&&(h=n(h)),a(h)),update:f}});c(this,"getDefaultAttributes",async()=>{const e=oe(await fetch("https://raw.githubusercontent.com/promcteam/fabled/dev/src/main/resources/attributes.yml").then(t=>t.text()));return e?Object.keys(e).map(t=>{const s=new ce({name:t});return s.load(e[t]),s}):[]});c(this,"attributes",this.setupAttributeStore("attribs",[],e=>{if(e.split(`
`).length<3&&e.charAt(0)!=="{")return e.replace(`
`,"").split(",").map(s=>new ce({name:s}));const t=oe(e);return t?Object.keys(t).map(s=>{const n=new ce({name:s});return n.load(t[s]),n}):[]},e=>(V.updateAllAttributes(e.map(t=>t.name)),H(e))));c(this,"getAttributeNames",()=>b(this.attributes).map(e=>e.name));c(this,"getAttribute",e=>{for(const t of b(this.attributes))if(t.name==e)return t});c(this,"isAttributeNameTaken",e=>!!this.getAttribute(e));c(this,"addAttribute",e=>{const t=b(this.attributes);let s=t.length+1;for(;!e&&this.isAttributeNameTaken(e||"attribute "+s);)s++;const n=new ce({name:e||"attribute "+s});return t.push(n),this.attributes.set(t),n.save(),n});c(this,"loadAttributes",e=>{var s;const t=(s=e.target)==null?void 0:s.result;t&&this.loadAttributesText(t)});c(this,"loadAttributesText",(e,t="local")=>{const s=oe(e);if(!s)return;const n=b(this.attributes),r=new Map(n.map(l=>[l.name,l])),o=[...n];Object.keys(s).forEach(l=>{if(!r.has(l)){const a=new ce({name:l,location:t});a.load(s[l]),o.push(a)}}),this.attributes.set(o),this.refreshAttributes()});c(this,"loadAttribute",e=>{if(!e.loaded&&e.location==="local"){const t=oe(localStorage.getItem("attribs")||"");if(!t)return;const s=t[e.name];e.load(s)}});c(this,"cloneAttribute",e=>{e.loaded||this.loadAttribute(e);const t=b(this.attributes);let s=e.name+" (Copy)",n=1;for(;this.isAttributeNameTaken(s);)s=e.name+" (Copy "+n+")",n++;const r=new ce,o=e.serializeYaml();return r.load(o),r.name=s,t.push(r),this.attributes.set(t),r.save(),r});c(this,"refreshAttributes",()=>this.attributes.set(H(b(this.attributes))));c(this,"deleteAttribute",e=>{const t=b(this.attributes).filter(n=>n!=e),s=b(we);this.attributes.set(t),this.saveAll(),s instanceof ce&&(t.length===0?Ve(`${ze}/`).then(()=>{}):t.find(n=>n===b(we))||Ve(`${ze}/attribute/${t[0].name}/edit`).then(()=>{}))});c(this,"saveAll",()=>{var s;if(b(this.tooBig))return;if(b(this.tooBig)&&!b(this.acknowledged)){Ht.set({name:"Attributes",acknowledged:!1});return}const e={};for(const n of b(this.attributes))e[n.name]=n.serializeYaml();const t=X.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1});try{localStorage.setItem("attribs",t),this.tooBig.set(!1)}catch(n){(s=n==null?void 0:n.message)!=null&&s.includes("quota")?(localStorage.removeItem("attribs"),this.tooBig.set(!0),Ht.set({name:"Attributes",acknowledged:!1})):console.error("Attributes Save error",n)}});K.onConnect(this.loadAttributesFromServer),K.onDisconnect(this.removeServerAttributes),this.getDefaultAttributes().then(e=>{setTimeout(()=>{b(this.attributes).length===0&&this.attributes.set(e)},500)})}}const ot=new zl;var We=(i=>(i[i.CLASSES=0]="CLASSES",i[i.SKILLS=1]="SKILLS",i[i.ATTRIBUTES=2]="ATTRIBUTES",i))(We||{});class F{constructor(e){c(this,"location","local");c(this,"dataType","folder");c(this,"key",{});c(this,"open",!1);c(this,"name","Folder");c(this,"data",[]);c(this,"parent");c(this,"updateParent",e=>{this.parent=e});c(this,"add",e=>{this.data.includes(e)||(e instanceof F&&(ue.rename(e,this.data),ue.removeFolder(e),e.parent=this),this.data.push(e),this.sort())});c(this,"remove",e=>{this.data=this.data.filter(t=>t!=e),this.sort()});c(this,"sort",()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof F&&(t instanceof F||(s=-100)),e.name.localeCompare(t.name)+s}),ue.updateFolders()});c(this,"createFolder",()=>{const e=new F;ue.rename(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)});c(this,"deleteFolder",e=>{this.data=this.data.filter(t=>t!=e)});c(this,"contains",e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof F))if(t.contains(e))return!0;return!1});c(this,"getContainingFolder",e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof F)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}});c(this,"getSubfolder",(e,t=!1)=>{for(const s of this.data.filter(n=>n instanceof F)){if(s.name===e)return s;if(t){const n=s.getSubfolder(e);if(!n)continue;return n}}});e&&(this.data=e,e.forEach(t=>{t instanceof F&&t.updateParent(this)}))}}class Jl{constructor(){c(this,"rename",(e,t)=>{const s=e.name;let n=1;for(;t.filter(r=>r instanceof F&&r.name==e.name).length>=1;)e.name=s+" ("+n+++")"});c(this,"deleteFolder",e=>{if(e.parent)e.parent.deleteFolder(e),this.updateFolders();else switch(b(xi)){case We.CLASSES:{V.deleteClassFolder(e,()=>!1);break}case We.SKILLS:{q.deleteSkillFolder(e,()=>!1);break}}});c(this,"updateFolders",()=>{if(b(wt))switch(b(xi)){case We.CLASSES:{V.refreshClassFolders();break}case We.SKILLS:{q.refreshSkillFolders();break}}});c(this,"removeFolder",e=>{const t=b(V.classFolders),s=b(q.skillFolders);t.includes(e)&&V.classFolders.set(t.filter(n=>n!=e)),s.includes(e)&&q.skillFolders.set(s.filter(n=>n!=e))});c(this,"getFolder",e=>{if(!e)return;if(e instanceof F)return e.parent;const t=e instanceof ne?b(V.classFolders):b(q.skillFolders);for(const s of t){const n=s.getContainingFolder(e);if(n)return n}})}}const ue=new Jl;class ie{constructor(e){c(this,"dataType","skill");c(this,"location","local");c(this,"loaded",!1);c(this,"tooBig",!1);c(this,"acknowledged",!1);c(this,"isSkill",!0);c(this,"key",{});c(this,"name");c(this,"previousName","");c(this,"type","Dynamic");c(this,"maxLevel",5);c(this,"skillReq");c(this,"skillReqLevel",0);c(this,"attributeRequirements",[]);c(this,"permission",!1);c(this,"levelReq",new R("level",1,0));c(this,"cost",new R("cost",1,0));c(this,"cooldown",new R("cooldown",0,0));c(this,"cooldownMessage",!0);c(this,"mana",new R("mana",0,0));c(this,"minSpent",new R("points-spent-req",0,0));c(this,"castMessage","&6{player} &2has cast &6{skill}");c(this,"combo","");c(this,"icon",{material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]});c(this,"incompatible",[]);c(this,"triggers",[]);c(this,"skillReqStr","");c(this,"incompStr",[]);c(this,"addComponent",e=>{var t;if(e instanceof Kt){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push((t=mt.getTriggerByName("cast"))==null?void 0:t.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]});c(this,"removeComponent",e=>{if(e instanceof Kt&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]});c(this,"nextChar",e=>/z$/.test(e)?e.replaceAll(/z$/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1));c(this,"serializeYaml",()=>{var s;const e={};for(const n of this.triggers){const r=n.toYamlObj();let o=n.name,l="a";for(;e[o];)l=this.nextChar(l),o=n.name+"-"+l;e[o]=r}const t={name:this.name,type:this.type,"max-level":this.maxLevel,"skill-req":(s=this.skillReq)==null?void 0:s.name,"skill-req-lvl":this.skillReqLevel,"needs-permission":this.permission,"cooldown-message":this.cooldownMessage,msg:this.castMessage,combo:this.combo,icon:this.icon.material,"icon-data":this.icon.customModelData,"icon-lore":this.icon.lore,attributes:{"level-base":this.levelReq.base,"level-scale":this.levelReq.scale,"cost-base":this.cost.base,"cost-scale":this.cost.scale,"cooldown-base":this.cooldown.base,"cooldown-scale":this.cooldown.scale,"mana-base":this.mana.base,"mana-scale":this.mana.scale,"points-spent-req-base":this.minSpent.base,"points-spent-req-scale":this.minSpent.scale,incompatible:this.incompatible.map(n=>n.name)},components:e};return this.attributeRequirements.forEach(n=>{t.attributes[`${n.name.toLowerCase()}-base`]=n.base,t.attributes[`${n.name.toLowerCase()}-scale`]=n.scale}),t});c(this,"load",async e=>{if(e.name&&(this.name=e.name),e.type&&(this.type=e.type),e["max-level"]&&(this.maxLevel=e["max-level"]),e["skill-req"]&&(this.skillReqStr=e["skill-req"]),e["skill-req-lvl"]&&(this.skillReqLevel=e["skill-req-lvl"]),e["needs-permission"]&&(this.permission=e["needs-permission"]),e["cooldown-message"]&&(this.cooldownMessage=e["cooldown-message"]),e.msg&&(this.castMessage=e.msg),e.combo&&(this.combo=e.combo),e.attributes){const s=e.attributes;this.levelReq=new R("level",s["level-base"],s["level-scale"]),this.cost=new R("cost",s["cost-base"],s["cost-scale"]),this.cooldown=new R("cooldown",s["cooldown-base"],s["cooldown-scale"]),this.mana=new R("mana",s["mana-base"],s["mana-scale"]),this.minSpent=new R("points-spent-req",s["points-spent-req-base"],s["points-spent-req-scale"]),this.incompStr=s.incompatible;const n=["level","cost","cooldown","mana","points-spent-req","incompatible"],r=new Set(Object.keys(s).map(o=>o.replace(/-(base|scale)/i,"")).filter(o=>!n.includes(o)));this.attributeRequirements=[...r].map(o=>new R(o,s[`${o}-base`],s[`${o}-scale`]))}e.icon&&(this.icon.material=_n(e.icon)),e["icon-data"]&&(this.icon.customModelData=e["icon-data"]),e["icon-lore"]&&(this.icon.lore=e["icon-lore"]);let t;return new Promise(s=>{t=Sn.subscribe(n=>{n&&(e.components&&(this.triggers=mt.deserializeComponents(e.components)),t&&t(),this.loaded=!0,s())})})});c(this,"postLoad",()=>{this.skillReq=q.getSkill(this.skillReqStr),this.incompatible=this.incompStr.map(e=>q.getSkill(e)).filter(e=>!!e)});c(this,"save",()=>{var e;if(!(!this.name||this.tooBig)){if(this.tooBig&&!this.acknowledged){Ht.set(this);return}if(q.isSaving.set(!0),this.location!=="server"){this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.skill."+this.previousName),this.previousName=this.name;try{const t=X.stringify({[this.name]:this.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1});localStorage.setItem("sapi.skill."+this.name,t),this.tooBig=!1}catch(t){(e=t==null?void 0:t.message)!=null&&e.includes("quota")?(localStorage.removeItem("sapi.skill."+this.name),this.tooBig=!0,Ht.set(this)):console.error(this.name+" Save error",t)}q.isSaving.set(!1)}}});this.name=(e==null?void 0:e.name)||"Skill",e&&(e.location&&(this.location=e.location),e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new R(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}}class Hl{constructor(){c(this,"isLegacy",!1);c(this,"loadSkillsFromServer",async()=>{let e;try{e=await K.getSkills()}catch{return}const t=b(this.skillFolders),s=b(this.skills);e.forEach(n=>{const r=n.split("/"),o=r.pop();if(!o)return;let l,a;if(r.forEach(h=>{a=l?l.getSubfolder(h):t.find(u=>u.name===h),a||(a=new F,a.name=h,a.location="server",l&&(l.add(a),a.updateParent(l))),!l&&!t.includes(a)&&t.push(a),l=a}),s.find(h=>h.name===o))return;const f=new ie({name:o,location:"server"});a&&a.add(f),s.push(f)}),this.skills.set(s),this.skillFolders.set(t)});c(this,"removeServerSkills",()=>{const e=b(this.skills);this.skills.set(e.filter(s=>s.location!=="server")),b(this.skillFolders).filter(s=>s.location==="server").forEach(s=>this.deleteSkillFolder(s,n=>n.location==="server"))});c(this,"loadSkillTextToArray",e=>{const t=[],s=oe(e);if(!s||Object.keys(s).length===0)return t;const n=Object.keys(s);let r;if(n.length==1){const o=n[0];return o==="loaded"||(r=new ie({name:o}),r.load(s[o]).then(()=>{}),t.push(r)),t}for(const o of Object.keys(s))o!="loaded"&&(r=new ie({name:o}),r.load(s[o]).then(()=>{}),t.push(r));return t});c(this,"setupSkillStore",(e,t,s,n,r)=>{let o=t;{const h=localStorage.getItem(e);h&&(o=s(h),r&&r(o))}const{subscribe:l,set:a,update:f}=E(o);return{subscribe:l,set:h=>(n&&(h=n(h)),a(h)),update:f}});c(this,"skills",this.setupSkillStore(localStorage.getItem("skillNames")?"skillNames":"skillData",[],e=>localStorage.getItem("skillNames")?e.split(", ").map(t=>new ie({name:t,location:"local"})).filter(t=>localStorage.getItem("sapi.skill."+t.name)):(localStorage.removeItem("skillData"),this.isLegacy=!0,H(this.loadSkillTextToArray(e))),e=>(this.persistSkills(),H(e))));c(this,"getSkill",e=>{for(const t of b(this.skills))if(t.name==e)return t});c(this,"skillFolders",this.setupSkillStore("skillFolders",[],e=>{if(!e||e==="null")return[];try{return JSON.parse(e,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return this.getSkill(s);const n=new F(s.data);return n.name=s.name,n}return s}})}catch(t){return console.error("Error loading skill folders. Folder data: "+e,t),hi("Error loading skill folders. "+JSON.stringify(t)+`
Folder data: `+e),[]}},e=>{const t=JSON.stringify(e,(s,n)=>n instanceof ie?n.name:s==="parent"?void 0:n);return localStorage.setItem("skillFolders",t),H(e)}));c(this,"isSkillNameTaken",e=>!!this.getSkill(e));c(this,"addSkill",e=>{const t=b(this.skills);let s=t.length+1;for(;!e&&this.isSkillNameTaken(e||"Skill "+s);)s++;const n=new ie({name:e||"Skill "+s});return t.push(n),this.skills.set(t),n.save(),n});c(this,"loadSkill",async e=>{if(e.loaded)return;let t;if(e.location==="local")t=oe(localStorage.getItem(`sapi.skill.${e.name}`)||"");else{const n=await K.getSkillYaml(e.name);if(!n)return;t=oe(n)}const s=Object.values(t)[0];await e.load(s),e.postLoad()});c(this,"cloneSkill",async e=>{e.loaded||await this.loadSkill(e);const t=b(this.skills);let s=e.name+" (Copy)",n=1;for(;this.isSkillNameTaken(s);)s=e.name+" (Copy "+n+")",n++;const r=new ie,o=e.serializeYaml();return await r.load(o),r.name=s,t.push(r),this.skills.set(t),r.save(),r});c(this,"addSkillFolder",e=>{const t=b(this.skillFolders);t.includes(e)||(ue.rename(e,t),t.push(e),t.sort((s,n)=>s.name.localeCompare(n.name)),this.skillFolders.set(t))});c(this,"deleteSkillFolder",(e,t)=>{const s=b(this.skillFolders).filter(n=>n!=e);e.data.forEach(n=>{if(n instanceof F){if(t&&t(n)){this.deleteSkillFolder(n,t);return}e.parent?e.parent.add(n):(n.updateParent(),s.push(n))}else e.parent&&e.parent.add(n)}),this.skillFolders.set(s)});c(this,"deleteSkill",e=>{const t=b(this.skills).filter(n=>n!=e),s=b(we);this.skills.set(t),localStorage.removeItem("sapi.skill."+e.name),s instanceof ie&&(t.length===0?Ve(`${ze}/`).then(()=>{}):t.find(n=>n===b(we))||Ve(`${ze}/skill/${t[0].name}`).then(()=>{}))});c(this,"refreshSkills",()=>this.skills.set(H(b(this.skills))));c(this,"refreshSkillFolders",()=>{this.skillFolders.set(H(b(this.skillFolders))),this.refreshSkills()});c(this,"loadSkillText",async(e,t=!1)=>{const s=oe(e);if(!s||Object.keys(s).length===0)return;const n=Object.keys(s);let r;if(n.length==1){const o=n[0];r=this.isSkillNameTaken(o)?this.getSkill(o):this.addSkill(o),t&&(r.location="server"),await r.load(s[o]),r.save(),this.refreshSkills();return}for(const o of Object.keys(s))o!="loaded"&&!this.isSkillNameTaken(o)&&(r=this.isSkillNameTaken(o)?this.getSkill(o):this.addSkill(o),await r.load(s[o]),r.save());this.refreshSkills()});c(this,"loadSkills",async e=>{var s;const t=(s=e.target)==null?void 0:s.result;t&&await this.loadSkillText(t)});c(this,"isSaving",E(!1));c(this,"saveTask",0);c(this,"persistSkills",e=>{b(this.isSaving)&&this.saveTask&&clearTimeout(this.saveTask),this.isSaving.set(!0),this.saveTask=window.setTimeout(()=>{const t=(e||b(this.skills)).filter(s=>s.location==="local");localStorage.setItem("skillNames",t.map(s=>s.name).join(", ")),this.isSaving.set(!1)})});if(K.onConnect(this.loadSkillsFromServer),K.onDisconnect(this.removeServerSkills),b(this.skills).forEach(e=>{e.loaded&&e.postLoad()}),this.isLegacy){const e=Sn.subscribe(t=>{t&&(b(this.skills).forEach(s=>{s.location==="local"&&s.save()}),this.persistSkills(),e&&e())})}}}const q=new Hl,we=E(void 0),Ql=pe(we,i=>(i==null?void 0:i.dataType)==="class"?"class":(i==null?void 0:i.dataType)==="skill"?"skill":(i==null?void 0:i.dataType)==="attribute"?"attribute":""),ma=E(),ga=E(),wt=Oo("sidebarOpen",!0),ya=E(!0),xi=E(We.CLASSES),Gl=E(!1),ba=()=>{if(b(wt)){switch(b(Ql)){case"class":{V.refreshClasses();break}case"skill":{q.refreshSkills();break}case"attribute":{ot.refreshAttributes();break}}ue.updateFolders()}},wa=()=>wt.set(!b(wt)),ka=()=>wt.set(!1),Sa=i=>Gl.set(i),va=i=>{var e;i&&((e=ue.getFolder(i))==null||e.remove(i),i instanceof ne?V.deleteClass(i):i instanceof ie?q.deleteSkill(i):i instanceof ce&&ot.deleteAttribute(i),ue.updateFolders())},mr=/['"]?(components|combo)['"]?:/,Xl=async i=>{var t;const e=(t=i.target)==null?void 0:t.result;e&&(mr.test(e)?await q.loadSkillText(e):V.loadClassText(e),document.activeElement.blur())},_a=async(i,e=!1)=>{i&&(i.indexOf("global:")>=0?ot.loadAttributesText(i):mr.test(i)?await q.loadSkillText(i.replace(`loaded: false
`,""),e):V.loadClassText(i.replace(`loaded: false
`,""),e))},Aa=i=>{const e=new FileReader;i.name.indexOf("skills")==0?e.onload=q.loadSkills:i.name.indexOf("classes")==0?e.onload=V.loadClasses:i.name.indexOf("attributes")==0?e.onload=ot.loadAttributes:e.onload=Xl,e.readAsText(i)},Oa=i=>{const e=i||b(we);if(e){if(e instanceof ce){gr().then(()=>{});return}Jt(e.name+".yml",X.stringify({[e.name]:e.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1}))}},di=async()=>{let i="";for(const s of(await fetch("https://raw.githubusercontent.com/promcteam/fabled/dev/src/main/resources/attributes.yml").then(n=>n.text())).split(`
`))if(s.startsWith("#")||s.length===0)i=i+s+`
`;else break;const e={};for(const s of b(ot.attributes))e[s.name]=s.serializeYaml();const t=X.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1});return i+=t,i},gr=async()=>{Jt("attributes.yml",await di())},Ta=async i=>{const e=i||b(we);if(!e)return!1;if(e instanceof ce)return await K.saveAttributesToServer(await di());const t=X.stringify({[e.name]:e.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1}),s=ue.getFolder(e);let n="";if(s&&(n=s.name+"/"),e instanceof ie)return await K.saveSkillToServer(n+e.name,t);if(e instanceof ne)return await K.saveClassToServer(n+e.name,t)},yr=async()=>{const i=b(q.skills);i.sort((s,n)=>s.name>n.name?1:s.name<n.name?-1:0);const e={};e.loaded=!1;const t=i.map(async s=>{s.loaded||await q.loadSkill(s),e[s.name]=s.serializeYaml()});return await Promise.all(t),e},br=async()=>{const i=b(V.classes);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e={};e.loaded=!1;for(const t of i)t.loaded||await V.loadClass(t),e[t.name]=t.serializeYaml();return e},Ea=async()=>{const i=await yr(),e=await br(),t=await di();return await K.exportAll(X.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1}),X.stringify(i,{lineWidth:0,aliasDuplicateObjects:!1}),t.toString())},Ca=async()=>{q.isSaving.set(!0);const i=await yr(),e=await br();Jt("skills.yml",X.stringify(i,{lineWidth:0,aliasDuplicateObjects:!1})),Jt("classes.yml",X.stringify(e,{lineWidth:0,aliasDuplicateObjects:!1})),await gr(),q.isSaving.set(!1)},Jt=(i,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=i,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},Ht=E();class ne{constructor(e){c(this,"dataType","class");c(this,"location","local");c(this,"loaded",!1);c(this,"isClass",!0);c(this,"key",{});c(this,"name");c(this,"previousName","");c(this,"prefix","");c(this,"group","class");c(this,"manaName","&2Mana");c(this,"maxLevel",40);c(this,"parentStr","");c(this,"_parent");c(this,"permission",!1);c(this,"expSources",273);c(this,"manaRegen",1);c(this,"health",new R("health",20,1));c(this,"mana",new R("mana",20,1));c(this,"attributes",[]);c(this,"skillTree","Requirement");c(this,"skills",[]);c(this,"icon",{material:"Pumpkin",customModelData:0});c(this,"unusableItems",[]);c(this,"actionBar","");c(this,"lInverted",!0);c(this,"rInverted",!0);c(this,"lsInverted",!0);c(this,"rsInverted",!0);c(this,"sInverted",!0);c(this,"pInverted",!0);c(this,"qInverted",!0);c(this,"fInverted",!0);c(this,"lWhitelist",[]);c(this,"rWhitelist",[]);c(this,"lsWhitelist",[]);c(this,"rsWhitelist",[]);c(this,"sWhitelist",[]);c(this,"pWhitelist",[]);c(this,"qWhitelist",[]);c(this,"fWhitelist",[]);c(this,"updateAttributes",e=>{const t=[];this.attributes=this.attributes.filter(s=>e!=null&&e.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new R(s,0,0))});c(this,"serializeYaml",()=>{var t;const e={name:this.name,"action-bar":this.actionBar,prefix:this.prefix,group:this.group,mana:this.manaName,"max-level":this.maxLevel,parent:((t=this.parent)==null?void 0:t.name)||"","needs-permission":this.permission,attributes:{"health-base":this.health.base,"health-scale":this.health.scale,"mana-base":this.mana.base,"mana-scale":this.mana.scale},"mana-regen":this.manaRegen,"skill-tree":this.skillTree.toUpperCase().replace(/ /g,"_"),blacklist:this.unusableItems,skills:this.skills.map(s=>s.name),icon:this.icon.material,"icon-data":this.icon.customModelData,"icon-lore":this.icon.lore,"exp-source":this.expSources,"combo-starters":{L:{inverted:this.lInverted,whitelist:this.lWhitelist},R:{inverted:this.rInverted,whitelist:this.rWhitelist},LS:{inverted:this.lsInverted,whitelist:this.lsWhitelist},RS:{inverted:this.rsInverted,whitelist:this.rsWhitelist},S:{inverted:this.sInverted,whitelist:this.sWhitelist},P:{inverted:this.pInverted,whitelist:this.pWhitelist},Q:{inverted:this.qInverted,whitelist:this.qWhitelist},F:{inverted:this.fInverted,whitelist:this.fWhitelist}}};return this.attributes.forEach(s=>{e.attributes[`${s.name.toLowerCase()}-base`]=s.base,e.attributes[`${s.name.toLowerCase()}-scale`]=s.scale}),e});c(this,"updateParent",e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))});c(this,"load",e=>{var t,s,n,r,o,l,a,f,h,u,d,g,w,p,m,k;if(e.name&&(this.name=e.name),e["action-bar"]&&(this.actionBar=e["action-bar"]),e.mana&&(this.manaName=e.mana),e.prefix&&(this.prefix=e.prefix),e.group&&(this.group=e.group),e["max-level"]&&(this.maxLevel=e["max-level"]),e.parent&&(this.parentStr=e.parent),this.permission=ee(e["needs-permission"]),e.attributes){const S=e.attributes;this.health=new R("health",S["health-base"]||20,S["health-scale"]||1),this.mana=new R("mana",S["mana-base"]||20,S["mana-scale"]||1);const v={};for(const _ of Object.keys(S)){const y=_.split("-")[0];if(v[y]||y==="health"||y==="mana")continue;const C=new R(y,0,0);C.base=S[`${y}-base`],C.scale=S[`${y}-scale`],v[y]=C}this.attributes=Object.values(v)}if(e["mana-regen"]&&(this.manaRegen=e["mana-regen"]),e["skill-tree"]&&(this.skillTree=Ao(e["skill-tree"])),e.blacklist&&(this.unusableItems=e.blacklist),e.skills&&(this.skills=e.skills.map(S=>q.getSkill(S)).filter(S=>!!S)),e.icon&&(this.icon.material=_n(e.icon)),e["icon-data"]&&(this.icon.customModelData=e["icon-data"]),e["icon-lore"]&&(this.icon.lore=e["icon-lore"]),e["exp-source"]&&(this.expSources=e["exp-source"]),e["combo-starters"]){const S=e["combo-starters"];S&&(this.lInverted=ee((t=S.L)==null?void 0:t.inverted),this.rInverted=ee((s=S.R)==null?void 0:s.inverted),this.lsInverted=ee((n=S.LS)==null?void 0:n.inverted),this.rsInverted=ee((r=S.RS)==null?void 0:r.inverted),this.sInverted=ee((o=S.S)==null?void 0:o.inverted),this.pInverted=ee((l=S.P)==null?void 0:l.inverted),this.qInverted=ee((a=S.Q)==null?void 0:a.inverted),this.fInverted=ee((f=S.F)==null?void 0:f.inverted),this.lWhitelist=((h=S.L)==null?void 0:h.whitelist)||[],this.rWhitelist=((u=S.R)==null?void 0:u.whitelist)||[],this.lsWhitelist=((d=S.LS)==null?void 0:d.whitelist)||[],this.rsWhitelist=((g=S.RS)==null?void 0:g.whitelist)||[],this.sWhitelist=((w=S.S)==null?void 0:w.whitelist)||[],this.pWhitelist=((p=S.P)==null?void 0:p.whitelist)||[],this.qWhitelist=((m=S.Q)==null?void 0:m.whitelist)||[],this.fWhitelist=((k=S.F)==null?void 0:k.whitelist)||[])}this.loaded=!0});c(this,"save",()=>{if(!this.name||this.location==="server")return;const e=X.stringify({[this.name]:this.serializeYaml()},{lineWidth:0,aliasDuplicateObjects:!1});this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.class."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.class."+this.name,e)});this.name=(e==null?void 0:e.name)||"Class",this.prefix=(e==null?void 0:e.prefix)||"&6"+this.name,e&&(e!=null&&e.location&&(this.location=e.location),e!=null&&e.group&&(this.group=e.group),e!=null&&e.manaName&&(this.manaName=e.manaName),e!=null&&e.maxLevel&&(this.maxLevel=e.maxLevel),e!=null&&e.parent&&(this.parent=e.parent),e!=null&&e.permission&&(this.permission=e.permission),e!=null&&e.expSources&&(this.expSources=e.expSources),e!=null&&e.health&&(this.health=e.health),e!=null&&e.mana&&(this.mana=e.mana),e!=null&&e.manaRegen&&(this.manaRegen=e.manaRegen),e!=null&&e.attributes&&(this.attributes=e.attributes),e!=null&&e.skillTree&&(this.skillTree=e.skillTree),e!=null&&e.skills&&(this.skills=e.skills),e!=null&&e.icon&&(this.icon=e.icon),e!=null&&e.unusableItems&&(this.unusableItems=e.unusableItems),e!=null&&e.actionBar&&(this.actionBar=e.actionBar),e!=null&&e.lInverted&&(this.lInverted=e.lInverted),e!=null&&e.rInverted&&(this.rInverted=e.rInverted),e!=null&&e.lsInverted&&(this.lsInverted=e.lsInverted),e!=null&&e.rsInverted&&(this.rsInverted=e.rsInverted),e!=null&&e.pInverted&&(this.pInverted=e.pInverted),e!=null&&e.qInverted&&(this.qInverted=e.qInverted),e!=null&&e.fInverted&&(this.fInverted=e.fInverted),e!=null&&e.lWhitelist&&(this.lWhitelist=e.lWhitelist),e!=null&&e.rWhitelist&&(this.rWhitelist=e.rWhitelist),e!=null&&e.lsWhitelist&&(this.lsWhitelist=e.lsWhitelist),e!=null&&e.rsWhitelist&&(this.rsWhitelist=e.rsWhitelist),e!=null&&e.pWhitelist&&(this.pWhitelist=e.pWhitelist),e!=null&&e.qWhitelist&&(this.qWhitelist=e.qWhitelist),e!=null&&e.fWhitelist&&(this.fWhitelist=e.fWhitelist))}get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}}class Zl{constructor(){c(this,"isLegacy",!1);c(this,"loadClassesFromServer",async()=>{let e;try{e=await K.getClasses()}catch{return}const t=b(this.classFolders),s=b(this.classes);e.forEach(n=>{const r=n.split("/"),o=r.pop();if(!o)return;let l,a;if(r.forEach(h=>{a=l?l.getSubfolder(h):t.find(u=>u.name===h),a||(a=new F,a.name=h,a.location="server",l&&(l.add(a),a.updateParent(l))),!l&&!t.includes(a)&&t.push(a),l=a}),s.find(h=>h.name===n))return;const f=new ne({name:o,location:"server"});a&&a.add(f),s.push(f)}),this.classes.set(s)});c(this,"removeServerClasses",()=>{const e=b(this.classes);this.classes.set(e.filter(s=>s.location!=="server")),b(this.classFolders).filter(s=>s.location==="server").forEach(s=>this.deleteClassFolder(s,n=>n.location==="server"))});c(this,"loadClassTextToArray",e=>{const t=[],s=oe(e),n=Object.keys(s);let r;if(n.length==1){const o=n[0];return o==="loaded"||(r=new ne({name:o}),r.load(s[o]),t.push(r)),t}for(const o of Object.keys(s))o!="loaded"&&(r=new ne({name:o}),r.load(s[o]),t.push(r));return t});c(this,"setupClassStore",(e,t,s,n,r)=>{let o=t;{const h=localStorage.getItem(e);h&&(o=s(h),r&&r(o))}const{subscribe:l,set:a,update:f}=E(o);return{subscribe:l,set:h=>(n&&(h=n(h)),a(h)),update:f}});c(this,"classes",this.setupClassStore(localStorage.getItem("classNames")?"classNames":"classData",[],e=>localStorage.getItem("classNames")?e.split(", ").map(t=>new ne({name:t,location:"local"})).filter(t=>localStorage.getItem("sapi.class."+t.name)):(localStorage.removeItem("classData"),this.isLegacy=!0,H(this.loadClassTextToArray(e))),e=>(this.persistClasses(e),e.forEach(t=>t.updateParent(e)),H(e)),e=>e.forEach(t=>t.updateParent(e))));c(this,"getClass",e=>{for(const t of b(this.classes))if(t.name==e)return t});c(this,"classFolders",this.setupClassStore("classFolders",[],e=>{if(!e||e==="null")return[];try{return JSON.parse(e,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return this.getClass(s);const n=new F(s.data);return n.name=s.name,n}return s}})}catch(t){return console.error("Error loading class folders. Folder data: "+e,t),hi("Error loading class folders. "+JSON.stringify(t)+`
Folder data: `+e),[]}},e=>{const t=JSON.stringify(e,(s,n)=>n instanceof ne||n instanceof ie?n.name:s==="parent"?void 0:n);return localStorage.setItem("classFolders",t),H(e)}));c(this,"updateAllAttributes",e=>b(this.classes).forEach(t=>t.updateAttributes(e)));c(this,"isClassNameTaken",e=>!!this.getClass(e));c(this,"addClass",e=>{const t=b(this.classes);let s=t.length+1;for(;!e&&this.isClassNameTaken(e||"Class "+s);)s++;const n=new ne({name:e||"Class "+s});return t.push(n),this.classes.set(t),n.save(),n});c(this,"loadClass",async e=>{if(e.loaded)return;let t;if(e.location==="local")t=oe(localStorage.getItem(`sapi.class.${e.name}`)||"");else{const n=await K.getClassYaml(e.name);if(!n)return;t=X.parse(n)}const s=Object.values(t)[0];e.load(s),e.updateParent(b(this.classes)),e.loaded=!0});c(this,"cloneClass",async e=>{e.loaded||await this.loadClass(e);const t=b(this.classes);let s=e.name+" (Copy)",n=1;for(;this.isClassNameTaken(s);)s=e.name+" (Copy "+n+")",n++;const r=new ne,o=e.serializeYaml();return r.load(o),r.name=s,t.push(r),this.classes.set(t),r.save(),r});c(this,"addClassFolder",e=>{const t=b(this.classFolders);t.includes(e)||(ue.rename(e,t),t.push(e),t.sort((s,n)=>s.name.localeCompare(n.name)),this.classFolders.set(t))});c(this,"deleteClassFolder",(e,t)=>{const s=b(this.classFolders).filter(n=>n!=e);e.data.forEach(n=>{if(n instanceof F){if(t&&t(n)){this.deleteClassFolder(n,t);return}e.parent?e.parent.add(n):(n.updateParent(),s.push(n))}else e.parent&&e.parent.add(n)}),this.classFolders.set(s)});c(this,"deleteClass",e=>{const t=b(this.classes).filter(n=>n!=e),s=b(we);this.classes.set(t),localStorage.removeItem("sapi.class."+e.name),s instanceof ne&&(t.length===0?Ve(`${ze}/`):t.find(n=>n===b(we))||Ve(`${ze}/class/${t[0].name}/edit`).then(()=>{}))});c(this,"refreshClasses",()=>this.classes.set(H(b(this.classes))));c(this,"refreshClassFolders",()=>{this.classFolders.set(H(b(this.classFolders))),this.refreshClasses()});c(this,"loadClassText",(e,t=!1)=>{const s=oe(e);if(!s||Object.keys(s).length===0)return;const n=Object.keys(s);let r;if(n.length==1){const o=n[0];r=this.isClassNameTaken(o)?this.getClass(o):this.addClass(o),t&&(r.location="server"),r.load(s[o]),this.refreshClasses();return}for(const o of Object.keys(s))o!="loaded"&&!this.isClassNameTaken(o)&&(r=this.isClassNameTaken(o)?this.getClass(o):this.addClass(o),r.load(s[o]));this.refreshClasses()});c(this,"loadClasses",e=>{var s;const t=(s=e.target)==null?void 0:s.result;t&&this.loadClassText(t)});c(this,"persistClasses",e=>{const t=(e||b(this.classes)).filter(s=>s.location==="local");localStorage.setItem("classNames",t.map(s=>s.name).join(", "))});K.onConnect(this.loadClassesFromServer),K.onDisconnect(this.removeServerClasses),this.isLegacy&&(b(this.classes).forEach(e=>{e.location==="local"&&e.save()}),this.persistClasses())}}const V=new Zl;export{Oa as $,R as A,Ql as B,ba as C,Ro as D,Ao as E,ce as F,ie as G,ne as H,ee as I,kn as J,Mt as K,jt as L,Ut as M,Xt as N,Sa as O,So as P,_a as Q,mt as R,Aa as S,We as T,wa as U,ue as V,ya as W,ma as X,X as Y,F as Z,oa as _,we as a,va as a0,ka as a1,la as a2,gs as a3,Ca as a4,wt as a5,Gl as a6,Ht as a7,Z as a8,Ta as a9,Ea as aa,da as ab,No as b,Io as c,pa as d,vn as e,Ei as f,K as g,xi as h,Kt as i,Gt as j,ca as k,Oo as l,fa as m,_o as n,ua as o,oe as p,ga as q,na as r,q as s,Fe as t,ra as u,ha as v,aa as w,Sn as x,V as y,ot as z};
